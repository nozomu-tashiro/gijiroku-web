# AI自動フォーマット機能 - 技術詳細

## 🤖 対応AIモデル

本システムは**ジェンスパークLLMプロキシ**を通じて、最新の高性能AIモデルを使用します。

### 利用可能なモデル

| モデル | 説明 | 推奨用途 | 性能 |
|--------|------|----------|------|
| **GPT-5** ⭐ | 最新の高性能モデル | 通常の議事録（推奨） | 高性能・バランス型 |
| **GPT-5.1** | GPT-5のアップグレード版 | 非常に長い議事録（5000文字以上） | 最高性能 |
| **GPT-5 Mini** | 軽量高速版 | 短い議事録、高速処理 | 高速・コスト効率的 |

### 自動モデル選択

システムはテキストの長さに応じて自動的に最適なモデルを選択します：

```typescript
テキスト長 > 5000文字   → GPT-5.1（最高性能）
テキスト長 > 2000文字   → GPT-5（高性能）
テキスト長 ≤ 2000文字   → GPT-5 Mini（高速）
```

## 🎯 AI自動フォーマットの仕組み

### 1. テキスト入力
```
音声テキスト化ツール（例: Whisper, Google Speech-to-Text）
           ↓
    生の議事録テキスト
```

### 2. AI処理
```typescript
入力テキスト
    ↓
GPT-5による解析
    ↓
構造化されたJSON
```

### 3. 抽出される情報

- **議題**: 何について話し合われたか
- **決定事項**: 決まったこと、合意された内容
- **課題**: 問題点、懸念事項、未解決の論点
- **期日**: いつまでに（YYYY-MM-DD形式）
- **担当者**: 誰が担当するか
- **実行内容**: 具体的にやるべきこと
- **理由**: なぜそうするのか、背景情報

### 4. データベース保存
```
構造化されたデータ
    ↓
PostgreSQLに保存
    ↓
スプレッドシート形式で表示
```

## 📝 プロンプト設計

### システムプロンプト

```
あなたは企業の会議議事録を構造化する専門AIアシスタントです。

【あなたの役割】
1. 複雑で長文の議事録テキストから重要な情報を正確に抽出する
2. 議題、決定事項、課題、期日、担当者、実行内容、理由を明確に区別する
3. 曖昧な表現や口語的な表現を適切に解釈する
4. 複数の議題が混在していても、それぞれを分離して整理する

【出力の品質基準】
- 正確性: 元のテキストから逸脱しない
- 明瞭性: 簡潔で分かりやすい表現
- 構造化: 適切にカテゴリ分けされている
- 完全性: 重要な情報を漏らさない
```

### 出力形式

```json
{
  "items": [
    {
      "agenda": "新規プロジェクトの進捗確認",
      "decision": "来週までにプロトタイプを完成させる",
      "issue": "リソース不足が懸念される",
      "deadline": "2024-01-20",
      "assignee": "佐藤次郎",
      "action_item": "プロトタイプの実装とテスト",
      "reason": "顧客への提案が迫っているため"
    }
  ]
}
```

## 🔧 技術実装

### AIServiceクラス

```typescript
import { AIService, AIModel } from './services/aiService';

// サービスの初期化（デフォルトはGPT-5）
const aiService = new AIService(AIModel.GPT5);

// 議事録をフォーマット
const result = await aiService.formatMinutesText(
  rawText,        // 生のテキスト
  meetingDate,    // 会議日
  true            // 高度なモデルを使用
);
```

### 設定ファイル

ジェンスパークのLLM APIキーは自動的に設定されます：

**`~/.genspark_llm.yaml`**
```yaml
openai:
  api_key: gsk-xxxxx
  base_url: https://www.genspark.ai/api/llm_proxy/v1
```

## 📊 パフォーマンス最適化

### 1. モデル自動選択
テキストの長さに応じて最適なモデルを自動選択

### 2. Temperature設定
```typescript
temperature: 0.2  // より正確な出力のため低めに設定
```

### 3. Max Tokens
```typescript
max_tokens: 4000  // 長い議事録にも対応
```

### 4. レスポンス形式
```typescript
response_format: { type: 'json_object' }  // JSON形式を強制
```

## 🎨 使用例

### 基本的な使い方

```typescript
// 1. テキスト入力
const rawText = `
本日の会議では、新規プロジェクトについて話し合いました。
佐藤さんが来週までにプロトタイプを完成させることになりました。
リソース不足が懸念されるため、追加のメンバーをアサインすることを検討します。
`;

// 2. AI自動フォーマット
const formattedItems = await aiService.formatMinutesText(
  rawText,
  new Date('2024-01-13')
);

// 3. 結果
console.log(formattedItems);
// [
//   {
//     agenda: '新規プロジェクトの進捗確認',
//     decision: '来週までにプロトタイプを完成させる',
//     issue: 'リソース不足が懸念される',
//     deadline: '2024-01-20',
//     assignee: '佐藤次郎',
//     action_item: 'プロトタイプの実装',
//     reason: '顧客への提案が迫っているため'
//   }
// ]
```

### APIエンドポイント

```bash
# AI自動フォーマット
curl -X POST http://localhost:3000/api/minutes/ai-format \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "meetingId": "meeting-123",
    "meetingDate": "2024-01-13",
    "rawText": "本日の会議では..."
  }'
```

## 🔒 セキュリティ

- APIキーは環境変数または設定ファイルで管理
- ジェンスパークのプロキシ経由でセキュアに通信
- ログには機密情報を含めない

## 📈 今後の拡張予定

1. **マルチモーダル対応**: 画像、音声ファイルの直接処理
2. **カスタムプロンプト**: 企業ごとのカスタマイズ
3. **要約機能**: 長文議事録の自動要約
4. **品質評価**: AI出力の信頼度スコア表示
5. **多言語対応**: 英語、中国語などの議事録処理

## 💰 コスト最適化

- **自動モデル選択**: テキスト長に応じて最適なモデルを使用
- **キャッシング**: 類似のテキストは結果をキャッシュ
- **バッチ処理**: 複数の議事録をまとめて処理

## 🆚 従来のGPT-4との比較

| 項目 | GPT-4 | GPT-5 (推奨) |
|------|-------|--------------|
| 性能 | 高性能 | より高性能 |
| 処理速度 | 標準 | 高速 |
| 長文処理 | 制限あり | より長い文章に対応 |
| 精度 | 高精度 | より高精度 |
| コスト | 標準 | 効率的 |

## 🎓 ベストプラクティス

1. **テキストの前処理**: 不要な空白や改行を削除
2. **会議日の指定**: 期日の相対表現を正確に変換
3. **長文の分割**: 非常に長い議事録は分割して処理
4. **結果の検証**: AI出力を人間が確認
5. **フィードバック**: 誤りがあれば手動で修正

---

**参考リンク**:
- [ジェンスパークLLM API ドキュメント](https://www.genspark.ai/docs)
- [OpenAI SDK ドキュメント](https://github.com/openai/openai-node)
