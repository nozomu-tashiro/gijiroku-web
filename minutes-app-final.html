<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; min-height: 100vh; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 20px; }
        .user-section { display: flex; align-items: center; gap: 15px; }
        .user-info { text-align: right; font-size: 13px; }
        .logout-btn { padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 5px; cursor: pointer; font-size: 14px; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
        .breadcrumb { display: flex; gap: 10px; margin-bottom: 20px; font-size: 14px; color: #666; flex-wrap: wrap; }
        .breadcrumb-item { cursor: pointer; }
        .breadcrumb-item:hover { color: #667eea; }
        .breadcrumb-separator { color: #999; }
        
        .card { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 20px; }
        .card-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; color: #333; display: flex; justify-content: space-between; align-items: center; }
        
        /* Full Organization Tree */
        .org-full-tree { display: flex; flex-direction: column; gap: 20px; }
        .org-level { background: #f8f9fa; padding: 20px; border-radius: 8px; }
        .org-level-title { font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #333; }
        .org-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; }
        .org-item { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 6px; cursor: pointer; transition: transform 0.2s; }
        .org-item:hover { transform: translateY(-2px); }
        .org-item.board { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); }
        .org-item-title { font-size: 14px; font-weight: 600; margin-bottom: 5px; }
        .org-item-count { font-size: 12px; opacity: 0.9; }
        
        .meeting-list { display: flex; flex-direction: column; gap: 12px; }
        .meeting-item { background: #f8f9fa; padding: 18px; border-radius: 8px; cursor: pointer; border-left: 4px solid #667eea; }
        .meeting-item:hover { background: #e9ecef; }
        .meeting-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .meeting-meta { display: flex; gap: 20px; font-size: 13px; color: #666; }
        
        .minutes-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .minutes-table th { background: #f8f9fa; padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #dee2e6; }
        .minutes-table td { padding: 12px; border-bottom: 1px solid #e9ecef; }
        .minutes-table tbody tr:hover { background: #f8f9fa; }
        
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-pending { background: #fff3cd; color: #856404; }
        .badge-progress { background: #cfe2ff; color: #084298; }
        .badge-completed { background: #d1e7dd; color: #0f5132; }
        .badge-overdue { background: #f8d7da; color: #842029; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .btn-primary { background: #667eea; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; }
        .action-btns { display: flex; gap: 10px; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 10px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; font-family: inherit; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        
        .detail-section { margin-bottom: 25px; }
        .detail-section-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 10px; }
        .detail-content { background: #f8f9fa; padding: 15px; border-radius: 6px; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .detail-item { display: flex; flex-direction: column; gap: 5px; }
        .detail-label { font-size: 12px; color: #666; font-weight: 600; }
        .detail-value { font-size: 14px; color: #333; }
        
        .login-container { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 40px; border-radius: 10px; width: 100%; max-width: 400px; }
        .login-title { text-align: center; font-size: 24px; margin-bottom: 10px; }
        .login-btn { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .alert { padding: 12px; border-radius: 5px; margin-bottom: 20px; }
        .alert-error { background: #fee; border: 1px solid #fcc; color: #c33; }
        .alert-success { background: #efe; border: 1px solid #cfc; color: #3c3; }
        .demo-info { text-align: center; margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; font-size: 13px; }
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1 class="login-title">ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email" value="admin@example.com" required>
                </div>
                <div class="form-group">
                    <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" value="Admin@123" required>
                </div>
                <button type="submit" class="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </form>
            <div class="demo-info">
                <p><strong>ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</strong> admin@example.com / Admin@123</p>
            </div>
        </div>
    </div>

    <div id="mainApp" style="display: none;">
        <div class="header">
            <h1>ğŸ“‹ ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div class="user-section">
                <div class="user-info">
                    <div id="headerUserName"></div>
                    <div id="headerUserDept"></div>
                </div>
                <button class="logout-btn" id="logoutBtn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>
        <div class="container">
            <div class="breadcrumb" id="breadcrumb"></div>
            <div id="contentArea"></div>
        </div>
    </div>

    <div id="minuteModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">è­°äº‹éŒ²ã‚’è¿½åŠ </h2>
            <form id="minuteForm">
                <div class="form-group">
                    <label>è­°é¡Œ *</label>
                    <input type="text" id="minuteTopic" required>
                </div>
                <div class="form-group">
                    <label>æ±ºå®šäº‹é … *</label>
                    <textarea id="minuteDecision" required></textarea>
                </div>
                <div class="form-group">
                    <label>èª²é¡Œ</label>
                    <textarea id="minuteIssue"></textarea>
                </div>
                <div class="form-group">
                    <label>æ‹…å½“è€… *</label>
                    <input type="text" id="minuteAssignee" required>
                </div>
                <div class="form-group">
                    <label>æœŸæ—¥ *</label>
                    <input type="date" id="minuteDueDate" required>
                </div>
                <div class="form-group">
                    <label>å®Ÿè¡Œå†…å®¹ *</label>
                    <textarea id="minuteAction" required></textarea>
                </div>
                <div class="form-group">
                    <label>ç†ç”±ãƒ»èƒŒæ™¯</label>
                    <textarea id="minuteReason"></textarea>
                </div>
                <div class="form-group">
                    <label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ *</label>
                    <select id="minuteStatus" required>
                        <option value="pending">æœªç€æ‰‹</option>
                        <option value="progress">é€²è¡Œä¸­</option>
                        <option value="completed">å®Œäº†</option>
                        <option value="overdue">æœŸé™è¶…é</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="modalCancelBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://3000-iyibqicmi9poa0s21x8jw-c81df28e.sandbox.novita.ai/api';
        
        const app = {
            currentUser: null,
            currentView: 'organization',
            currentBoard: null,
            currentDepartment: null,
            currentTeam: null,
            currentMeeting: null,
            currentMinute: null,
            editingMinuteId: null,
            demoData: null,
            minutesData: {},
            archivedMinutes: [],
            
            init() {
                this.loadDemoData();
                this.checkAuth();
                this.setupEventListeners();
            },
            
            setupEventListeners() {
                document.getElementById('minuteForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveMinute();
                });
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                document.getElementById('modalCancelBtn').addEventListener('click', () => this.closeModal());
            },
            
            loadDemoData() {
                this.demoData = {
                    board: { id: 'board-1', name: 'çµŒå–¶ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰', meetingCount: 12 },
                    departments: [
                        {
                            id: 'dept-1',
                            name: 'å–¶æ¥­éƒ¨ï¼ˆå–¶æ¥­å‚µæ¨©ç®¡ç†éƒ¨ï¼‰',
                            teams: [
                                { id: 'team-1-1', name: 'æ±æ—¥æœ¬', meetingCount: 8 },
                                { id: 'team-1-2', name: 'è¥¿æ—¥æœ¬', meetingCount: 6 }
                            ]
                        },
                        {
                            id: 'dept-2',
                            name: 'å‚µæ¨©ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-2-1', name: 'ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ã‚¹ã‚¯', meetingCount: 5 },
                                { id: 'team-2-2', name: 'ã‚¨ãƒªã‚¢æ‹…å½“æ±â‘ ', meetingCount: 4 },
                                { id: 'team-2-3', name: 'ã‚¨ãƒªã‚¢æ‹…å½“æ±â‘¡', meetingCount: 3 },
                                { id: 'team-2-4', name: 'ã‚¨ãƒªã‚¢æ‹…å½“è¥¿â‘ ', meetingCount: 5 },
                                { id: 'team-2-5', name: 'ã‚¨ãƒªã‚¢æ‹…å½“è¥¿â‘¡', meetingCount: 4 },
                                { id: 'team-2-6', name: 'æ³•å‹™', meetingCount: 7 },
                                { id: 'team-2-7', name: 'æ±‚å„Ÿ', meetingCount: 3 },
                                { id: 'team-2-8', name: 'ã‚µãƒãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯é€šå¸¸äº‹å‹™ãƒãƒ¼ãƒ ', meetingCount: 4 },
                                { id: 'team-2-9', name: 'ã‚µãƒãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ä¿è¨¼å®Ÿè¡Œãƒãƒ¼ãƒ ', meetingCount: 3 }
                            ]
                        },
                        {
                            id: 'dept-3',
                            name: 'å¯©æŸ»å¥‘ç´„ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-3-1', name: 'å¯©æŸ»', meetingCount: 6 },
                                { id: 'team-3-2', name: 'å¥‘ç´„ç®¡ç†', meetingCount: 5 },
                                { id: 'team-3-3', name: 'å›½éš›ãƒãƒ¼ãƒ ', meetingCount: 4 }
                            ]
                        },
                        {
                            id: 'dept-4',
                            name: 'ã‚·ã‚¹ãƒ†ãƒ éƒ¨',
                            teams: [
                                { id: 'team-4-1', name: 'ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ', meetingCount: 7 },
                                { id: 'team-4-2', name: 'é–‹ç™ºãƒãƒ¼ãƒ ', meetingCount: 9 }
                            ]
                        },
                        {
                            id: 'dept-5',
                            name: 'äººäº‹ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-5-1', name: 'çµŒç†', meetingCount: 5 },
                                { id: 'team-5-2', name: 'äººäº‹', meetingCount: 6 },
                                { id: 'team-5-3', name: 'ç®¡ç†', meetingCount: 4 }
                            ]
                        }
                    ],
                    
                    generateMeetings(entityId) {
                        const meetingTypes = ['å®šä¾‹ä¼šè­°', 'ç·Šæ€¥ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¼šè­°', 'å ±å‘Šä¼š', 'æˆ¦ç•¥ä¼šè­°', 'çµŒå–¶ä¼šè­°', 'å¹¹éƒ¨ä¼šè­°'];
                        const meetings = [];
                        const count = entityId === 'board-1' ? 12 : Math.floor(Math.random() * 5) + 3;
                        
                        for (let i = 0; i < count; i++) {
                            const date = new Date();
                            date.setDate(date.getDate() - Math.floor(Math.random() * 60));
                            meetings.push({
                                id: `meeting-${entityId}-${i}`,
                                entityId: entityId,
                                name: `${meetingTypes[Math.floor(Math.random() * meetingTypes.length)]} ${i + 1}`,
                                date: date.toISOString().split('T')[0],
                                minutesCount: Math.floor(Math.random() * 10) + 3,
                                participants: Math.floor(Math.random() * 8) + 3
                            });
                        }
                        return meetings.sort((a, b) => new Date(b.date) - new Date(a.date));
                    },
                    
                    generateMinutes(meetingId) {
                        if (this.minutesData[meetingId]) {
                            return this.minutesData[meetingId].filter(m => !m.archived);
                        }
                        const minutes = [];
                        const count = Math.floor(Math.random() * 8) + 3;
                        const topics = ['æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆ', 'äºˆç®—è¦‹ç›´ã—', 'ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„', 'äººå“¡é…ç½®æ¤œè¨', 'é¡§å®¢å¯¾å¿œæ–¹é‡', 'æ¥­å‹™åŠ¹ç‡åŒ–æ–½ç­–', 'å››åŠæœŸç›®æ¨™è¨­å®š', 'ãƒªã‚¹ã‚¯ç®¡ç†ä½“åˆ¶', 'å¥‘ç´„æ¡ä»¶è¦‹ç›´ã—', 'å–¶æ¥­æˆ¦ç•¥ç«‹æ¡ˆ', 'çµŒå–¶æ–¹é‡æ±ºå®š', 'ä¸­æœŸçµŒå–¶è¨ˆç”»', 'çµ„ç¹”å†ç·¨æ¤œè¨'];
                        const statuses = ['pending', 'progress', 'completed'];
                        const members = ['ç”°ä¸­å¤ªéƒ', 'éˆ´æœ¨èŠ±å­', 'ä½è—¤æ¬¡éƒ', 'é«˜æ©‹ç¾å’²', 'ä¼Šè—¤å¥å¤ª', 'å±±ç”°èŠ±å­', 'æ¸¡è¾ºå¤ªéƒ'];
                        
                        for (let i = 0; i < count; i++) {
                            const dueDate = new Date();
                            dueDate.setDate(dueDate.getDate() + Math.floor(Math.random() * 30));
                            const isOverdue = Math.random() < 0.2;
                            minutes.push({
                                id: `minute-${meetingId}-${i}-${Date.now()}`,
                                meetingId: meetingId,
                                topic: topics[Math.floor(Math.random() * topics.length)],
                                decision: 'æ±ºå®šäº‹é …ã®è©³ç´°å†…å®¹ãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚',
                                issue: 'èª²é¡Œã‚„å•é¡Œç‚¹ãŒã“ã“ã«è¨˜è¼‰ã•ã‚Œã¾ã™ã€‚',
                                dueDate: isOverdue ? '2025-12-' + String(Math.floor(Math.random() * 28) + 1).padStart(2, '0') : dueDate.toISOString().split('T')[0],
                                assignee: members[Math.floor(Math.random() * members.length)],
                                action: 'å®Ÿè¡Œã™ã¹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å†…å®¹ã€‚',
                                reason: 'ã“ã®æ±ºå®šã«è‡³ã£ãŸç†ç”±ã‚„èƒŒæ™¯ã€‚',
                                status: isOverdue ? 'overdue' : statuses[Math.floor(Math.random() * statuses.length)],
                                archived: false
                            });
                        }
                        this.minutesData[meetingId] = minutes;
                        return minutes;
                    }
                };
            },
            
            async checkAuth() {
                const token = localStorage.getItem('accessToken');
                if (token) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/auth/me`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.currentUser = data.data;
                                this.showMainApp();
                                return;
                            }
                        }
                    } catch (error) {
                        console.error('Auto-login failed:', error);
                    }
                }
                this.showLoginPage();
            },
            
            showLoginPage() {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            },
            
            showMainApp() {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('headerUserName').textContent = this.currentUser.name;
                document.getElementById('headerUserDept').textContent = `${this.currentUser.department.name} / ${this.currentUser.team.name}`;
                this.showOrganizationView();
            },
            
            showAlert(message, type = 'error') {
                const alertDiv = document.getElementById('loginAlert');
                alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
                setTimeout(() => alertDiv.innerHTML = '', 3000);
            },
            
            updateBreadcrumb() {
                const breadcrumb = document.getElementById('breadcrumb');
                let html = '<span class="breadcrumb-item" data-action="showOrganizationView">ğŸ¢ å…¨çµ„ç¹”</span>';
                
                if (this.currentBoard) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" data-action="showBoardView">${this.currentBoard.name}</span>`;
                }
                if (this.currentDepartment) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" data-action="showDepartmentView" data-id="${this.currentDepartment.id}">${this.currentDepartment.name}</span>`;
                }
                if (this.currentTeam) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" data-action="showTeamView" data-id="${this.currentTeam.id}">${this.currentTeam.name}</span>`;
                }
                if (this.currentMeeting) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" data-action="showMeetingView" data-id="${this.currentMeeting.id}">${this.currentMeeting.name}</span>`;
                }
                if (this.currentMinute) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item">${this.currentMinute.topic}</span>`;
                }
                
                breadcrumb.innerHTML = html;
                this.attachBreadcrumbEvents();
            },
            
            attachBreadcrumbEvents() {
                document.querySelectorAll('.breadcrumb-item[data-action]').forEach(item => {
                    item.addEventListener('click', () => {
                        const action = item.getAttribute('data-action');
                        const id = item.getAttribute('data-id');
                        if (action === 'showOrganizationView') this.showOrganizationView();
                        else if (action === 'showBoardView') this.showBoardView();
                        else if (action === 'showDepartmentView') this.showDepartmentView(id);
                        else if (action === 'showTeamView') this.showTeamView(id);
                        else if (action === 'showMeetingView') this.showMeetingView(id);
                    });
                });
            },
            
            showOrganizationView() {
                this.currentView = 'organization';
                this.currentBoard = null;
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                let html = '<div class="card"><div class="card-title">ğŸ¢ å…¨çµ„ç¹” - ãƒãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';
                html += '<div class="org-full-tree">';
                
                // Board level
                html += '<div class="org-level">';
                html += '<div class="org-level-title">ğŸ‘” çµŒå–¶å±¤</div>';
                html += '<div class="org-items">';
                html += `<div class="org-item board" data-action="showBoardView">
                    <div class="org-item-title">${this.demoData.board.name}</div>
                    <div class="org-item-count">${this.demoData.board.meetingCount}ä»¶ã®ä¼šè­°</div>
                </div>`;
                html += '</div></div>';
                
                // Departments and teams
                this.demoData.departments.forEach(dept => {
                    html += '<div class="org-level">';
                    html += `<div class="org-level-title">ğŸ“ ${dept.name}</div>`;
                    html += '<div class="org-items">';
                    dept.teams.forEach(team => {
                        html += `<div class="org-item" data-action="showTeamView" data-id="${team.id}" data-dept="${dept.id}">
                            <div class="org-item-title">${team.name}</div>
                            <div class="org-item-count">${team.meetingCount}ä»¶ã®ä¼šè­°</div>
                        </div>`;
                    });
                    html += '</div></div>';
                });
                
                html += '</div></div>';
                content.innerHTML = html;
                this.attachOrgItemEvents();
            },
            
            attachOrgItemEvents() {
                document.querySelectorAll('.org-item[data-action]').forEach(item => {
                    item.addEventListener('click', () => {
                        const action = item.getAttribute('data-action');
                        const id = item.getAttribute('data-id');
                        const deptId = item.getAttribute('data-dept');
                        if (action === 'showBoardView') this.showBoardView();
                        else if (action === 'showTeamView') this.showTeamView(id);
                    });
                });
            },
            
            showBoardView() {
                this.currentView = 'board';
                this.currentBoard = this.demoData.board;
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.updateBreadcrumb();
                
                const meetings = this.demoData.generateMeetings('board-1');
                const content = document.getElementById('contentArea');
                let html = '<button class="btn btn-secondary back-btn" data-action="showOrganizationView">â† æˆ»ã‚‹</button>';
                html += '<div class="card"><div class="card-title">ğŸ“… '+this.currentBoard.name+' ã®ä¼šè­°ä¸€è¦§</div>';
                html += '<div class="meeting-list">';
                
                meetings.forEach(meeting => {
                    html += `<div class="meeting-item" data-action="showMeetingView" data-id="${meeting.id}">
                        <div class="meeting-title">${meeting.name}</div>
                        <div class="meeting-meta">
                            <div>ğŸ“… ${meeting.date}</div>
                            <div>ğŸ“ ${meeting.minutesCount}ä»¶ã®è­°äº‹éŒ²</div>
                            <div>ğŸ‘¥ ${meeting.participants}åå‚åŠ </div>
                        </div>
                    </div>`;
                });
                
                html += '</div></div>';
                content.innerHTML = html;
                this.attachMeetingEvents();
            },
            
            showTeamView(teamId) {
                let team = null;
                for (const dept of this.demoData.departments) {
                    team = dept.teams.find(t => t.id === teamId);
                    if (team) {
                        this.currentDepartment = dept;
                        break;
                    }
                }
                if (!team) return;
                
                this.currentView = 'team';
                this.currentBoard = null;
                this.currentTeam = team;
                this.currentMeeting = null;
                this.updateBreadcrumb();
                
                const meetings = this.demoData.generateMeetings(teamId);
                const content = document.getElementById('contentArea');
                let html = '<button class="btn btn-secondary back-btn" data-action="showOrganizationView">â† æˆ»ã‚‹</button>';
                html += '<div class="card"><div class="card-title">ğŸ“… '+team.name+' ã®ä¼šè­°ä¸€è¦§</div>';
                html += '<div class="meeting-list">';
                
                meetings.forEach(meeting => {
                    html += `<div class="meeting-item" data-action="showMeetingView" data-id="${meeting.id}">
                        <div class="meeting-title">${meeting.name}</div>
                        <div class="meeting-meta">
                            <div>ğŸ“… ${meeting.date}</div>
                            <div>ğŸ“ ${meeting.minutesCount}ä»¶ã®è­°äº‹éŒ²</div>
                            <div>ğŸ‘¥ ${meeting.participants}åå‚åŠ </div>
                        </div>
                    </div>`;
                });
                
                html += '</div></div>';
                content.innerHTML = html;
                this.attachMeetingEvents();
            },
            
            attachMeetingEvents() {
                document.querySelectorAll('[data-action="showOrganizationView"]').forEach(btn => {
                    btn.addEventListener('click', () => this.showOrganizationView());
                });
                document.querySelectorAll('.meeting-item[data-action="showMeetingView"]').forEach(item => {
                    item.addEventListener('click', () => {
                        const meetingId = item.getAttribute('data-id');
                        this.showMeetingView(meetingId);
                    });
                });
            },
            
            showMeetingView(meetingId) {
                let meeting = null;
                const entityId = meetingId.split('-')[1];
                
                if (entityId === 'board') {
                    const meetings = this.demoData.generateMeetings('board-1');
                    meeting = meetings.find(m => m.id === meetingId);
                } else {
                    const meetings = this.demoData.generateMeetings(this.currentTeam.id);
                    meeting = meetings.find(m => m.id === meetingId);
                }
                
                if (!meeting) return;
                
                this.currentView = 'meeting';
                this.currentMeeting = meeting;
                this.currentMinute = null;
                this.updateBreadcrumb();
                
                const minutes = this.demoData.generateMinutes(meetingId);
                const content = document.getElementById('contentArea');
                let backAction = this.currentBoard ? 'showBoardView' : 'showTeamView';
                let html = `<button class="btn btn-secondary back-btn" data-action="${backAction}">â† æˆ»ã‚‹</button>`;
                html += '<div class="card"><div class="card-title">';
                html += `<span>ğŸ“ ${meeting.name} ã®è­°äº‹éŒ²ä¸€è¦§ï¼ˆ${meeting.date}ï¼‰</span>`;
                html += `<button class="btn btn-primary" data-action="addMinute" data-meeting="${meetingId}">+ è­°äº‹éŒ²ã‚’è¿½åŠ </button>`;
                html += '</div>';
                
                if (minutes.length === 0) {
                    html += '<p>è­°äº‹éŒ²ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>';
                } else {
                    html += '<table class="minutes-table"><thead><tr><th>è­°é¡Œ</th><th>æ‹…å½“è€…</th><th>æœŸæ—¥</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>æ“ä½œ</th></tr></thead><tbody>';
                    
                    minutes.forEach(minute => {
                        const statusMap = {
                            'pending': { class: 'badge-pending', text: 'æœªç€æ‰‹' },
                            'progress': { class: 'badge-progress', text: 'é€²è¡Œä¸­' },
                            'completed': { class: 'badge-completed', text: 'å®Œäº†' },
                            'overdue': { class: 'badge-overdue', text: 'æœŸé™è¶…é' }
                        };
                        const status = statusMap[minute.status];
                        
                        html += `<tr>
                            <td data-action="showMinuteDetail" data-id="${minute.id}" style="cursor:pointer">${minute.topic}</td>
                            <td>${minute.assignee}</td>
                            <td>${minute.dueDate}</td>
                            <td><span class="badge ${status.class}">${status.text}</span></td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn btn-secondary" style="padding:6px 12px" data-action="editMinute" data-id="${minute.id}">ç·¨é›†</button>
                                    <button class="btn btn-danger" style="padding:6px 12px" data-action="archiveMinute" data-id="${minute.id}">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</button>
                                </div>
                            </td>
                        </tr>`;
                    });
                    
                    html += '</tbody></table>';
                }
                
                html += '</div>';
                content.innerHTML = html;
                this.attachMinuteEvents();
            },
            
            attachMinuteEvents() {
                document.querySelectorAll('[data-action="showBoardView"]').forEach(btn => {
                    btn.addEventListener('click', () => this.showBoardView());
                });
                document.querySelectorAll('[data-action="showTeamView"]').forEach(btn => {
                    btn.addEventListener('click', () => this.showTeamView(this.currentTeam.id));
                });
                document.querySelectorAll('[data-action="addMinute"]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const meetingId = btn.getAttribute('data-meeting');
                        this.openAddMinuteModal(meetingId);
                    });
                });
                document.querySelectorAll('[data-action="editMinute"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const minuteId = btn.getAttribute('data-id');
                        this.openEditMinuteModal(minuteId);
                    });
                });
                document.querySelectorAll('[data-action="archiveMinute"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const minuteId = btn.getAttribute('data-id');
                        this.archiveMinute(minuteId);
                    });
                });
                document.querySelectorAll('[data-action="showMinuteDetail"]').forEach(td => {
                    td.addEventListener('click', () => {
                        const minuteId = td.getAttribute('data-id');
                        this.showMinuteDetail(minuteId);
                    });
                });
            },
            
            showMinuteDetail(minuteId) {
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                if (!minute) return;
                
                this.currentView = 'minute';
                this.currentMinute = minute;
                this.updateBreadcrumb();
                
                const statusMap = {
                    'pending': { class: 'badge-pending', text: 'æœªç€æ‰‹' },
                    'progress': { class: 'badge-progress', text: 'é€²è¡Œä¸­' },
                    'completed': { class: 'badge-completed', text: 'å®Œäº†' },
                    'overdue': { class: 'badge-overdue', text: 'æœŸé™è¶…é' }
                };
                const status = statusMap[minute.status];
                
                const content = document.getElementById('contentArea');
                let html = '<button class="btn btn-secondary back-btn" data-action="backToMeeting">â† æˆ»ã‚‹</button>';
                html += '<div class="card"><div class="card-title"><span>ğŸ“„ è­°äº‹éŒ²è©³ç´°</span><div class="action-btns">';
                html += `<button class="btn btn-primary" data-action="editMinute" data-id="${minute.id}">ç·¨é›†</button>`;
                html += `<button class="btn btn-danger" data-action="archiveMinute" data-id="${minute.id}">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</button>`;
                html += '</div></div>';
                
                html += '<div class="detail-section"><div class="detail-section-title">åŸºæœ¬æƒ…å ±</div><div class="detail-grid">';
                html += `<div class="detail-item"><div class="detail-label">è­°é¡Œ</div><div class="detail-value">${minute.topic}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">æ‹…å½“è€…</div><div class="detail-value">${minute.assignee}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">æœŸæ—¥</div><div class="detail-value">${minute.dueDate}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div><div class="detail-value"><span class="badge ${status.class}">${status.text}</span></div></div>`;
                html += '</div></div>';
                
                html += `<div class="detail-section"><div class="detail-section-title">æ±ºå®šäº‹é …</div><div class="detail-content">${minute.decision}</div></div>`;
                html += `<div class="detail-section"><div class="detail-section-title">èª²é¡Œ</div><div class="detail-content">${minute.issue}</div></div>`;
                html += `<div class="detail-section"><div class="detail-section-title">å®Ÿè¡Œå†…å®¹</div><div class="detail-content">${minute.action}</div></div>`;
                html += `<div class="detail-section"><div class="detail-section-title">ç†ç”±ãƒ»èƒŒæ™¯</div><div class="detail-content">${minute.reason}</div></div>`;
                html += '</div>';
                
                content.innerHTML = html;
                document.querySelector('[data-action="backToMeeting"]').addEventListener('click', () => this.showMeetingView(this.currentMeeting.id));
                document.querySelectorAll('[data-action="editMinute"]').forEach(btn => {
                    btn.addEventListener('click', () => this.openEditMinuteModal(btn.getAttribute('data-id')));
                });
                document.querySelectorAll('[data-action="archiveMinute"]').forEach(btn => {
                    btn.addEventListener('click', () => this.archiveMinute(btn.getAttribute('data-id')));
                });
            },
            
            openAddMinuteModal(meetingId) {
                this.editingMinuteId = null;
                document.getElementById('modalTitle').textContent = 'è­°äº‹éŒ²ã‚’è¿½åŠ ';
                document.getElementById('minuteForm').reset();
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + 30);
                document.getElementById('minuteDueDate').value = dueDate.toISOString().split('T')[0];
                document.getElementById('minuteModal').classList.add('active');
            },
            
            openEditMinuteModal(minuteId) {
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                if (!minute) return;
                
                this.editingMinuteId = minuteId;
                document.getElementById('modalTitle').textContent = 'è­°äº‹éŒ²ã‚’ç·¨é›†';
                document.getElementById('minuteTopic').value = minute.topic;
                document.getElementById('minuteDecision').value = minute.decision;
                document.getElementById('minuteIssue').value = minute.issue;
                document.getElementById('minuteAssignee').value = minute.assignee;
                document.getElementById('minuteDueDate').value = minute.dueDate;
                document.getElementById('minuteAction').value = minute.action;
                document.getElementById('minuteReason').value = minute.reason;
                document.getElementById('minuteStatus').value = minute.status;
                document.getElementById('minuteModal').classList.add('active');
            },
            
            closeModal() {
                document.getElementById('minuteModal').classList.remove('active');
                document.getElementById('minuteForm').reset();
                this.editingMinuteId = null;
            },
            
            saveMinute() {
                const formData = {
                    topic: document.getElementById('minuteTopic').value,
                    decision: document.getElementById('minuteDecision').value,
                    issue: document.getElementById('minuteIssue').value,
                    assignee: document.getElementById('minuteAssignee').value,
                    dueDate: document.getElementById('minuteDueDate').value,
                    action: document.getElementById('minuteAction').value,
                    reason: document.getElementById('minuteReason').value,
                    status: document.getElementById('minuteStatus').value
                };
                
                if (this.editingMinuteId) {
                    for (const meetingId in this.minutesData) {
                        const index = this.minutesData[meetingId].findIndex(m => m.id === this.editingMinuteId);
                        if (index !== -1) {
                            this.minutesData[meetingId][index] = { ...this.minutesData[meetingId][index], ...formData };
                            break;
                        }
                    }
                } else {
                    const meetingId = this.currentMeeting.id;
                    if (!this.minutesData[meetingId]) this.minutesData[meetingId] = [];
                    this.minutesData[meetingId].push({
                        id: `minute-${meetingId}-${Date.now()}`,
                        meetingId: meetingId,
                        ...formData,
                        archived: false
                    });
                }
                
                this.closeModal();
                this.showMeetingView(this.currentMeeting.id);
            },
            
            archiveMinute(minuteId) {
                if (!confirm('ã“ã®è­°äº‹éŒ²ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã™ã‹ï¼Ÿ')) return;
                
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute.archived = true;
                        this.archivedMinutes.push(minute);
                        break;
                    }
                }
                
                if (this.currentView === 'meeting') this.showMeetingView(this.currentMeeting.id);
                else if (this.currentView === 'minute') this.showMeetingView(this.currentMeeting.id);
            },
            
            async logout() {
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                this.currentUser = null;
                this.showLoginPage();
            }
        };
        
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = e.target.querySelector('button');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await response.json();
                
                if (response.ok && data.success) {
                    localStorage.setItem('accessToken', data.data.accessToken);
                    localStorage.setItem('refreshToken', data.data.refreshToken);
                    app.currentUser = data.data.user;
                    app.showAlert('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼', 'success');
                    setTimeout(() => app.showMainApp(), 500);
                } else {
                    app.showAlert(`âŒ ${data.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ'}`, 'error');
                }
            } catch (error) {
                app.showAlert(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        });
        
        window.addEventListener('load', () => app.init());
    </script>
</body>
</html>
