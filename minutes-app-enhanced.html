<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - Enhanced</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; min-height: 100vh; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 20px; }
        .user-section { display: flex; align-items: center; gap: 15px; }
        .user-info { text-align: right; font-size: 13px; }
        .logout-btn { padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 5px; cursor: pointer; font-size: 14px; transition: background 0.3s; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        
        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
        
        /* Breadcrumb */
        .breadcrumb { display: flex; gap: 10px; margin-bottom: 20px; font-size: 14px; color: #666; flex-wrap: wrap; }
        .breadcrumb-item { cursor: pointer; transition: color 0.3s; }
        .breadcrumb-item:hover { color: #667eea; }
        .breadcrumb-item.active { color: #333; font-weight: 600; }
        .breadcrumb-separator { color: #999; }
        
        /* Card */
        .card { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 20px; }
        .card-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; justify-content: space-between; }
        
        /* Organization Tree */
        .org-tree { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .org-item { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .org-item:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); }
        .org-item-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .org-item-count { font-size: 13px; opacity: 0.9; }
        
        /* Hierarchical Organization Tree */
        .org-hierarchy { display: flex; flex-direction: column; gap: 25px; }
        .org-level { margin-bottom: 15px; }
        .org-level-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #667eea; text-transform: uppercase; letter-spacing: 0.5px; }
        .org-section { margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .org-section-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #667eea; }
        .sub-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin-top: 15px; padding-left: 20px; }
        
        /* Meeting List */
        .meeting-list { display: flex; flex-direction: column; gap: 12px; }
        .meeting-item { background: #f8f9fa; padding: 18px; border-radius: 8px; cursor: pointer; transition: background 0.2s, transform 0.2s; border-left: 4px solid #667eea; }
        .meeting-item:hover { background: #e9ecef; transform: translateX(5px); }
        .meeting-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .meeting-meta { display: flex; gap: 20px; font-size: 13px; color: #666; flex-wrap: wrap; }
        
        /* Minutes Table */
        .minutes-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .minutes-table th { background: #f8f9fa; padding: 12px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6; }
        .minutes-table td { padding: 12px; border-bottom: 1px solid #e9ecef; }
        .minutes-table tr { cursor: pointer; transition: background 0.2s; }
        .minutes-table tbody tr:hover { background: #f8f9fa; }
        
        /* Status Badge */
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-pending { background: #fff3cd; color: #856404; }
        .badge-progress { background: #cfe2ff; color: #084298; }
        .badge-completed { background: #d1e7dd; color: #0f5132; }
        .badge-overdue { background: #f8d7da; color: #842029; }
        .badge-archived { background: #6c757d; color: white; }
        
        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.3s; font-weight: 600; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; }
        .action-btns { display: flex; gap: 10px; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 10px; padding: 30px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; font-family: inherit; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        
        /* Detail View */
        .detail-section { margin-bottom: 25px; }
        .detail-section-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 10px; text-transform: uppercase; }
        .detail-content { background: #f8f9fa; padding: 15px; border-radius: 6px; line-height: 1.6; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .detail-item { display: flex; flex-direction: column; gap: 5px; }
        .detail-label { font-size: 12px; color: #666; font-weight: 600; }
        .detail-value { font-size: 14px; color: #333; }
        
        /* Login Page */
        .login-container { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; }
        .login-box { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
        .login-title { text-align: center; font-size: 24px; margin-bottom: 10px; color: #333; }
        .login-subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
        .login-btn { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        .login-btn:hover:not(:disabled) { background: #5568d3; }
        .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .alert { padding: 12px; border-radius: 5px; margin-bottom: 20px; font-size: 14px; }
        .alert-error { background: #fee; border: 1px solid #fcc; color: #c33; }
        .alert-success { background: #efe; border: 1px solid #cfc; color: #3c3; }
        .demo-info { text-align: center; margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; font-size: 13px; color: #666; }
        .demo-info code { background: #e0e0e0; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 48px; margin-bottom: 15px; }
        
        /* Editable Table */
        .editable-table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        .editable-table th { background-color: #4A90E2; color: white; padding: 12px; border: 1px solid #ddd; text-align: left; font-weight: 600; }
        .editable-table td { padding: 8px; border: 1px solid #ddd; }
        .editable-cell { cursor: text; transition: background-color 0.2s; }
        .editable-cell:hover { background-color: #f0f8ff; }
        .editable-cell:focus { outline: 2px solid #4A90E2; outline-offset: -2px; background-color: #fff; }
        .editable-row:nth-child(even) { background-color: #f9f9f9; }
        .btn-sm { padding: 4px 8px; font-size: 12px; }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1 class="login-title">ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="login-subtitle">å…¨ç¤¾ãƒŠãƒ¬ãƒƒã‚¸å…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email" value="admin@example.com" required>
                </div>
                <div class="form-group">
                    <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" value="Admin@123" required>
                </div>
                <button type="submit" class="login-btn" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </form>
            <div class="demo-info">
                <p><strong>ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</strong></p>
                <p><code>admin@example.com</code> / <code>Admin@123</code></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="header">
            <h1>ğŸ“‹ ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div class="user-section">
                <div class="user-info">
                    <div id="headerUserName"></div>
                    <div id="headerUserDept"></div>
                </div>
                <button class="btn btn-warning" onclick="app.resetAllData()" style="margin-right: 10px; padding: 8px 16px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
                <button class="logout-btn" onclick="app.logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>

        <div class="container">
            <div class="breadcrumb" id="breadcrumb"></div>
            <div id="contentArea"></div>
        </div>
    </div>

    <!-- Edit/Add Minute Modal -->
    <div id="minuteModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">è­°äº‹éŒ²ã‚’è¿½åŠ </h2>
            <form id="minuteForm">
                <div class="form-group">
                    <label for="minuteMeetingName">ä¼šè­°å *</label>
                    <input type="text" id="minuteMeetingName" required>
                </div>
                <div class="form-group">
                    <label for="minuteSubtitle">ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="minuteSubtitle">
                </div>
                <div class="form-group">
                    <label for="minuteMeetingDate">ä¼šè­°é–‹å‚¬æ—¥ *</label>
                    <input type="date" id="minuteMeetingDate" required>
                </div>
                <div class="form-group">
                    <label for="minuteParticipants">ä¼šè­°å‚åŠ è€… *</label>
                    <textarea id="minuteParticipants" required placeholder="å‚åŠ è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§30åï¼‰" rows="4"></textarea>
                    <small style="color: #666;">â€»æ”¹è¡Œã¾ãŸã¯ã€ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                </div>
                <div class="form-group">
                    <label for="minuteFacilitator">ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼ *</label>
                    <input type="text" id="minuteFacilitator" required>
                </div>
                <div class="form-group">
                    <label for="minuteNotes">å‚™è€ƒ</label>
                    <textarea id="minuteNotes" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="minuteStatus">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ *</label>
                    <select id="minuteStatus" required>
                        <option value="pending">æœªç€æ‰‹</option>
                        <option value="progress">é€²è¡Œä¸­</option>
                        <option value="completed">å®Œäº†</option>
                        <option value="overdue">æœŸé™è¶…é</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        console.log('=== Script Loading Started ===');
        const API_BASE_URL = 'https://3000-iyibqicmi9poa0s21x8jw-c81df28e.sandbox.novita.ai/api';
        
        const app = {
            currentUser: null,
            currentView: 'organization',
            currentBoard: null,
            currentDepartment: null,
            currentTeam: null,
            currentMeeting: null,
            currentMinute: null,
            editingMinuteId: null,
            demoData: null,
            meetingsData: {}, // Store meetings data by entityId
            minutesData: {}, // Store minutes data by meetingId
            archivedMinutes: [], // Store archived minutes
            
            init() {
                this.loadDemoData();
                this.loadFromLocalStorage(); // Load data from localStorage
                this.checkAuth();
                this.setupEventListeners();
            },
            
            loadFromLocalStorage() {
                const savedMeetings = localStorage.getItem('meetingsData');
                const savedMinutes = localStorage.getItem('minutesData');
                
                if (savedMeetings) {
                    this.meetingsData = JSON.parse(savedMeetings);
                    console.log('Loaded meetings from localStorage:', this.meetingsData);
                }
                
                if (savedMinutes) {
                    this.minutesData = JSON.parse(savedMinutes);
                    console.log('Loaded minutes from localStorage:', this.minutesData);
                }
            },
            
            saveToLocalStorage() {
                localStorage.setItem('meetingsData', JSON.stringify(this.meetingsData));
                localStorage.setItem('minutesData', JSON.stringify(this.minutesData));
                console.log('Saved to localStorage');
            },
            
            resetAllData() {
                if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                    this.meetingsData = {};
                    this.minutesData = {};
                    this.archivedMinutes = [];
                    localStorage.removeItem('meetingsData');
                    localStorage.removeItem('minutesData');
                    alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
                    location.reload();
                }
            },
            
            setupEventListeners() {
                console.log('=== setupEventListeners called ===');
                
                // Minute form listener
                const minuteForm = document.getElementById('minuteForm');
                if (minuteForm) {
                    minuteForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveMinute();
                    });
                    console.log('âœ… minuteForm listener added');
                } else {
                    console.error('âŒ minuteForm not found');
                }
                
                // Content area listener
                const contentArea = document.getElementById('contentArea');
                if (!contentArea) {
                    console.error('âŒ contentArea not found!');
                    return;
                }
                
                console.log('âœ… contentArea found, adding click listener...');
                
                // ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²: contentAreaå†…ã®ã‚¯ãƒªãƒƒã‚¯ã‚’ç›£è¦–
                // â˜… ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦thisã‚’ãƒã‚¤ãƒ³ãƒ‰
                contentArea.addEventListener('click', (e) => {
                    console.log('contentArea clicked!', e.target);
                    
                    // ä¼šè­°ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯
                    const meetingItem = e.target.closest('.meeting-item');
                    if (meetingItem) {
                        console.log('Meeting item found:', meetingItem);
                        console.log('Meeting ID:', meetingItem.dataset.meetingId);
                        
                        if (meetingItem.dataset.meetingId) {
                            console.log('âœ… Calling showMeetingView with:', meetingItem.dataset.meetingId);
                            console.log('this:', this);
                            console.log('this.showMeetingView:', this.showMeetingView);
                            
                            try {
                                this.showMeetingView(meetingItem.dataset.meetingId);
                            } catch (error) {
                                console.error('âŒ Error calling showMeetingView:', error);
                            }
                            return;
                        } else {
                            console.error('âŒ No meeting ID found on meeting item');
                        }
                    }
                    
                    // çµ„ç¹”ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¯ãƒªãƒƒã‚¯ï¼ˆéƒ¨é–€åï¼‰
                    const sectionTitle = e.target.closest('.org-section-title');
                    if (sectionTitle && sectionTitle.dataset.deptId) {
                        console.log('Department section clicked via event delegation:', sectionTitle.dataset.deptId);
                        this.showDepartmentView(sectionTitle.dataset.deptId);
                        return;
                    }
                    
                    // çµ„ç¹”ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯
                    const orgItem = e.target.closest('.org-item');
                    if (orgItem) {
                        if (orgItem.dataset.boardId) {
                            console.log('Board clicked via event delegation');
                            this.showBoardView();
                        } else if (orgItem.dataset.deptId) {
                            console.log('Department clicked via event delegation:', orgItem.dataset.deptId);
                            this.showDepartmentView(orgItem.dataset.deptId);
                        } else if (orgItem.dataset.teamId) {
                            console.log('Team clicked via event delegation:', orgItem.dataset.teamId);
                            this.showTeamView(orgItem.dataset.teamId);
                        }
                        return;
                    }
                    
                    console.log('No matching element found for click');
                });
                
                console.log('âœ… contentArea click listener added successfully');
            },
            
            loadDemoData() {
                this.demoData = {
                    // çµŒå–¶ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰ãƒ¬ãƒ™ãƒ«
                    board: {
                        id: 'board-1',
                        name: 'çµŒå–¶ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰',
                        meetingCount: 12
                    },
                    
                    departments: [
                        {
                            id: 'dept-1',
                            name: 'å–¶æ¥­éƒ¨ï¼ˆå–¶æ¥­å‚µæ¨©ç®¡ç†éƒ¨ï¼‰',
                            teams: [
                                { id: 'team-1-1', name: 'æ±æ—¥æœ¬', meetingCount: 8 },
                                { id: 'team-1-2', name: 'è¥¿æ—¥æœ¬', meetingCount: 6 }
                            ]
                        },
                        {
                            id: 'dept-2',
                            name: 'å‚µæ¨©ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-2-1', name: 'ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ã‚¹ã‚¯', meetingCount: 5 },
                                { id: 'team-2-2', name: 'ã‚¨ãƒªã‚¢æ‹…å½“æ±â‘ ', meetingCount: 4 },
                                { id: 'team-2-3', name: 'ã‚¨ãƒªã‚¢æ‹…å½“æ±â‘¡', meetingCount: 3 },
                                { id: 'team-2-4', name: 'ã‚¨ãƒªã‚¢æ‹…å½“è¥¿â‘ ', meetingCount: 5 },
                                { id: 'team-2-5', name: 'ã‚¨ãƒªã‚¢æ‹…å½“è¥¿â‘¡', meetingCount: 4 },
                                { id: 'team-2-6', name: 'æ³•å‹™', meetingCount: 7 },
                                { id: 'team-2-7', name: 'æ±‚å„Ÿ', meetingCount: 3 },
                                { id: 'team-2-8', name: 'ã‚µãƒãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯é€šå¸¸äº‹å‹™ãƒãƒ¼ãƒ ', meetingCount: 4 },
                                { id: 'team-2-9', name: 'ã‚µãƒãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ä¿è¨¼å®Ÿè¡Œãƒãƒ¼ãƒ ', meetingCount: 3 }
                            ]
                        },
                        {
                            id: 'dept-3',
                            name: 'å¯©æŸ»å¥‘ç´„ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-3-1', name: 'å¯©æŸ»', meetingCount: 6 },
                                { id: 'team-3-2', name: 'å¥‘ç´„ç®¡ç†', meetingCount: 5 },
                                { id: 'team-3-3', name: 'å›½éš›ãƒãƒ¼ãƒ ', meetingCount: 4 }
                            ]
                        },
                        {
                            id: 'dept-4',
                            name: 'ã‚·ã‚¹ãƒ†ãƒ éƒ¨',
                            teams: [
                                { id: 'team-4-1', name: 'ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ', meetingCount: 7 },
                                { id: 'team-4-2', name: 'é–‹ç™ºãƒãƒ¼ãƒ ', meetingCount: 9 }
                            ]
                        },
                        {
                            id: 'dept-5',
                            name: 'äººäº‹ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-5-1', name: 'çµŒç†', meetingCount: 5 },
                                { id: 'team-5-2', name: 'äººäº‹', meetingCount: 6 },
                                { id: 'team-5-3', name: 'ç®¡ç†', meetingCount: 4 }
                            ]
                        }
                    ],
                    
                    generateMeetings(entityId) {
                        // LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
                        if (window.app && window.app.meetingsData && window.app.meetingsData[entityId]) {
                            return window.app.meetingsData[entityId].sort((a, b) => new Date(b.date) - new Date(a.date));
                        }
                        
                        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºé…åˆ—ã‚’è¿”ã™
                        return [];
                    },
                    
                    generateMinutes(meetingId) {
                        // LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
                        if (window.app && window.app.minutesData && window.app.minutesData[meetingId]) {
                            return window.app.minutesData[meetingId].filter(m => !m.archived);
                        }
                        
                        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºé…åˆ—ã‚’è¿”ã™
                        return [];
                    }
                };
            },
            
            async checkAuth() {
                const token = localStorage.getItem('accessToken');
                if (token) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/auth/me`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            if (data.success) {
                                this.currentUser = data.data;
                                this.showMainApp();
                                return;
                            }
                        }
                    } catch (error) {
                        console.error('Auto-login failed:', error);
                    }
                }
                this.showLoginPage();
            },
            
            showLoginPage() {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            },
            
            showMainApp() {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('headerUserName').textContent = this.currentUser.name;
                
                // â˜… çµ„ç¹”ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºï¼ˆã“ã‚ŒãŒãªã„ã¨ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼ï¼‰
                this.showOrganizationView();
                document.getElementById('headerUserDept').textContent = 
                    `${this.currentUser.department.name} / ${this.currentUser.team.name}`;
                this.showOrganizationView();
            },
            
            showAlert(message, type = 'error') {
                const alertDiv = document.getElementById('loginAlert');
                alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
                setTimeout(() => alertDiv.innerHTML = '', 3000);
            },
            
            updateBreadcrumb() {
                const breadcrumb = document.getElementById('breadcrumb');
                let html = '<span class="breadcrumb-item" onclick="app.showOrganizationView()">ğŸ¢ å…¨çµ„ç¹”</span>';
                
                if (this.currentBoard) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showBoardView()">${this.currentBoard.name}</span>`;
                }
                
                if (this.currentDepartment) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showDepartmentView('${this.currentDepartment.id}')">${this.currentDepartment.name}</span>`;
                }
                
                if (this.currentTeam) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showTeamView('${this.currentTeam.id}')">${this.currentTeam.name}</span>`;
                }
                
                if (this.currentMeeting) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showMeetingView('${this.currentMeeting.id}')">${this.currentMeeting.name}</span>`;
                }
                
                if (this.currentMinute) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item active">${this.currentMinute.topic}</span>`;
                }
                
                breadcrumb.innerHTML = html;
            },
            
            showOrganizationView() {
                this.currentView = 'organization';
                this.currentBoard = null;
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                let html = '<div class="card">';
                html += '<div class="card-title">ğŸ¢ çµ„ç¹”éšå±¤ä¸€è¦§ - å…¨ç¤¾ã®ä¼šè­°ãƒ»è­°äº‹éŒ²ã‚’ç®¡ç†</div>';
                html += '<div class="org-hierarchy">';
                
                // Board level
                html += '<div class="org-level">';
                html += `<div class="org-level-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ›ï¸ çµŒå–¶å±¤ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰</span>
                    <button class="btn btn-success btn-sm" onclick="app.addBoard()" style="padding: 6px 12px; font-size: 13px;">+ ãƒœãƒ¼ãƒ‰è¿½åŠ </button>
                </div>`;
                html += `
                    <div class="org-item" data-board-id="${this.demoData.board.id}" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); max-width: 350px; position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <div class="org-item-title">ğŸ‘” ${this.demoData.board.name}</div>
                                <div class="org-item-count">${this.demoData.board.meetingCount}ä»¶ã®çµŒå–¶ä¼šè­°</div>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-sm" onclick="app.editBoard('${this.demoData.board.id}')" style="padding: 4px 8px; font-size: 12px; background: rgba(255,255,255,0.9); border: none; border-radius: 4px;">âœï¸</button>
                                <button class="btn btn-sm" onclick="app.deleteBoard('${this.demoData.board.id}')" style="padding: 4px 8px; font-size: 12px; background: rgba(255,255,255,0.9); border: none; border-radius: 4px;">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                `;
                html += '</div>';
                
                // Department and Team levels
                html += '<div class="org-level">';
                html += `<div class="org-level-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ¢ éƒ¨é–€ãƒ»ãƒãƒ¼ãƒ ä¸€è¦§</span>
                    <button class="btn btn-success btn-sm" onclick="app.addDepartment()" style="padding: 6px 12px; font-size: 13px;">+ éƒ¨é–€è¿½åŠ </button>
                </div>`;
                
                this.demoData.departments.forEach(dept => {
                    const totalMeetings = dept.teams.reduce((sum, team) => sum + team.meetingCount, 0);
                    html += '<div class="org-section">';
                    html += `<div class="org-section-title" data-dept-id="${dept.id}" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                        <span>${dept.name} <span style="font-size: 13px; color: #666; font-weight: normal;">(${dept.teams.length}ãƒãƒ¼ãƒ ãƒ»${totalMeetings}ä»¶ã®ä¼šè­°)</span></span>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-sm" onclick="event.stopPropagation(); app.addTeam('${dept.id}')" style="padding: 4px 8px; font-size: 12px; background: #28a745; color: white; border: none; border-radius: 4px;">+ ãƒãƒ¼ãƒ </button>
                            <button class="btn btn-sm" onclick="event.stopPropagation(); app.editDepartment('${dept.id}')" style="padding: 4px 8px; font-size: 12px; background: #6c757d; color: white; border: none; border-radius: 4px;">âœï¸</button>
                            <button class="btn btn-sm" onclick="event.stopPropagation(); app.deleteDepartment('${dept.id}')" style="padding: 4px 8px; font-size: 12px; background: #dc3545; color: white; border: none; border-radius: 4px; opacity: 0.7;">ğŸ—‘ï¸</button>
                        </div>
                    </div>`;
                    html += '<div class="sub-items">';
                    
                    dept.teams.forEach(team => {
                        html += `
                            <div class="org-item" data-team-id="${team.id}" style="padding: 15px; position: relative;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div class="org-item-title" style="font-size: 14px;">${team.name}</div>
                                        <div class="org-item-count">${team.meetingCount}ä»¶ã®ä¼šè­°</div>
                                    </div>
                                    <div style="display: flex; gap: 5px;">
                                        <button class="btn btn-sm" onclick="event.stopPropagation(); app.editTeam('${team.id}')" style="padding: 4px 8px; font-size: 11px; background: #6c757d; color: white; border: none; border-radius: 4px;">âœï¸</button>
                                        <button class="btn btn-sm" onclick="event.stopPropagation(); app.deleteTeam('${team.id}')" style="padding: 4px 8px; font-size: 11px; background: #dc3545; color: white; border: none; border-radius: 4px; opacity: 0.7;">ğŸ—‘ï¸</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                });
                
                html += '</div></div></div>';
                content.innerHTML = html;
            },
            
            showBoardView() {
                this.currentView = 'board';
                this.currentBoard = this.demoData.board;
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const meetings = this.demoData.generateMeetings('board-1');
                
                const content = document.getElementById('contentArea');
                let html = '<button class="btn btn-secondary back-btn" onclick="app.showOrganizationView()">â† æˆ»ã‚‹</button>';
                html += '<div class="card">';
                html += `<div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“… ${this.currentBoard.name} ã®ä¼šè­°ä¸€è¦§</span>
                    <button class="btn btn-success" onclick="app.openAddMeetingModal('board-1')">+ ä¼šè­°åç§°è¿½åŠ </button>
                </div>`;
                
                // æ”¹å–„ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼ˆè©³ç´°ã‚’å¼·èª¿ã€ç·¨é›†ã‚’ä¸­ç¨‹åº¦ã€å‰Šé™¤ã‚’æ§ãˆã‚ã«ï¼‰
                html += '<table class="minutes-table" style="width: 100%; margin-top: 15px;">';
                html += `
                    <thead>
                        <tr>
                            <th style="width: 60%; padding: 12px;">ä¼šè­°åç§°</th>
                            <th style="width: 40%; padding: 12px; text-align: right;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                `;
                
                meetings.forEach((meeting, index) => {
                    html += `
                        <tr style="border-bottom: 1px solid #e0e0e0;">
                            <td style="padding: 12px; font-size: 15px; font-weight: 500;">${meeting.name}</td>
                            <td style="padding: 8px 12px; text-align: right;">
                                <button class="btn btn-primary detail-btn" data-meeting-id="${meeting.id}" data-btn-index="${index}" 
                                    style="padding: 10px 24px; font-size: 15px; font-weight: 600; margin-right: 8px; border-radius: 6px;">
                                    ğŸ“‹ è©³ç´°
                                </button>
                                <button class="btn btn-secondary edit-meeting-btn" data-meeting-id="${meeting.id}" 
                                    style="padding: 8px 16px; font-size: 14px; margin-right: 8px; border-radius: 6px; background: #6c757d; border: none;">
                                    âœï¸ ç·¨é›†
                                </button>
                                <button class="btn btn-danger delete-meeting-btn" data-meeting-id="${meeting.id}" 
                                    style="padding: 6px 10px; font-size: 13px; border-radius: 6px; background: #dc3545; border: none; opacity: 0.7;" 
                                    title="å‰Šé™¤">
                                    ğŸ—‘ï¸
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                html += '</div>';
                content.innerHTML = html;
                
                // â˜… DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                setTimeout(() => {
                    // è©³ç´°ãƒœã‚¿ãƒ³
                    const detailButtons = content.querySelectorAll('.detail-btn');
                    console.log(`Found ${detailButtons.length} detail buttons`);
                    
                    detailButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const meetingId = button.getAttribute('data-meeting-id');
                            console.log('Detail button clicked:', meetingId);
                            this.showMeetingView(meetingId);
                        });
                    });
                    
                    // ç·¨é›†ãƒœã‚¿ãƒ³
                    const editButtons = content.querySelectorAll('.edit-meeting-btn');
                    editButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const meetingId = button.getAttribute('data-meeting-id');
                            this.openEditMeetingModal(meetingId);
                        });
                    });
                    
                    // å‰Šé™¤ãƒœã‚¿ãƒ³
                    const deleteButtons = content.querySelectorAll('.delete-meeting-btn');
                    deleteButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const meetingId = button.getAttribute('data-meeting-id');
                            this.deleteMeeting(meetingId);
                        });
                    });
                    
                    console.log('âœ… All button handlers attached');
                }, 100);
            },
            
            showDepartmentView(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) return;
                
                this.currentView = 'department';
                this.currentBoard = null;
                this.currentDepartment = dept;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                let html = '<button class="btn btn-secondary back-btn" onclick="app.showOrganizationView()">â† æˆ»ã‚‹</button>';
                html += '<div class="card">';
                html += `<div class="card-title">ğŸ‘¥ ${dept.name} ã®ãƒãƒ¼ãƒ ä¸€è¦§</div>`;
                html += '<div class="org-tree">';
                
                dept.teams.forEach(team => {
                    html += `
                        <div class="org-item" onclick="app.showTeamView('${team.id}')">
                            <div class="org-item-title">${team.name}</div>
                            <div class="org-item-count">${team.meetingCount}ä»¶ã®ä¼šè­°</div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
                content.innerHTML = html;
            },
            
            showTeamView(teamId) {
                let team = null;
                for (const dept of this.demoData.departments) {
                    team = dept.teams.find(t => t.id === teamId);
                    if (team) {
                        this.currentDepartment = dept;
                        break;
                    }
                }
                if (!team) return;
                
                this.currentView = 'team';
                this.currentBoard = null;
                this.currentTeam = team;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const meetings = this.demoData.generateMeetings(teamId);
                
                const content = document.getElementById('contentArea');
                let html = `<button class="btn btn-secondary back-btn" onclick="app.showDepartmentView('${this.currentDepartment.id}')">â† æˆ»ã‚‹</button>`;
                html += '<div class="card">';
                html += `<div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“… ${team.name} ã®ä¼šè­°ä¸€è¦§</span>
                    <button class="btn btn-success" onclick="app.openAddMeetingModal('${teamId}')">+ ä¼šè­°åç§°è¿½åŠ </button>
                </div>`;
                
                if (meetings.length === 0) {
                    html += '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>ä¼šè­°ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p></div>';
                } else {
                    // æ”¹å–„ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼ˆè©³ç´°ã‚’å¼·èª¿ã€ç·¨é›†ã‚’ä¸­ç¨‹åº¦ã€å‰Šé™¤ã‚’æ§ãˆã‚ã«ï¼‰
                    html += '<table class="minutes-table" style="width: 100%; margin-top: 15px;">';
                    html += `
                        <thead>
                            <tr>
                                <th style="width: 60%; padding: 12px;">ä¼šè­°åç§°</th>
                                <th style="width: 40%; padding: 12px; text-align: right;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;
                    
                    meetings.forEach((meeting, index) => {
                        html += `
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px; font-size: 15px; font-weight: 500;">${meeting.name}</td>
                                <td style="padding: 8px 12px; text-align: right;">
                                    <button class="btn btn-primary detail-btn" data-meeting-id="${meeting.id}" data-btn-index="${index}" 
                                        style="padding: 10px 24px; font-size: 15px; font-weight: 600; margin-right: 8px; border-radius: 6px;">
                                        ğŸ“‹ è©³ç´°
                                    </button>
                                    <button class="btn btn-secondary edit-meeting-btn" data-meeting-id="${meeting.id}" 
                                        style="padding: 8px 16px; font-size: 14px; margin-right: 8px; border-radius: 6px; background: #6c757d; border: none;">
                                        âœï¸ ç·¨é›†
                                    </button>
                                    <button class="btn btn-danger delete-meeting-btn" data-meeting-id="${meeting.id}" 
                                        style="padding: 6px 10px; font-size: 13px; border-radius: 6px; background: #dc3545; border: none; opacity: 0.7;" 
                                        title="å‰Šé™¤">
                                        ğŸ—‘ï¸
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                }
                
                html += '</div>';
                content.innerHTML = html;
                
                // â˜… DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                if (meetings.length > 0) {
                    setTimeout(() => {
                        // è©³ç´°ãƒœã‚¿ãƒ³
                        const detailButtons = content.querySelectorAll('.detail-btn');
                        console.log(`Found ${detailButtons.length} detail buttons in team view`);
                        
                        detailButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const meetingId = button.getAttribute('data-meeting-id');
                                console.log('Detail button clicked:', meetingId);
                                this.showMeetingView(meetingId);
                            });
                        });
                        
                        // ç·¨é›†ãƒœã‚¿ãƒ³
                        const editButtons = content.querySelectorAll('.edit-meeting-btn');
                        editButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const meetingId = button.getAttribute('data-meeting-id');
                                this.openEditMeetingModal(meetingId);
                            });
                        });
                        
                        // å‰Šé™¤ãƒœã‚¿ãƒ³
                        const deleteButtons = content.querySelectorAll('.delete-meeting-btn');
                        deleteButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const meetingId = button.getAttribute('data-meeting-id');
                                this.deleteMeeting(meetingId);
                            });
                        });
                        
                        console.log('âœ… All button handlers attached in team view');
                    }, 100);
                }
            },
            
            showMeetingView(meetingId) {
                console.log('showMeetingView called with:', meetingId);
                
                // Find meeting
                let meeting = null;
                
                // Check if it's a board meeting (format: meeting-board-1-0)
                if (meetingId.includes('board')) {
                    console.log('Detected board meeting');
                    const meetings = this.demoData.generateMeetings('board-1');
                    meeting = meetings.find(m => m.id === meetingId);
                    
                    if (meeting) {
                        this.currentBoard = this.demoData.board;
                        this.currentDepartment = null;
                        this.currentTeam = null;
                    }
                } else {
                    // Find team from meetingId
                    console.log('Searching for team meeting');
                    let foundTeam = null;
                    for (const dept of this.demoData.departments) {
                        const team = dept.teams.find(t => meetingId.includes(t.id));
                        if (team) {
                            foundTeam = team;
                            this.currentTeam = team;
                            this.currentDepartment = dept;
                            this.currentBoard = null;
                            break;
                        }
                    }
                    
                    if (foundTeam) {
                        const meetings = this.demoData.generateMeetings(foundTeam.id);
                        meeting = meetings.find(m => m.id === meetingId);
                    }
                }
                
                if (!meeting) {
                    console.error('Meeting not found:', meetingId);
                    alert('ä¼šè­°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + meetingId);
                    return;
                }
                
                console.log('Meeting found:', meeting);
                
                this.currentView = 'meeting';
                this.currentMeeting = meeting;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const minutes = this.demoData.generateMinutes(meetingId);
                
                const content = document.getElementById('contentArea');
                
                // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆthisã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ï¼‰
                let backAction;
                if (this.currentBoard) {
                    backAction = 'app.showBoardView()';
                } else if (this.currentTeam && this.currentTeam.id) {
                    backAction = `app.showTeamView('${this.currentTeam.id}')`;
                } else {
                    backAction = 'app.showOrganizationView()';
                }
                
                let html = `<button class="btn btn-secondary back-btn" onclick="${backAction}">â† æˆ»ã‚‹</button>`;
                html += '<div class="card">';
                html += `<div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“ ${meeting.name} ã®è­°äº‹éŒ²ä¸€è¦§ï¼ˆ${meeting.date}ï¼‰</span>
                    <button class="btn btn-success" onclick="app.openAddMinuteModal('${meetingId}')">+ è­°äº‹éŒ²ã‚’è¿½åŠ </button>
                </div>`;
                
                if (minutes.length === 0) {
                    html += '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>è­°äº‹éŒ²ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p></div>';
                } else {
                    // æ”¹å–„ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼ˆã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’1è¡Œã§è¡¨ç¤ºï¼‰
                    html += '<table class="minutes-table" style="width: 100%; margin-top: 15px;">';
                    html += `
                        <thead>
                            <tr>
                                <th style="width: 15%; padding: 12px;">ä¼šè­°å</th>
                                <th style="width: 12%; padding: 12px;">ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</th>
                                <th style="width: 10%; padding: 12px;">é–‹å‚¬æ—¥</th>
                                <th style="width: 15%; padding: 12px;">å‚åŠ è€…</th>
                                <th style="width: 10%; padding: 12px;">ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼</th>
                                <th style="width: 10%; padding: 12px;">å‚™è€ƒ</th>
                                <th style="width: 10%; padding: 12px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th style="width: 18%; padding: 12px; text-align: right;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;
                    
                    const statusMap = {
                        'pending': { class: 'badge-pending', text: 'æœªç€æ‰‹' },
                        'progress': { class: 'badge-progress', text: 'é€²è¡Œä¸­' },
                        'completed': { class: 'badge-completed', text: 'å®Œäº†' },
                        'overdue': { class: 'badge-overdue', text: 'æœŸé™è¶…é' }
                    };
                    
                    minutes.forEach((minute, index) => {
                        const status = statusMap[minute.status] || statusMap.pending;
                        const participantsList = (minute.participants || '').split(/[\n,]/).map(p => p.trim()).filter(p => p).slice(0, 3).join(', ');
                        const participantsDisplay = participantsList.length > 30 ? participantsList.substring(0, 30) + '...' : participantsList;
                        
                        html += `
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <td style="padding: 12px; font-size: 14px;">${minute.meetingName || ''}</td>
                                <td style="padding: 12px; font-size: 14px;">${minute.subtitle || ''}</td>
                                <td style="padding: 12px; font-size: 14px;">${minute.meetingDate || ''}</td>
                                <td style="padding: 12px; font-size: 13px;" title="${minute.participants || ''}">${participantsDisplay}</td>
                                <td style="padding: 12px; font-size: 14px;">${minute.facilitator || ''}</td>
                                <td style="padding: 12px; font-size: 13px;">${(minute.notes || '').substring(0, 20)}${(minute.notes || '').length > 20 ? '...' : ''}</td>
                                <td style="padding: 12px;">
                                    <span class="badge ${status.class}" style="padding: 4px 8px; border-radius: 4px; font-size: 12px;">${status.text}</span>
                                </td>
                                <td style="padding: 8px 12px; text-align: right;">
                                    <button class="btn btn-primary detail-minute-btn" data-minute-id="${minute.id}" 
                                        style="padding: 10px 24px; font-size: 15px; font-weight: 600; margin-right: 8px; border-radius: 6px;">
                                        ğŸ“‹ è©³ç´°
                                    </button>
                                    <button class="btn btn-secondary edit-minute-btn" data-minute-id="${minute.id}" 
                                        style="padding: 8px 16px; font-size: 14px; margin-right: 8px; border-radius: 6px; background: #6c757d; border: none;">
                                        âœï¸ ç·¨é›†
                                    </button>
                                    <button class="btn btn-danger delete-minute-btn" data-minute-id="${minute.id}" 
                                        style="padding: 6px 10px; font-size: 13px; border-radius: 6px; background: #dc3545; border: none; opacity: 0.7;" 
                                        title="å‰Šé™¤">
                                        ğŸ—‘ï¸
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                }
                
                html += '</div>';
                content.innerHTML = html;
                
                // â˜… DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                if (minutes.length > 0) {
                    setTimeout(() => {
                        // è©³ç´°ãƒœã‚¿ãƒ³
                        const detailButtons = content.querySelectorAll('.detail-minute-btn');
                        detailButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const minuteId = button.getAttribute('data-minute-id');
                                this.showMinuteDetailTable(minuteId);
                            });
                        });
                        
                        // ç·¨é›†ãƒœã‚¿ãƒ³
                        const editButtons = content.querySelectorAll('.edit-minute-btn');
                        editButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const minuteId = button.getAttribute('data-minute-id');
                                this.openEditMinuteModal(minuteId);
                            });
                        });
                        
                        // å‰Šé™¤ãƒœã‚¿ãƒ³
                        const deleteButtons = content.querySelectorAll('.delete-minute-btn');
                        deleteButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const minuteId = button.getAttribute('data-minute-id');
                                this.archiveMinute(minuteId);
                            });
                        });
                        
                        console.log('âœ… All minute button handlers attached');
                    }, 100);
                }
            },
            
            openAddMeetingModal(entityId) {
                const meetingName = prompt('æ–°ã—ã„ä¼šè­°åç§°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (!meetingName || meetingName.trim() === '') {
                    return;
                }
                
                // æ–°ã—ã„ä¼šè­°ã‚’ä½œæˆ
                const newMeeting = {
                    id: `meeting-${entityId}-${Date.now()}`,
                    entityId: entityId,
                    name: meetingName.trim(),
                    date: new Date().toISOString().split('T')[0],
                    minutesCount: 0,
                    participants: 0
                };
                
                // LocalStorageã«ä¿å­˜
                if (!this.meetingsData[entityId]) {
                    this.meetingsData[entityId] = [];
                }
                this.meetingsData[entityId].push(newMeeting);
                this.saveToLocalStorage();
                
                alert(`âœ… ä¼šè­°ã€Œ${meetingName}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
                
                // ç”»é¢ã‚’å†è¡¨ç¤º
                if (entityId === 'board-1') {
                    this.showBoardView();
                } else {
                    this.showTeamView(entityId);
                }
            },
            
            openEditMeetingModal(meetingId) {
                // ä¼šè­°ã‚’æ¤œç´¢
                let meeting = null;
                let entityId = null;
                
                for (const [key, meetings] of Object.entries(this.meetingsData)) {
                    meeting = meetings.find(m => m.id === meetingId);
                    if (meeting) {
                        entityId = key;
                        break;
                    }
                }
                
                if (!meeting) {
                    alert('âŒ ä¼šè­°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('ä¼šè­°åç§°ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ï¼š', meeting.name);
                if (!newName || newName.trim() === '') {
                    return;
                }
                
                meeting.name = newName.trim();
                this.saveToLocalStorage();
                alert(`âœ… ä¼šè­°åç§°ã‚’ã€Œ${newName}ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ`);
                
                // ç”»é¢ã‚’å†è¡¨ç¤º
                if (this.currentBoard) {
                    this.showBoardView();
                } else if (this.currentTeam) {
                    this.showTeamView(this.currentTeam.id);
                }
            },
            
            deleteMeeting(meetingId) {
                // è­°äº‹éŒ²ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (this.minutesData[meetingId]) {
                    const minutes = this.minutesData[meetingId].filter(m => !m.archived);
                    if (minutes.length > 0) {
                        alert(`âŒ ã“ã®ä¼šè­°ã«ã¯${minutes.length}ä»¶ã®è­°äº‹éŒ²ãŒã‚ã‚‹ãŸã‚ã€å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚\nå…ˆã«è­°äº‹éŒ²ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚`);
                        return;
                    }
                }
                
                // ä¼šè­°ã‚’æ¤œç´¢ã—ã¦å‰Šé™¤
                let meeting = null;
                let entityId = null;
                
                for (const [key, meetings] of Object.entries(this.meetingsData)) {
                    const index = meetings.findIndex(m => m.id === meetingId);
                    if (index !== -1) {
                        meeting = meetings[index];
                        entityId = key;
                        
                        if (confirm(`ä¼šè­°ã€Œ${meeting.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                            meetings.splice(index, 1);
                            this.saveToLocalStorage();
                            alert(`âœ… ä¼šè­°ã€Œ${meeting.name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
                            
                            // ç”»é¢ã‚’å†è¡¨ç¤º
                            if (this.currentBoard) {
                                this.showBoardView();
                            } else if (this.currentTeam) {
                                this.showTeamView(this.currentTeam.id);
                            }
                        }
                        return;
                    }
                }
                
                alert('âŒ ä¼šè­°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            },
            
            // ========== Board Management ==========
            addBoard() {
                const name = prompt('æ–°ã—ã„ãƒœãƒ¼ãƒ‰åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (name && name.trim()) {
                    alert('âœ… ãƒ‡ãƒ¢ç‰ˆã§ã¯è¿½åŠ ã§ãã¾ã›ã‚“ã€‚ä¿å­˜æ©Ÿèƒ½ã‚’å®Ÿè£…å¾Œã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚');
                    console.log('New board:', name);
                }
            },
            
            editBoard(boardId) {
                const newName = prompt('ãƒœãƒ¼ãƒ‰åã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š', this.demoData.board.name);
                if (newName && newName.trim()) {
                    this.demoData.board.name = newName.trim();
                    alert('âœ… ãƒœãƒ¼ãƒ‰åã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            deleteBoard(boardId) {
                alert('âŒ ãƒœãƒ¼ãƒ‰ã¯å‰Šé™¤ã§ãã¾ã›ã‚“ï¼ˆä¼šè­°ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰');
            },
            
            // ========== Department Management ==========
            addDepartment() {
                const name = prompt('æ–°ã—ã„éƒ¨é–€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (name && name.trim()) {
                    const newDept = {
                        id: `dept-${Date.now()}`,
                        name: name.trim(),
                        teams: []
                    };
                    this.demoData.departments.push(newDept);
                    alert('âœ… éƒ¨é–€ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            editDepartment(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) {
                    alert('âŒ éƒ¨é–€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('éƒ¨é–€åã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š', dept.name);
                if (newName && newName.trim()) {
                    dept.name = newName.trim();
                    alert('âœ… éƒ¨é–€åã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            deleteDepartment(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) {
                    alert('âŒ éƒ¨é–€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                if (dept.teams.length > 0) {
                    alert('âŒ ãƒãƒ¼ãƒ ãŒå­˜åœ¨ã™ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚å…ˆã«ãƒãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (confirm(`éƒ¨é–€ã€Œ${dept.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    const index = this.demoData.departments.findIndex(d => d.id === deptId);
                    this.demoData.departments.splice(index, 1);
                    alert('âœ… éƒ¨é–€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            // ========== Team Management ==========
            addTeam(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) {
                    alert('âŒ éƒ¨é–€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const name = prompt('æ–°ã—ã„ãƒãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (name && name.trim()) {
                    const newTeam = {
                        id: `team-${Date.now()}`,
                        name: name.trim(),
                        departmentId: deptId,
                        meetingCount: 0
                    };
                    dept.teams.push(newTeam);
                    alert('âœ… ãƒãƒ¼ãƒ ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            editTeam(teamId) {
                let team = null;
                let dept = null;
                
                for (const d of this.demoData.departments) {
                    const t = d.teams.find(tm => tm.id === teamId);
                    if (t) {
                        team = t;
                        dept = d;
                        break;
                    }
                }
                
                if (!team) {
                    alert('âŒ ãƒãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('ãƒãƒ¼ãƒ åã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š', team.name);
                if (newName && newName.trim()) {
                    team.name = newName.trim();
                    alert('âœ… ãƒãƒ¼ãƒ åã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            deleteTeam(teamId) {
                let team = null;
                let dept = null;
                
                for (const d of this.demoData.departments) {
                    const t = d.teams.find(tm => tm.id === teamId);
                    if (t) {
                        team = t;
                        dept = d;
                        break;
                    }
                }
                
                if (!team) {
                    alert('âŒ ãƒãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // Check if team has meetings
                const teamMeetings = this.meetingsData[teamId];
                if (teamMeetings && teamMeetings.length > 0) {
                    alert('âŒ ä¼šè­°ãŒå­˜åœ¨ã™ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚å…ˆã«ä¼šè­°ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (confirm(`ãƒãƒ¼ãƒ ã€Œ${team.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    const index = dept.teams.findIndex(t => t.id === teamId);
                    dept.teams.splice(index, 1);
                    alert('âœ… ãƒãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            showMinuteDetail(minuteId) {
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) return;
                
                this.currentView = 'minute';
                this.currentMinute = minute;
                
                this.updateBreadcrumb();
                
                const statusMap = {
                    'pending': { class: 'badge-pending', text: 'æœªç€æ‰‹' },
                    'progress': { class: 'badge-progress', text: 'é€²è¡Œä¸­' },
                    'completed': { class: 'badge-completed', text: 'å®Œäº†' },
                    'overdue': { class: 'badge-overdue', text: 'æœŸé™è¶…é' }
                };
                const status = statusMap[minute.status];
                
                const content = document.getElementById('contentArea');
                let html = `<button class="btn btn-secondary back-btn" onclick="app.showMeetingView('${this.currentMeeting.id}')">â† æˆ»ã‚‹</button>`;
                html += '<div class="card">';
                html += `<div class="card-title">
                    <span>ğŸ“„ è­°äº‹éŒ²è©³ç´°</span>
                    <div class="action-btns">
                        <button class="btn btn-primary" onclick="app.openEditMinuteModal('${minute.id}')">ç·¨é›†</button>
                        <button class="btn btn-danger" onclick="app.archiveMinute('${minute.id}')">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</button>
                    </div>
                </div>`;
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">åŸºæœ¬æƒ…å ±</div>';
                html += '<div class="detail-grid">';
                html += `<div class="detail-item"><div class="detail-label">è­°é¡Œ</div><div class="detail-value">${minute.topic}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">æ‹…å½“è€…</div><div class="detail-value">${minute.assignee}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">æœŸæ—¥</div><div class="detail-value">${minute.dueDate}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div><div class="detail-value"><span class="badge ${status.class}">${status.text}</span></div></div>`;
                html += '</div></div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">æ±ºå®šäº‹é …</div>';
                html += `<div class="detail-content">${minute.decision}</div>`;
                html += '</div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">èª²é¡Œ</div>';
                html += `<div class="detail-content">${minute.issue}</div>`;
                html += '</div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">å®Ÿè¡Œå†…å®¹</div>';
                html += `<div class="detail-content">${minute.action}</div>`;
                html += '</div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">ç†ç”±ãƒ»èƒŒæ™¯</div>';
                html += `<div class="detail-content">${minute.reason}</div>`;
                html += '</div>';
                
                html += '</div>';
                content.innerHTML = html;
            },
            
            showMinuteDetailTable(minuteId) {
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) return;
                
                this.currentView = 'minute';
                this.currentMinute = minute;
                
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                let html = `<button class="btn btn-secondary back-btn" onclick="app.showMeetingView('${this.currentMeeting.id}')">â† æˆ»ã‚‹</button>`;
                html += '<div class="card">';
                html += `<div class="card-title">
                    <span>ğŸ“Š ${minute.meetingName || 'ä¼šè­°å'} ã®è­°äº‹éŒ²è©³ç´°</span>
                    <div style="display: flex; gap: 10px;">
                        <div class="dropdown" style="position: relative;">
                            <button class="btn btn-info" onclick="app.toggleExportMenu()" style="padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                            </button>
                            <div id="exportMenu" style="display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); margin-top: 5px; min-width: 180px; z-index: 1000;">
                                <button onclick="app.exportPDF('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ“„ PDF</button>
                                <button onclick="app.exportWord('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ“ Word</button>
                                <button onclick="app.exportExcel('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ“Š Excel</button>
                                <button onclick="app.exportPowerPoint('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ“½ï¸ PowerPoint</button>
                                <button onclick="app.exportCSV('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ“‹ CSV</button>
                                <button onclick="app.exportImage('${minute.id}', 'png')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ–¼ï¸ PNG</button>
                                <button onclick="app.exportImage('${minute.id}', 'jpg')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ–¼ï¸ JPG</button>
                                <button onclick="app.exportTXT('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee;">ğŸ“ƒ TXT</button>
                                <button onclick="app.exportZIP('${minute.id}')" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px;">ğŸ—œï¸ ZIP</button>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="app.addNewDetailRow()">+ è¡Œã‚’è¿½åŠ </button>
                        <button class="btn btn-primary" onclick="app.saveDetailTable('${minute.id}')">ğŸ’¾ ä¿å­˜</button>
                    </div>
                </div>`;
                
                // ä¼šè­°æƒ…å ±ã‚’è¡¨ç¤º
                html += `<div style="background: #f0f0f0; padding: 12px; margin-bottom: 10px; border-radius: 4px;">
                    <strong>ä¼šè­°åï¼š</strong>${minute.meetingName || ''} &nbsp;&nbsp;
                    <strong>ä¼šè­°é–‹å‚¬æ—¥ï¼š</strong>${minute.meetingDate || ''} &nbsp;&nbsp;
                    <strong>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼š</strong>${minute.subtitle || ''}
                </div>`;
                
                // Google Sheetsé¢¨ã®ç·¨é›†å¯èƒ½ãƒ†ãƒ¼ãƒ–ãƒ«
                html += '<div style="overflow-x: auto;">';
                html += '<table class="editable-table" style="width: 100%; border-collapse: collapse; background: white;">';
                html += `
                    <thead>
                        <tr style="background-color: #4a86e8; color: white;">
                            <th style="padding: 10px; border: 1px solid #ccc; width: 3%; text-align: center; font-weight: 600; font-size: 13px;">#</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 15%; font-weight: 600; font-size: 13px;">è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 15%; font-weight: 600; font-size: 13px;">å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">æ‹…å½“è€…</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 8%; font-weight: 600; font-size: 13px;">æœŸé™</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 15%; font-weight: 600; font-size: 13px;">ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">å‚™è€ƒ1</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">å‚™è€ƒ2</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 4%; font-weight: 600; font-size: 13px; text-align: center;">å‰Šé™¤</th>
                        </tr>
                    </thead>
                    <tbody id="editableTableBody">
                `;
                
                // Initialize detail rows if not exists
                if (!minute.detailRows || minute.detailRows.length === 0) {
                    minute.detailRows = [{
                        agenda: '',
                        action: '',
                        assignee: minute.facilitator || '',
                        deadline: minute.meetingDate || '',
                        purpose: '',
                        status: minute.status || 'pending',
                        notes1: '',
                        notes2: ''
                    }];
                }
                
                // Render rows
                minute.detailRows.forEach((row, index) => {
                    const statusOptions = ['pending', 'progress', 'completed', 'overdue'];
                    const statusTexts = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                    
                    html += `
                        <tr id="detail-row-${index}" class="editable-row" style="background: ${index % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
                            <td style="padding: 8px; border: 1px solid #d0d0d0; text-align: center; color: #666; font-weight: 500; font-size: 12px;">${index + 1}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="agenda" data-row="${index}">${row.agenda || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="action" data-row="${index}">${row.action || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="assignee" data-row="${index}">${row.assignee || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="deadline" data-row="${index}">${row.deadline || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="purpose" data-row="${index}">${row.purpose || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 12px;">
                                <select class="status-select" data-row="${index}" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;">
                                    ${statusOptions.map(opt => `<option value="${opt}" ${row.status === opt ? 'selected' : ''}>${statusTexts[opt]}</option>`).join('')}
                                </select>
                            </td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="notes1" data-row="${index}">${row.notes1 || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="notes2" data-row="${index}">${row.notes2 || ''}</td>
                            <td style="padding: 8px; border: 1px solid #d0d0d0; text-align: center;">
                                <button class="btn btn-danger btn-sm" onclick="app.deleteDetailRow(${index})" style="padding: 4px 8px; font-size: 11px;">å‰Šé™¤</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                    </tbody>
                </table>
                </div>`;
                
                html += '</div>';
                content.innerHTML = html;
                
                // Add cell focus styling
                setTimeout(() => {
                    document.querySelectorAll('.editable-cell').forEach(cell => {
                        cell.addEventListener('focus', function() {
                            this.style.outline = '2px solid #4285f4';
                            this.style.backgroundColor = '#e8f0fe';
                        });
                        cell.addEventListener('blur', function() {
                            this.style.outline = 'none';
                            this.style.backgroundColor = '';
                        });
                    });
                }, 100);
            },
            
            getStatusText(status) {
                const statusMap = {
                    'pending': 'æœªç€æ‰‹',
                    'progress': 'é€²è¡Œä¸­',
                    'completed': 'å®Œäº†',
                    'overdue': 'æœŸé™è¶…é'
                };
                return statusMap[status] || 'æœªç€æ‰‹';
            },
            
            addNewRow() {
                const tbody = document.getElementById('editableTableBody');
                const rowCount = tbody.querySelectorAll('.editable-row').length;
                
                const newRow = document.createElement('tr');
                newRow.id = `row-${rowCount}`;
                newRow.className = 'editable-row';
                newRow.innerHTML = `
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="topic">æ–°ã—ã„è­°é¡Œ</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="assignee">æ‹…å½“è€…å</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="deadline">${new Date().toISOString().split('T')[0]}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="purpose">ç›®çš„ãƒ»åŠ¹æœ</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="status">æœªç€æ‰‹</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="source">1</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                        <button class="btn btn-danger btn-sm" onclick="app.deleteRow(${rowCount})" style="padding: 4px 8px; font-size: 12px;">å‰Šé™¤</button>
                    </td>
                `;
                
                tbody.appendChild(newRow);
            },
            
            deleteRow(rowIndex) {
                if (confirm('ã“ã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    const row = document.getElementById(`row-${rowIndex}`);
                    if (row) {
                        row.remove();
                    }
                }
            },
            
            addNewDetailRow() {
                if (!this.currentMinute.detailRows) {
                    this.currentMinute.detailRows = [];
                }
                
                this.currentMinute.detailRows.push({
                    agenda: '',
                    action: '',
                    assignee: '',
                    deadline: new Date().toISOString().split('T')[0],
                    purpose: '',
                    status: 'pending',
                    notes1: '',
                    notes2: ''
                });
                
                this.showMinuteDetailTable(this.currentMinute.id);
            },
            
            deleteDetailRow(rowIndex) {
                if (confirm('ã“ã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    if (this.currentMinute.detailRows && this.currentMinute.detailRows.length > 1) {
                        this.currentMinute.detailRows.splice(rowIndex, 1);
                        this.showMinuteDetailTable(this.currentMinute.id);
                    } else {
                        alert('æœ€ä½1è¡Œã¯å¿…è¦ã§ã™ã€‚');
                    }
                }
            },
            
            saveDetailTable(minuteId) {
                // Collect data from all cells
                const cells = document.querySelectorAll('.editable-cell');
                const statusSelects = document.querySelectorAll('.status-select');
                
                // Group by row
                const rowData = {};
                cells.forEach(cell => {
                    const row = cell.getAttribute('data-row');
                    const field = cell.getAttribute('data-field');
                    const value = cell.textContent.trim();
                    
                    if (!rowData[row]) {
                        rowData[row] = {};
                    }
                    rowData[row][field] = value;
                });
                
                // Add status values
                statusSelects.forEach(select => {
                    const row = select.getAttribute('data-row');
                    if (rowData[row]) {
                        rowData[row].status = select.value;
                    }
                });
                
                // Convert to array
                const updatedRows = Object.keys(rowData).sort().map(key => rowData[key]);
                
                // Find and update minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute.detailRows = updatedRows;
                        
                        this.saveToLocalStorage();
                        alert('âœ… ä¿å­˜ã—ã¾ã—ãŸ');
                        this.showMeetingView(this.currentMeeting.id);
                        return;
                    }
                }
            },
            
            saveMinuteTable(minuteId) {
                const rows = document.querySelectorAll('.editable-row');
                const data = [];
                
                rows.forEach((row) => {
                    const cells = row.querySelectorAll('.editable-cell');
                    const rowData = {};
                    
                    cells.forEach(cell => {
                        const field = cell.getAttribute('data-field');
                        rowData[field] = cell.textContent.trim();
                    });
                    
                    data.push(rowData);
                });
                
                console.log('Saving minute table data:', data);
                
                // Find and update minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        // Update minute with first row data
                        if (data.length > 0) {
                            minute.topic = data[0].topic;
                            minute.assignee = data[0].assignee;
                            minute.dueDate = data[0].deadline;
                            minute.issue = data[0].purpose;
                            minute.decision = data[0].topic;
                            minute.action = data.length > 1 ? data[1].topic : data[0].topic;
                            minute.reason = data.length > 1 ? data[1].purpose : data[0].purpose;
                        }
                        break;
                    }
                }
                
                alert('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼');
                this.showMeetingView(this.currentMeeting.id);
            },
            
            openAddMinuteModal(meetingId) {
                this.editingMinuteId = null;
                document.getElementById('modalTitle').textContent = 'è­°äº‹éŒ²ã‚’è¿½åŠ ';
                document.getElementById('minuteForm').reset();
                
                // Set default meeting name (from current meeting)
                if (this.currentMeeting) {
                    document.getElementById('minuteMeetingName').value = this.currentMeeting.name || '';
                }
                
                // Set default meeting date (today)
                const today = new Date();
                document.getElementById('minuteMeetingDate').value = today.toISOString().split('T')[0];
                
                document.getElementById('minuteModal').classList.add('active');
            },
            
            openEditMinuteModal(minuteId) {
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) return;
                
                this.editingMinuteId = minuteId;
                document.getElementById('modalTitle').textContent = 'è­°äº‹éŒ²ã‚’ç·¨é›†';
                
                // Fill form with current data
                document.getElementById('minuteMeetingName').value = minute.meetingName || '';
                document.getElementById('minuteSubtitle').value = minute.subtitle || '';
                document.getElementById('minuteMeetingDate').value = minute.meetingDate || '';
                document.getElementById('minuteParticipants').value = minute.participants || '';
                document.getElementById('minuteFacilitator').value = minute.facilitator || '';
                document.getElementById('minuteNotes').value = minute.notes || '';
                document.getElementById('minuteStatus').value = minute.status;
                
                document.getElementById('minuteModal').classList.add('active');
            },
            
            closeModal() {
                document.getElementById('minuteModal').classList.remove('active');
                document.getElementById('minuteForm').reset();
                this.editingMinuteId = null;
            },
            
            saveMinute() {
                const formData = {
                    meetingName: document.getElementById('minuteMeetingName').value,
                    subtitle: document.getElementById('minuteSubtitle').value,
                    meetingDate: document.getElementById('minuteMeetingDate').value,
                    participants: document.getElementById('minuteParticipants').value,
                    facilitator: document.getElementById('minuteFacilitator').value,
                    notes: document.getElementById('minuteNotes').value,
                    status: document.getElementById('minuteStatus').value
                };
                
                if (this.editingMinuteId) {
                    // Edit existing minute
                    for (const meetingId in this.minutesData) {
                        const index = this.minutesData[meetingId].findIndex(m => m.id === this.editingMinuteId);
                        if (index !== -1) {
                            this.minutesData[meetingId][index] = {
                                ...this.minutesData[meetingId][index],
                                ...formData
                            };
                            break;
                        }
                    }
                } else {
                    // Add new minute
                    const meetingId = this.currentMeeting.id;
                    if (!this.minutesData[meetingId]) {
                        this.minutesData[meetingId] = [];
                    }
                    
                    const newMinute = {
                        id: `minute-${meetingId}-${Date.now()}`,
                        meetingId: meetingId,
                        ...formData,
                        archived: false
                    };
                    
                    this.minutesData[meetingId].push(newMinute);
                }
                
                this.saveToLocalStorage(); // Save to localStorage
                this.closeModal();
                this.showMeetingView(this.currentMeeting.id);
            },
            
            archiveMinute(minuteId) {
                if (!confirm('ã“ã®è­°äº‹éŒ²ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã™ã‹ï¼Ÿã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ãŸè­°äº‹éŒ²ã¯ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚')) {
                    return;
                }
                
                // Find and archive minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute.archived = true;
                        this.archivedMinutes.push(minute);
                        break;
                    }
                }
                
                // Refresh view
                if (this.currentView === 'meeting') {
                    this.showMeetingView(this.currentMeeting.id);
                } else if (this.currentView === 'minute') {
                    this.showMeetingView(this.currentMeeting.id);
                }
            },
            
            async logout() {
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                this.currentUser = null;
                this.showLoginPage();
            }
        };
        
        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    localStorage.setItem('accessToken', data.data.accessToken);
                    localStorage.setItem('refreshToken', data.data.refreshToken);
                    app.currentUser = data.data.user;
                    app.showAlert('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼', 'success');
                    setTimeout(() => app.showMainApp(), 500);
                } else {
                    app.showAlert(`âŒ ${data.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ'}`, 'error');
                }
            } catch (error) {
                app.showAlert(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        });
        
        // ========== Export Functions ==========
        app.toggleExportMenu = function() {
            const menu = document.getElementById('exportMenu');
            if (menu) {
                menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
            }
        };
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('exportMenu');
            const btn = event.target.closest('.btn-info');
            if (menu && !btn && menu.style.display === 'block') {
                menu.style.display = 'none';
            }
        });
        
        app.exportCSV = function(minuteId) {
            const minute = this.currentMinute;
            if (!minute || !minute.detailRows) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let csv = '\uFEFF'; // UTF-8 BOM for Excel
            csv += 'ä¼šè­°å,ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«,ä¼šè­°é–‹å‚¬æ—¥\n';
            csv += `"${minute.meetingName || ''}","${minute.subtitle || ''}","${minute.meetingDate || ''}"\n\n`;
            csv += '#,è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€,å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³,æ‹…å½“è€…,æœŸé™,ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ,ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹,å‚™è€ƒ1,å‚™è€ƒ2\n';
            
            minute.detailRows.forEach((row, index) => {
                const statusMap = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                csv += `${index + 1},"${(row.agenda || '').replace(/"/g, '""')}","${(row.action || '').replace(/"/g, '""')}","${(row.assignee || '').replace(/"/g, '""')}","${row.deadline || ''}","${(row.purpose || '').replace(/"/g, '""')}","${statusMap[row.status] || ''}","${(row.notes1 || '').replace(/"/g, '""')}","${(row.notes2 || '').replace(/"/g, '""')}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è­°äº‹éŒ²_${minute.meetingName || 'minutes'}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            this.toggleExportMenu();
        };
        
        app.exportTXT = function(minuteId) {
            const minute = this.currentMinute;
            if (!minute || !minute.detailRows) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let txt = `è­°äº‹éŒ²è©³ç´°\n`;
            txt += `${'='.repeat(50)}\n\n`;
            txt += `ä¼šè­°å: ${minute.meetingName || ''}\n`;
            txt += `ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«: ${minute.subtitle || ''}\n`;
            txt += `ä¼šè­°é–‹å‚¬æ—¥: ${minute.meetingDate || ''}\n\n`;
            txt += `${'='.repeat(50)}\n\n`;
            
            minute.detailRows.forEach((row, index) => {
                const statusMap = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                txt += `ã€${index + 1}ã€‘\n`;
                txt += `è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€: ${row.agenda || ''}\n`;
                txt += `å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${row.action || ''}\n`;
                txt += `æ‹…å½“è€…: ${row.assignee || ''}\n`;
                txt += `æœŸé™: ${row.deadline || ''}\n`;
                txt += `ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ: ${row.purpose || ''}\n`;
                txt += `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${statusMap[row.status] || ''}\n`;
                txt += `å‚™è€ƒ1: ${row.notes1 || ''}\n`;
                txt += `å‚™è€ƒ2: ${row.notes2 || ''}\n`;
                txt += `${'-'.repeat(50)}\n\n`;
            });
            
            const blob = new Blob([txt], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è­°äº‹éŒ²_${minute.meetingName || 'minutes'}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            this.toggleExportMenu();
        };
        
        app.exportPDF = function(minuteId) {
            alert('ğŸ“„ PDFå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nä»£ã‚ã‚Šã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·æ©Ÿèƒ½ï¼ˆCtrl+Pï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ŒPDFã¨ã—ã¦ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            this.toggleExportMenu();
        };
        
        app.exportWord = function(minuteId) {
            const minute = this.currentMinute;
            if (!minute || !minute.detailRows) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>è­°äº‹éŒ²</title></head><body>`;
            html += `<h1>è­°äº‹éŒ²è©³ç´°</h1>`;
            html += `<p><strong>ä¼šè­°å:</strong> ${minute.meetingName || ''}</p>`;
            html += `<p><strong>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${minute.subtitle || ''}</p>`;
            html += `<p><strong>ä¼šè­°é–‹å‚¬æ—¥:</strong> ${minute.meetingDate || ''}</p><hr>`;
            html += `<table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;width:100%;">`;
            html += `<thead><tr style="background-color:#4a86e8;color:white;">`;
            html += `<th>#</th><th>è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€</th><th>å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th><th>æ‹…å½“è€…</th><th>æœŸé™</th><th>ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>å‚™è€ƒ1</th><th>å‚™è€ƒ2</th>`;
            html += `</tr></thead><tbody>`;
            
            minute.detailRows.forEach((row, index) => {
                const statusMap = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                html += `<tr>`;
                html += `<td>${index + 1}</td>`;
                html += `<td>${row.agenda || ''}</td>`;
                html += `<td>${row.action || ''}</td>`;
                html += `<td>${row.assignee || ''}</td>`;
                html += `<td>${row.deadline || ''}</td>`;
                html += `<td>${row.purpose || ''}</td>`;
                html += `<td>${statusMap[row.status] || ''}</td>`;
                html += `<td>${row.notes1 || ''}</td>`;
                html += `<td>${row.notes2 || ''}</td>`;
                html += `</tr>`;
            });
            
            html += `</tbody></table></body></html>`;
            
            const blob = new Blob(['\ufeff' + html], { type: 'application/msword;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è­°äº‹éŒ²_${minute.meetingName || 'minutes'}_${new Date().toISOString().split('T')[0]}.doc`;
            link.click();
            this.toggleExportMenu();
        };
        
        app.exportExcel = function(minuteId) {
            alert('ğŸ“Š Excelå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nä»£ã‚ã‚Šã«CSVå½¢å¼ã‚’ã”åˆ©ç”¨ãã ã•ã„ï¼ˆExcelã§CSVã‚’é–‹ãã“ã¨ãŒã§ãã¾ã™ï¼‰ã€‚');
            this.toggleExportMenu();
        };
        
        app.exportPowerPoint = function(minuteId) {
            alert('ğŸ“½ï¸ PowerPointå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nç¾åœ¨ã®æ©Ÿèƒ½ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
            this.toggleExportMenu();
        };
        
        app.exportImage = function(minuteId, format) {
            alert(`ğŸ–¼ï¸ ${format.toUpperCase()}å½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚`);
            this.toggleExportMenu();
        };
        
        app.exportZIP = function(minuteId) {
            alert('ğŸ—œï¸ ZIPå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å€‹åˆ¥ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€æ‰‹å‹•ã§ZIPåœ§ç¸®ã—ã¦ãã ã•ã„ã€‚');
            this.toggleExportMenu();
        };
        
        console.log('=== Setting window.app ===');
        // Make app globally accessible for onclick handlers
        window.app = app;
        console.log('window.app is now:', window.app);
        console.log('window.app.showMeetingView:', typeof window.app.showMeetingView);
        
        // Initialize app
        console.log('=== Initializing app ===');
        window.addEventListener('load', () => {
            console.log('DOM loaded, calling app.init()');
            app.init();
        });
        
        // Immediate check
        console.log('=== Script Loading Completed ===');
        console.log('You can now use window.app from console');
    </script>
</body>
</html>
