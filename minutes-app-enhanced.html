<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - Enhanced</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif; 
            background: #f5f7fa; 
            min-height: 100vh;
            word-wrap: break-word;
            overflow-wrap: break-word;
            -webkit-text-size-adjust: 100%;
        }
        
        /* Header */
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 20px; }
        .user-section { display: flex; align-items: center; gap: 15px; }
        .user-info { text-align: right; font-size: 13px; }
        .logout-btn { padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 5px; cursor: pointer; font-size: 14px; transition: background 0.3s; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        
        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
        
        /* Breadcrumb */
        .breadcrumb { display: flex; gap: 10px; margin-bottom: 20px; font-size: 14px; color: #666; flex-wrap: wrap; }
        .breadcrumb-item { cursor: pointer; transition: color 0.3s; }
        .breadcrumb-item:hover { color: #667eea; }
        .breadcrumb-item.active { color: #333; font-weight: 600; }
        .breadcrumb-separator { color: #999; }
        
        /* Card */
        .card { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 20px; }
        .card-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; justify-content: space-between; }
        
        /* Organization Tree */
        .org-tree { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .org-item { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
        }
        .org-item:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); }
        .org-item-title { 
            font-size: 16px; 
            font-weight: 600; 
            margin-bottom: 8px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.4;
        }
        .org-item-count { 
            font-size: 13px; 
            opacity: 0.9;
            word-wrap: break-word;
        }
        
        /* Hierarchical Organization Tree */
        .org-hierarchy { display: flex; flex-direction: column; gap: 25px; }
        .org-level { margin-bottom: 15px; }
        .org-level-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid #667eea; text-transform: uppercase; letter-spacing: 0.5px; }
        .org-section { margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .org-section-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #667eea; }
        .sub-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin-top: 15px; padding-left: 20px; }
        
        /* Meeting List */
        .meeting-list { display: flex; flex-direction: column; gap: 12px; }
        .meeting-item { background: #f8f9fa; padding: 18px; border-radius: 8px; cursor: pointer; transition: background 0.2s, transform 0.2s; border-left: 4px solid #667eea; }
        .meeting-item:hover { background: #e9ecef; transform: translateX(5px); }
        .meeting-title { font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .meeting-meta { display: flex; gap: 20px; font-size: 13px; color: #666; flex-wrap: wrap; }
        
        /* Minutes Table */
        .minutes-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .minutes-table th { background: #f8f9fa; padding: 12px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6; }
        .minutes-table td { padding: 12px; border-bottom: 1px solid #e9ecef; }
        .minutes-table tr { cursor: pointer; transition: background 0.2s; }
        .minutes-table tbody tr:hover { background: #f8f9fa; }
        
        /* Status Badge */
        .badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-not-held { background: #fff3cd; color: #856404; }  /* ã‚ªãƒ¬ãƒ³ã‚¸ */
        .badge-completed-with-tasks { background: #f8d7da; color: #842029; }  /* èµ¤ */
        .badge-completed-no-tasks { background: #e3f2fd; color: #1565c0; }  /* é’ */
        /* æ—§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆäº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰ */
        .badge-pending { background: #fff3cd; color: #856404; }
        .badge-progress { background: #cfe2ff; color: #084298; }
        .badge-completed { background: #d1e7dd; color: #0f5132; }
        .badge-overdue { background: #f8d7da; color: #842029; }
        .badge-archived { background: #6c757d; color: white; }
        
        /* Inline Edit */
        .inline-edit:hover {
            background: #f0f8ff !important;
            outline: 1px solid #667eea;
        }
        .inline-edit:focus {
            background: #fff !important;
            outline: 2px solid #667eea;
        }
        .inline-edit[contenteditable="true"]:empty:before {
            content: attr(data-placeholder);
            color: #999;
        }
        .status-dropdown {
            transition: all 0.2s;
        }
        .status-dropdown:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        .save-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-in 2.7s;
            opacity: 0;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.3s; font-weight: 600; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-danger:hover { background: #c82333; }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; }
        .action-btns { display: flex; gap: 10px; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; animation: fadeIn 0.2s ease-in-out; }
        .modal-content { 
            background: white; 
            border-radius: 10px; 
            padding: 0;
            max-width: 600px; 
            width: 100%; 
            max-height: 90vh; 
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease-out;
            display: flex;
            flex-direction: column;
        }
        .modal-header-sticky {
            position: sticky;
            top: 0;
            background: white;
            padding: 20px 30px 15px 30px;
            border-bottom: 2px solid #667eea;
            z-index: 10;
            border-radius: 10px 10px 0 0;
        }
        .modal-title { 
            font-size: 20px; 
            font-weight: 600; 
            margin-bottom: 15px; 
            color: #333;
        }
        .modal-actions-top {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        #minuteForm {
            padding: 20px 30px 30px 30px;
            flex: 1;
            overflow-y: auto;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #333;
            font-size: 14px;
        }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; 
            padding: 10px 12px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 14px; 
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { 
            outline: none; 
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-group small {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            color: #666;
        }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Detail View */
        .detail-section { margin-bottom: 25px; }
        .detail-section-title { font-size: 14px; font-weight: 600; color: #667eea; margin-bottom: 10px; text-transform: uppercase; }
        .detail-content { background: #f8f9fa; padding: 15px; border-radius: 6px; line-height: 1.6; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .detail-item { display: flex; flex-direction: column; gap: 5px; }
        .detail-label { font-size: 12px; color: #666; font-weight: 600; }
        .detail-value { font-size: 14px; color: #333; }
        
        /* Login Page */
        .login-container { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; }
        .login-box { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
        .login-title { text-align: center; font-size: 24px; margin-bottom: 10px; color: #333; }
        .login-subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
        .login-btn { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        .login-btn:hover:not(:disabled) { background: #5568d3; }
        .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .alert { padding: 12px; border-radius: 5px; margin-bottom: 20px; font-size: 14px; }
        .alert-error { background: #fee; border: 1px solid #fcc; color: #c33; }
        .alert-success { background: #efe; border: 1px solid #cfc; color: #3c3; }
        .demo-info { text-align: center; margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; font-size: 13px; color: #666; }
        .demo-info code { background: #e0e0e0; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .empty-state-icon { font-size: 48px; margin-bottom: 15px; }
        
        /* Editable Table */
        .editable-table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        .editable-table th { background-color: #4A90E2; color: white; padding: 12px; border: 1px solid #ddd; text-align: left; font-weight: 600; }
        .editable-table td { padding: 8px; border: 1px solid #ddd; }
        .editable-cell { cursor: text; transition: background-color 0.2s; }
        .editable-cell:hover { background-color: #f0f8ff; }
        .editable-cell:focus { outline: 2px solid #4A90E2; outline-offset: -2px; background-color: #fff; }
        .editable-row:nth-child(even) { background-color: #f9f9f9; }
        .btn-sm { padding: 4px 8px; font-size: 12px; }
        
        /* ============================================
           ğŸ“± ã‚¹ãƒãƒ›å¯¾å¿œ - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
           ============================================ */
        @media screen and (max-width: 768px) {
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆåŒ– */
            .header { 
                padding: 12px 15px; 
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            .header h1 { 
                font-size: 16px; 
                text-align: center;
                cursor: pointer;
            }
            .user-section { 
                justify-content: space-between;
                font-size: 12px;
            }
            .user-info { font-size: 11px; }
            .logout-btn { 
                padding: 6px 12px; 
                font-size: 12px;
            }
            
            /* ã‚³ãƒ³ãƒ†ãƒŠ - ä½™ç™½å‰Šæ¸› */
            .container { 
                padding: 15px 10px; 
            }
            
            /* ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆ */
            .breadcrumb { 
                font-size: 12px;
                gap: 5px;
            }
            
            /* ã‚«ãƒ¼ãƒ‰ */
            .card { 
                padding: 15px; 
                border-radius: 8px;
                margin-bottom: 15px;
            }
            .card-title { 
                font-size: 15px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                word-break: keep-all;
                overflow-wrap: break-word;
                line-height: 1.5;
            }
            
            /* çµ„ç¹”ãƒ„ãƒªãƒ¼ - 1ã‚«ãƒ©ãƒ è¡¨ç¤º */
            .org-tree { 
                grid-template-columns: 1fr;
                gap: 10px;
            }
            .org-item { 
                padding: 14px 16px;
                touch-action: manipulation;
                min-height: auto;
                display: flex;
                flex-direction: row;
                align-items: center;
                gap: 12px;
            }
            .org-item-title { 
                font-size: 15px;
                line-height: 1.4;
                word-break: keep-all;
                overflow-wrap: anywhere;
                flex: 1;
                max-height: 2.8em;
                overflow: hidden;
                text-overflow: ellipsis;
                display: block;
            }
            .org-item-count { 
                font-size: 12px;
                margin-top: 4px;
                opacity: 0.95;
                white-space: nowrap;
            }
            
            /* ã‚µãƒ–ã‚¢ã‚¤ãƒ†ãƒ  - 1ã‚«ãƒ©ãƒ  */
            .sub-items { 
                grid-template-columns: 1fr;
                padding-left: 10px;
                gap: 10px;
            }
            
            /* è­°äº‹éŒ²ãƒªã‚¹ãƒˆ */
            .meeting-list { gap: 10px; }
            .meeting-item { 
                padding: 15px;
                touch-action: manipulation;
            }
            .meeting-title { font-size: 15px; }
            .meeting-meta { 
                font-size: 12px;
                gap: 10px;
                flex-direction: column;
            }
            
            /* ãƒ†ãƒ¼ãƒ–ãƒ« â†’ ã‚«ãƒ¼ãƒ‰å½¢å¼ */
            .minutes-table { 
                border: 0;
                font-size: 13px;
            }
            .minutes-table thead { 
                display: none; 
            }
            .minutes-table tbody {
                display: block;
            }
            .minutes-table tr { 
                display: block;
                margin-bottom: 15px;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                padding: 12px;
                background: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                touch-action: manipulation;
            }
            .minutes-table td { 
                display: block;
                text-align: left;
                padding: 10px 0;
                border: none;
                border-bottom: 1px solid #f0f0f0;
                word-wrap: break-word;
                overflow-wrap: break-word;
                line-height: 1.6;
            }
            .minutes-table td:last-child {
                border-bottom: none;
            }
            .minutes-table td::before { 
                content: attr(data-label);
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 6px;
                font-size: 12px;
                word-break: keep-all;
            }
            
            /* ç·¨é›†å¯èƒ½ãƒ†ãƒ¼ãƒ–ãƒ« - ã‚«ãƒ¼ãƒ‰å½¢å¼ */
            .editable-table thead {
                display: none;
            }
            .editable-table tbody {
                display: block;
            }
            .editable-table tr {
                display: block;
                margin-bottom: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 12px;
                background: white;
            }
            .editable-table td {
                display: block;
                padding: 10px 0;
                border: none;
                border-bottom: 1px solid #f0f0f0;
                word-wrap: break-word;
                overflow-wrap: break-word;
                line-height: 1.6;
            }
            .editable-table td:last-child {
                border-bottom: none;
            }
            .editable-table td::before {
                content: attr(data-label);
                font-weight: 600;
                color: #4A90E2;
                display: block;
                margin-bottom: 6px;
                font-size: 12px;
                word-break: keep-all;
            }
            .editable-table .editable-cell {
                min-height: 40px;
                padding: 8px;
                background: #f8f9fa;
                border-radius: 4px;
                margin-top: 4px;
            }
            
            /* ãƒœã‚¿ãƒ³ - ã‚¿ãƒƒãƒå¯¾å¿œ */
            .btn { 
                padding: 12px 18px;
                font-size: 14px;
                min-height: 44px;
                touch-action: manipulation;
            }
            .btn-sm {
                padding: 8px 12px;
                min-height: 36px;
            }
            .action-btns { 
                flex-direction: column;
                gap: 8px;
            }
            .action-btns .btn {
                width: 100%;
            }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ« - å…¨ç”»é¢è¡¨ç¤º */
            .modal { 
                padding: 0;
            }
            .modal-content { 
                max-width: 100%;
                width: 100%;
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                padding: 0;
            }
            .modal-header-sticky {
                padding: 16px;
                border-radius: 0;
            }
            .modal-title { 
                font-size: 17px;
                margin-bottom: 12px;
            }
            .modal-actions-top {
                flex-direction: row;
                gap: 8px;
            }
            .modal-actions-top .btn {
                flex: 1;
                min-height: 44px;
                font-size: 14px;
            }
            #minuteForm {
                padding: 16px;
            }
            .modal-actions {
                display: none !important;
            }
            
            /* ãƒ•ã‚©ãƒ¼ãƒ  */
            .form-group { 
                margin-bottom: 18px; 
            }
            .form-group label { 
                font-size: 14px;
                font-weight: 600;
                color: #333;
                margin-bottom: 8px;
            }
            .form-group input, 
            .form-group textarea, 
            .form-group select { 
                padding: 13px 12px;
                font-size: 16px; /* iOS zoomé˜²æ­¢ */
                min-height: 48px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                transition: border-color 0.2s;
            }
            .form-group input:focus,
            .form-group textarea:focus,
            .form-group select:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            .form-group textarea {
                min-height: 120px;
                line-height: 1.5;
            }
            .form-group small {
                font-size: 12px;
                color: #666;
                margin-top: 6px;
                display: block;
            }
            
            /* è©³ç´°ã‚°ãƒªãƒƒãƒ‰ - 1ã‚«ãƒ©ãƒ  */
            .detail-grid { 
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .detail-section { 
                margin-bottom: 20px; 
            }
            .detail-content { 
                padding: 12px;
                font-size: 14px;
            }
            
            /* ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ */
            .login-box { 
                padding: 30px 20px;
                margin: 0;
                max-width: 100%;
                border-radius: 0;
            }
            .login-title { 
                font-size: 20px; 
            }
            .login-subtitle { 
                font-size: 13px; 
            }
            .demo-info { 
                font-size: 12px;
                padding: 12px;
            }
            
            /* Empty State */
            .empty-state { 
                padding: 40px 20px; 
            }
            .empty-state-icon { 
                font-size: 36px; 
            }
            
            /* çµ„ç¹”éšå±¤ */
            .org-section { 
                padding: 15px;
                margin-bottom: 20px;
            }
            .org-section-title { 
                font-size: 15px;
                margin-bottom: 12px;
            }
            .org-level-title { 
                font-size: 13px;
                margin-bottom: 12px;
            }
            
            /* ãƒãƒƒã‚¸ */
            .badge { 
                padding: 5px 10px;
                font-size: 11px;
            }
            
            /* ã‚¿ãƒƒãƒæ“ä½œã®æ”¹å–„ */
            * {
                -webkit-tap-highlight-color: rgba(102, 126, 234, 0.2);
            }
            
            /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ€é©åŒ– */
            body {
                -webkit-overflow-scrolling: touch;
            }
            
            /* AIè§£æç”¨ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ */
            #minutesText {
                min-height: 200px;
                font-size: 16px;
            }
            
            /* ä¼šè­°ãƒªã‚¹ãƒˆ - ãƒ˜ãƒƒãƒ€ãƒ¼éè¡¨ç¤ºã€ã‚«ãƒ¼ãƒ‰å½¢å¼ */
            .meeting-list-header {
                display: none !important;
            }
            
            .meeting-list-row {
                display: block !important;
                padding: 14px !important;
                margin-bottom: 12px !important;
                border-radius: 8px !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.08) !important;
            }
            
            .meeting-list-row > div {
                display: block !important;
                padding: 6px 0 !important;
                border-bottom: 1px solid #f0f0f0;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }
            
            .meeting-list-row > div:last-child {
                border-bottom: none;
                padding-top: 12px !important;
            }
            
            .meeting-list-row > div:nth-child(1)::before {
                content: "ä¼šè­°æ—¥: ";
                font-weight: 600;
                color: #667eea;
                display: inline;
                margin-right: 6px;
            }
            
            .meeting-list-row > div:nth-child(2)::before {
                content: "ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«: ";
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 4px;
            }
            
            .meeting-list-row > div:nth-child(3)::before {
                content: "å‚åŠ è€…: ";
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 4px;
            }
            
            .meeting-list-row > div:nth-child(4)::before {
                content: "ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼: ";
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 4px;
            }
            
            .meeting-list-row > div:nth-child(5)::before {
                content: "å‚™è€ƒ: ";
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 4px;
            }
            
            .meeting-list-row > div:nth-child(6)::before {
                content: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ";
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 4px;
            }
            
            .meeting-list-row > div:last-child {
                display: flex !important;
                flex-direction: column;
                gap: 8px;
            }
            
            .meeting-list-row > div:last-child::before {
                content: "æ“ä½œ";
                font-weight: 600;
                color: #667eea;
                display: block;
                margin-bottom: 6px;
            }
            
            .meeting-list-row button {
                width: 100% !important;
                padding: 10px !important;
                font-size: 14px !important;
            }
            
            /* çµ„ç¹”ã‚¢ã‚¤ãƒ†ãƒ ã®gridãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¸Šæ›¸ãï¼ˆé‡è¦ï¼ï¼‰ */
            .org-item[style*="grid-template-columns"] {
                display: flex !important;
                flex-direction: column !important;
                gap: 10px !important;
                padding: 14px !important;
                align-items: flex-start !important;
            }
            
            /* çµ„ç¹”ã‚¢ã‚¤ãƒ†ãƒ ã®å†…éƒ¨è¦ç´ ã‚‚æ¨ªä¸¦ã³ã« */
            .org-item > div {
                width: 100%;
            }
            
            /* ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¨ªä¸¦ã³ã« */
            .org-item > div:first-child {
                display: inline-block;
                width: auto;
                margin-right: 10px;
            }
            
            /* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¸¦ä¸¦ã³ã« */
            .org-item > div:last-child {
                display: flex;
                flex-direction: column;
                gap: 6px;
                width: 100%;
            }
            
            .org-item > div:last-child button {
                width: 100%;
                text-align: center;
            }
            
            /* éƒ¨é–€ãƒ˜ãƒƒãƒ€ãƒ¼ã‚‚åŒæ§˜ã« */
            div[style*="grid-template-columns: 40px 1fr"] {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 8px !important;
                padding: 12px !important;
            }
        }
        
        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ (768px - 1024px) */
        @media screen and (min-width: 769px) and (max-width: 1024px) {
            .org-tree { 
                grid-template-columns: repeat(2, 1fr);
            }
            .sub-items { 
                grid-template-columns: repeat(2, 1fr);
            }
            .detail-grid { 
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1 class="login-title">ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="login-subtitle">å…¨ç¤¾ãƒŠãƒ¬ãƒƒã‚¸å…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email" value="admin@example.com" required>
                </div>
                <div class="form-group">
                    <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" value="Admin@123" required>
                </div>
                <button type="submit" class="login-btn" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </form>
            <div class="demo-info">
                <p><strong>ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ:</strong></p>
                <p><code>admin@example.com</code> / <code>Admin@123</code></p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="header">
            <h1 id="headerLogo" style="cursor: pointer; transition: opacity 0.3s;">ğŸ“‹ ä¼šè­°è­°äº‹éŒ²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            <div class="user-section">
                <div class="user-info">
                    <div id="headerUserName"></div>
                    <div id="headerUserDept"></div>
                </div>
                <button class="btn btn-warning" onclick="app.resetAllData()" style="margin-right: 10px; padding: 8px 16px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
                <button class="logout-btn" onclick="app.logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>

        <div class="container">
            <div class="breadcrumb" id="breadcrumb"></div>
            <div id="contentArea"></div>
        </div>
    </div>

    <!-- Edit/Add Minute Modal -->
    <div id="minuteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header-sticky">
                <h2 class="modal-title" id="modalTitle">è­°äº‹éŒ²ã‚’è¿½åŠ </h2>
                <div class="modal-actions-top">
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="button" class="btn btn-primary" onclick="app.submitMinuteForm()">ä¿å­˜</button>
                </div>
            </div>
            <form id="minuteForm">
                <div class="form-group">
                    <label for="minuteMeetingName">ä¼šè­°å *</label>
                    <input type="text" id="minuteMeetingName" required>
                </div>
                <div class="form-group">
                    <label for="minuteSubtitle">ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="minuteSubtitle">
                </div>
                <div class="form-group">
                    <label for="minuteMeetingDate">ä¼šè­°é–‹å‚¬æ—¥ *</label>
                    <input type="date" id="minuteMeetingDate" required>
                </div>
                <div class="form-group">
                    <label for="minuteParticipants">ä¼šè­°å‚åŠ è€… *</label>
                    <textarea id="minuteParticipants" required placeholder="å‚åŠ è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§30åï¼‰" rows="4"></textarea>
                    <small style="color: #666;">â€»æ”¹è¡Œã¾ãŸã¯ã€ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</small>
                </div>
                <div class="form-group">
                    <label for="minuteFacilitator">ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼ *</label>
                    <input type="text" id="minuteFacilitator" required>
                </div>
                <div class="form-group">
                    <label for="minuteNotes">å‚™è€ƒ</label>
                    <textarea id="minuteNotes" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="minuteStatus">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ *</label>
                    <select id="minuteStatus" required>
                        <option value="not-held">ä¼šè­°æœªå®Ÿæ–½</option>
                        <option value="completed-with-tasks">ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ã‚ã‚Šï¼‰</option>
                        <option value="completed-no-tasks">ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ãªã—ï¼‰</option>
                    </select>
                </div>
            </form>
        </div>
    </div>

    <!-- AI Analysis Modal -->
    <div id="aiAnalysisModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h2 class="modal-title">ğŸ¤– AIè­°äº‹éŒ²è§£æ</h2>
            <div style="margin-bottom: 20px;">
                <p style="color: #666; margin-bottom: 15px;">è­°äº‹éŒ²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚AIãŒè‡ªå‹•çš„ã«è§£æã—ã¦ã€è­°é¡Œãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ»æ‹…å½“è€…ç­‰ã‚’æŠ½å‡ºã—ã¾ã™ã€‚</p>
                
                <!-- File Upload -->
                <div style="margin-bottom: 15px;">
                    <label for="aiAnalysisFileUpload" class="btn btn-info" style="display: inline-block; cursor: pointer; margin: 0;">
                        ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (.txt, .docx)
                    </label>
                    <input type="file" id="aiAnalysisFileUpload" accept=".txt,.docx" style="display: none;" onchange="app.handleAIAnalysisFile(event)">
                    <span id="aiAnalysisFileName" style="margin-left: 10px; color: #666;"></span>
                </div>
                
                <!-- Text Input -->
                <div class="form-group">
                    <label for="aiAnalysisText">ã¾ãŸã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’ç›´æ¥å…¥åŠ›ï¼š</label>
                    <textarea id="aiAnalysisText" rows="12" placeholder="è­°äº‹éŒ²ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„..." style="font-family: monospace; font-size: 13px;"></textarea>
                </div>
                
                <!-- Progress -->
                <div id="aiAnalysisProgress" style="display: none; margin-top: 15px; padding: 15px; background: #f0f8ff; border-radius: 4px; border-left: 4px solid #007bff;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite;"></div>
                        <span id="aiAnalysisProgressText">AIè§£æä¸­...</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="app.closeAIAnalysisModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="button" class="btn btn-primary" onclick="app.startAIAnalysis()">ğŸ¤– AIè§£æé–‹å§‹</button>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>

    <script>
        console.log('=== Script Loading Started ===');
        const API_BASE_URL = 'https://3000-iyibqicmi9poa0s21x8jw-c81df28e.sandbox.novita.ai/api';
        
        const app = {
            currentUser: null,
            currentView: 'organization',
            currentBoard: null,
            currentDepartment: null,
            currentTeam: null,
            currentMeeting: null,
            currentMinute: null,
            editingMinuteId: null,
            demoData: null,
            meetingsData: {}, // Store meetings data by entityId
            minutesData: {}, // Store minutes data by meetingId
            archivedMinutes: [], // Store archived minutes
            
            init() {
                // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆçµ„ç¹”æ§‹é€ ï¼‰ã¯å¸¸ã«èª­ã¿è¾¼ã‚€
                this.loadDemoData();
                
                // LocalStorageã‹ã‚‰ä¼šè­°ãƒ»è­°äº‹éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                this.loadFromLocalStorage();
                
                this.checkAuth();
                this.setupEventListeners();
                this.setupInlineEditListeners();
            },
            
            navigateHome() {
                console.log('ğŸ  ========== navigateHome CALLED ==========');
                console.log('   Current view:', this.currentView);
                console.log('   Current board:', this.currentBoard);
                console.log('   Current department:', this.currentDepartment);
                console.log('   Current team:', this.currentTeam);
                
                // Reset navigation state
                this.currentView = 'organization';
                this.currentBoard = null;
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                console.log('âœ… Navigation state reset');
                console.log('   Calling showOrganizationView()...');
                
                // Show organization view
                this.showOrganizationView();
                
                console.log('âœ… navigateHome COMPLETED');
                console.log('==========================================');
            },
            
            loadFromLocalStorage() {
                const savedMeetings = localStorage.getItem('meetingsData');
                const savedMinutes = localStorage.getItem('minutesData');
                
                if (savedMeetings) {
                    this.meetingsData = JSON.parse(savedMeetings);
                    console.log('Loaded meetings from localStorage:', this.meetingsData);
                }
                
                if (savedMinutes) {
                    this.minutesData = JSON.parse(savedMinutes);
                    console.log('Loaded minutes from localStorage:', this.minutesData);
                }
            },
            
            saveToLocalStorage() {
                localStorage.setItem('meetingsData', JSON.stringify(this.meetingsData));
                localStorage.setItem('minutesData', JSON.stringify(this.minutesData));
                console.log('Saved to localStorage');
            },
            
            resetAllData() {
                if (confirm('ã™ã¹ã¦ã®ä¼šè­°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nâ€»çµ„ç¹”éšå±¤ï¼ˆéƒ¨é–€ãƒ»ãƒãƒ¼ãƒ ï¼‰ã¯æ®‹ã‚Šã¾ã™ã€‚\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                    // ä¼šè­°ãƒ‡ãƒ¼ã‚¿ã¨è­°äº‹éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                    this.meetingsData = {};
                    this.minutesData = {};
                    this.archivedMinutes = [];
                    
                    // LocalStorageã‹ã‚‰ä¼šè­°ãƒ»è­°äº‹éŒ²ãƒ‡ãƒ¼ã‚¿ã®ã¿å‰Šé™¤
                    localStorage.removeItem('meetingsData');
                    localStorage.removeItem('minutesData');
                    localStorage.removeItem('archivedMinutes');
                    
                    console.log('âœ… ä¼šè­°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
                    alert('âœ… ä¼šè­°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ\nçµ„ç¹”éšå±¤ã¯ä¿æŒã•ã‚Œã¦ã„ã¾ã™ã€‚');
                    
                    // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
                    location.reload();
                }
            },
            
            setupEventListeners() {
                console.log('=== setupEventListeners called ===');
                
                // Header logo click listener - Navigate to home
                const headerLogo = document.getElementById('headerLogo');
                if (headerLogo) {
                    headerLogo.addEventListener('click', () => {
                        console.log('ğŸ  Header logo clicked!');
                        this.navigateHome();
                    });
                    headerLogo.addEventListener('mouseover', () => {
                        headerLogo.style.opacity = '0.8';
                    });
                    headerLogo.addEventListener('mouseout', () => {
                        headerLogo.style.opacity = '1';
                    });
                    console.log('âœ… Header logo listener added');
                } else {
                    console.warn('âš ï¸ headerLogo not found');
                }
                
                // Minute form listener
                const minuteForm = document.getElementById('minuteForm');
                if (minuteForm) {
                    minuteForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveMinute();
                    });
                    console.log('âœ… minuteForm listener added');
                } else {
                    console.error('âŒ minuteForm not found');
                }
                
                // Content area listener
                const contentArea = document.getElementById('contentArea');
                if (!contentArea) {
                    console.error('âŒ contentArea not found!');
                    return;
                }
                
                console.log('âœ… contentArea found, adding click listener...');
                
                // ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²: contentAreaå†…ã®ã‚¯ãƒªãƒƒã‚¯ã‚’ç›£è¦–
                // â˜… ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦thisã‚’ãƒã‚¤ãƒ³ãƒ‰
                contentArea.addEventListener('click', (e) => {
                    console.log('contentArea clicked!', e.target);
                    
                    // ä¼šè­°ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯
                    const meetingItem = e.target.closest('.meeting-item');
                    if (meetingItem) {
                        console.log('Meeting item found:', meetingItem);
                        console.log('Meeting ID:', meetingItem.dataset.meetingId);
                        
                        if (meetingItem.dataset.meetingId) {
                            console.log('âœ… Calling showMeetingView with:', meetingItem.dataset.meetingId);
                            console.log('this:', this);
                            console.log('this.showMeetingView:', this.showMeetingView);
                            
                            try {
                                this.showMeetingView(meetingItem.dataset.meetingId);
                            } catch (error) {
                                console.error('âŒ Error calling showMeetingView:', error);
                            }
                            return;
                        } else {
                            console.error('âŒ No meeting ID found on meeting item');
                        }
                    }
                    
                    // çµ„ç¹”ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¯ãƒªãƒƒã‚¯ï¼ˆéƒ¨é–€åï¼‰
                    const sectionTitle = e.target.closest('.org-section-title');
                    if (sectionTitle && sectionTitle.dataset.deptId) {
                        console.log('Department section clicked via event delegation:', sectionTitle.dataset.deptId);
                        this.showDepartmentView(sectionTitle.dataset.deptId);
                        return;
                    }
                    
                    // çµ„ç¹”ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¯ãƒªãƒƒã‚¯
                    const orgItem = e.target.closest('.org-item');
                    if (orgItem) {
                        if (orgItem.dataset.boardId) {
                            console.log('Board clicked via event delegation');
                            this.showBoardView();
                        } else if (orgItem.dataset.deptId) {
                            console.log('Department clicked via event delegation:', orgItem.dataset.deptId);
                            this.showDepartmentView(orgItem.dataset.deptId);
                        } else if (orgItem.dataset.teamId) {
                            console.log('Team clicked via event delegation:', orgItem.dataset.teamId);
                            this.showTeamView(orgItem.dataset.teamId);
                        }
                        return;
                    }
                    
                    console.log('No matching element found for click');
                });
                
                console.log('âœ… contentArea click listener added successfully');
            },
            
            loadDemoData() {
                this.demoData = {
                    // çµŒå–¶ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰ãƒ¬ãƒ™ãƒ« - é…åˆ—ã«å¤‰æ›´
                    boards: [
                        {
                            id: 'board-1',
                            name: 'çµŒå–¶ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰'
                        }
                    ],
                    
                    departments: [
                        {
                            id: 'dept-1',
                            name: 'å–¶æ¥­éƒ¨ï¼ˆå–¶æ¥­å‚µæ¨©ç®¡ç†éƒ¨ï¼‰',
                            teams: [
                                { id: 'team-1-1', name: 'æ±æ—¥æœ¬' },
                                { id: 'team-1-2', name: 'è¥¿æ—¥æœ¬' }
                            ]
                        },
                        {
                            id: 'dept-2',
                            name: 'å‚µæ¨©ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-2-1', name: 'ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°ãƒ‡ã‚¹ã‚¯' },
                                { id: 'team-2-2', name: 'ã‚¨ãƒªã‚¢æ‹…å½“æ±â‘ ' },
                                { id: 'team-2-3', name: 'ã‚¨ãƒªã‚¢æ‹…å½“æ±â‘¡' },
                                { id: 'team-2-4', name: 'ã‚¨ãƒªã‚¢æ‹…å½“è¥¿â‘ ' },
                                { id: 'team-2-5', name: 'ã‚¨ãƒªã‚¢æ‹…å½“è¥¿â‘¡' },
                                { id: 'team-2-6', name: 'æ³•å‹™' },
                                { id: 'team-2-7', name: 'æ±‚å„Ÿ' },
                                { id: 'team-2-8', name: 'ã‚µãƒãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯é€šå¸¸äº‹å‹™ãƒãƒ¼ãƒ ' },
                                { id: 'team-2-9', name: 'ã‚µãƒãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ä¿è¨¼å®Ÿè¡Œãƒãƒ¼ãƒ ' }
                            ]
                        },
                        {
                            id: 'dept-3',
                            name: 'å¯©æŸ»å¥‘ç´„ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-3-1', name: 'å¯©æŸ»' },
                                { id: 'team-3-2', name: 'å¥‘ç´„ç®¡ç†' },
                                { id: 'team-3-3', name: 'å›½éš›ãƒãƒ¼ãƒ ' }
                            ]
                        },
                        {
                            id: 'dept-4',
                            name: 'ã‚·ã‚¹ãƒ†ãƒ éƒ¨',
                            teams: [
                                { id: 'team-4-1', name: 'ã‚¤ãƒ³ãƒ•ãƒ©ãƒãƒ¼ãƒ ' },
                                { id: 'team-4-2', name: 'é–‹ç™ºãƒãƒ¼ãƒ ' }
                            ]
                        },
                        {
                            id: 'dept-5',
                            name: 'äººäº‹ç®¡ç†éƒ¨',
                            teams: [
                                { id: 'team-5-1', name: 'çµŒç†' },
                                { id: 'team-5-2', name: 'äººäº‹' },
                                { id: 'team-5-3', name: 'ç®¡ç†' }
                            ]
                        }
                    ],
                    
                    generateMeetings(entityId) {
                        // LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
                        if (window.app && window.app.meetingsData && window.app.meetingsData[entityId]) {
                            return window.app.meetingsData[entityId].sort((a, b) => new Date(b.date) - new Date(a.date));
                        }
                        
                        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºé…åˆ—ã‚’è¿”ã™
                        return [];
                    },
                    
                    generateMinutes(meetingId) {
                        // LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
                        if (window.app && window.app.minutesData && window.app.minutesData[meetingId]) {
                            return window.app.minutesData[meetingId].filter(m => !m.archived);
                        }
                        
                        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºé…åˆ—ã‚’è¿”ã™
                        return [];
                    }
                };
            },
            
            // ä¼šè­°æ•°ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
            getMeetingCount(entityId) {
                if (this.meetingsData && this.meetingsData[entityId]) {
                    return this.meetingsData[entityId].length;
                }
                return 0;
            },
            
            async checkAuth() {
                const token = localStorage.getItem('accessToken');
                if (token) {
                    // Use stored user info instead of API call
                    const userInfo = localStorage.getItem('userInfo');
                    if (userInfo) {
                        try {
                            this.currentUser = JSON.parse(userInfo);
                            this.showMainApp();
                            return;
                        } catch (error) {
                            console.error('Failed to parse user info:', error);
                        }
                    }
                }
                this.showLoginPage();
            },
            
            showLoginPage() {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            },
            
            showMainApp() {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('headerUserName').textContent = this.currentUser.name;
                
                // â˜… çµ„ç¹”ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºï¼ˆã“ã‚ŒãŒãªã„ã¨ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ï¼ï¼‰
                this.showOrganizationView();
                document.getElementById('headerUserDept').textContent = 
                    `${this.currentUser.department.name} / ${this.currentUser.team.name}`;
                this.showOrganizationView();
            },
            
            showAlert(message, type = 'error') {
                const alertDiv = document.getElementById('loginAlert');
                alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
                setTimeout(() => alertDiv.innerHTML = '', 3000);
            },
            
            updateBreadcrumb() {
                const breadcrumb = document.getElementById('breadcrumb');
                let html = '<span class="breadcrumb-item" onclick="app.showOrganizationView()">ğŸ¢ å…¨çµ„ç¹”</span>';
                
                if (this.currentBoard) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showBoardView()">${this.currentBoard.name}</span>`;
                }
                
                if (this.currentDepartment) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showDepartmentView('${this.currentDepartment.id}')">${this.currentDepartment.name}</span>`;
                }
                
                if (this.currentTeam) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showTeamView('${this.currentTeam.id}')">${this.currentTeam.name}</span>`;
                }
                
                if (this.currentMeeting) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item" onclick="app.showMeetingView('${this.currentMeeting.id}')">${this.currentMeeting.name}</span>`;
                }
                
                if (this.currentMinute) {
                    html += '<span class="breadcrumb-separator">â€º</span>';
                    html += `<span class="breadcrumb-item active">${this.currentMinute.topic}</span>`;
                }
                
                breadcrumb.innerHTML = html;
            },
            
            showOrganizationView() {
                this.currentView = 'organization';
                this.currentBoard = null;
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                let html = '<div class="card">';
                html += '<div class="card-title">ğŸ¢ çµ„ç¹”éšå±¤ä¸€è¦§ - å…¨ç¤¾ã®ä¼šè­°ãƒ»è­°äº‹éŒ²ã‚’ç®¡ç†</div>';
                html += '<div class="org-hierarchy">';
                
                // Board level - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªãƒ†ãƒ¼ãƒ–ãƒ«é¢¨ãƒ‡ã‚¶ã‚¤ãƒ³
                html += '<div class="org-level" style="margin-bottom: 20px;">';
                html += `<div class="org-level-header" style="background: #2c3e50; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #3498db; flex-wrap: wrap; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 200px;">
                        <span style="font-size: 18px;">ğŸ›ï¸</span>
                        <div>
                            <span style="color: white; font-size: 15px; font-weight: 700; display: block;">çµŒå–¶å±¤ï¼ˆãƒœãƒ¼ãƒ‰ï¼‰</span>
                            <span style="color: #95a5a6; font-size: 11px;">ä¼šç¤¾å…¨ä½“ã®çµŒå–¶ä¼šè­°</span>
                        </div>
                    </div>
                    <button class="btn btn-sm" onclick="app.addBoard()" style="padding: 6px 14px; font-size: 12px; background: #3498db; color: white; border: none; border-radius: 3px; font-weight: 600; white-space: nowrap;">+ è¿½åŠ </button>
                </div>`;
                
                // ãƒœãƒ¼ãƒ‰ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œé¢¨ã«è¡¨ç¤º
                html += '<div style="background: white; border: 1px solid #ddd; border-top: none;">';
                
                this.demoData.boards.forEach((board, index) => {
                    const bgColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                    html += `
                        <div class="org-item org-item-responsive" data-board-id="${board.id}" onclick="app.showBoardView('${board.id}')" style="
                            background: ${bgColor};
                            border-bottom: 1px solid #e9ecef;
                            cursor: pointer;
                            transition: background 0.2s;
                            padding: 12px 16px;
                        " onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='${bgColor}'">
                            <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                                <div style="font-size: 24px;">ğŸ‘”</div>
                                <div style="flex: 1; min-width: 150px;">
                                    <div style="font-size: 14px; font-weight: 700; color: #2c3e50; margin-bottom: 2px;">${board.name}</div>
                                    <div style="font-size: 11px; color: #7f8c8d;">çµŒå–¶å±¤ãƒ»å…¨ç¤¾ä¼šè­°</div>
                                </div>
                                <div style="margin: 4px 0;">
                                    <span style="display: inline-block; background: #3498db; color: white; padding: 4px 12px; border-radius: 3px; font-size: 12px; font-weight: 600;">
                                        ğŸ“Š ${this.getMeetingCount(board.id)}ä»¶ã®ä¼šè­°
                                    </span>
                                </div>
                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                    <button onclick="event.stopPropagation(); app.editBoard('${board.id}')" style="padding: 5px 10px; font-size: 11px; background: white; color: #7f8c8d; border: 1px solid #ddd; border-radius: 3px; cursor: pointer;">ç·¨é›†</button>
                                    <button onclick="event.stopPropagation(); app.deleteBoard('${board.id}')" style="padding: 5px 10px; font-size: 11px; background: white; color: #e74c3c; border: 1px solid #e74c3c; border-radius: 3px; cursor: pointer;">å‰Šé™¤</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
                
                // Department and Team levels - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªãƒ†ãƒ¼ãƒ–ãƒ«é¢¨
                html += '<div style="margin-top: 30px;">';
                html += `<div class="org-level-header" style="background: #27ae60; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #2ecc71; flex-wrap: wrap; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 200px;">
                        <span style="font-size: 18px;">ğŸ¢</span>
                        <div>
                            <span style="color: white; font-size: 15px; font-weight: 700; display: block;">éƒ¨é–€ãƒ»ãƒãƒ¼ãƒ ä¸€è¦§</span>
                            <span style="color: #a8e6cf; font-size: 11px;">å„éƒ¨é–€ã¨ãƒãƒ¼ãƒ ã®ä¼šè­°</span>
                        </div>
                    </div>
                    <button class="btn btn-sm" onclick="app.addDepartment()" style="padding: 6px 14px; font-size: 12px; background: #2ecc71; color: white; border: none; border-radius: 3px; font-weight: 600; white-space: nowrap;">+ è¿½åŠ </button>
                </div>`;
                
                html += '<div style="background: white; border: 1px solid #ddd; border-top: none;">';
                
                this.demoData.departments.forEach((dept, deptIndex) => {
                    const totalMeetings = dept.teams.reduce((sum, team) => sum + this.getMeetingCount(team.id), 0);
                    const deptBg = '#34495e';
                    
                    // éƒ¨é–€ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
                    html += `
                        <div class="org-item-responsive" style="padding: 10px 16px; background: ${deptBg}; border-bottom: 1px solid #2c3e50; cursor: pointer;" onclick="app.showDepartmentView('${dept.id}')">
                            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                <div style="font-size: 20px;">ğŸ“</div>
                                <div style="flex: 1; min-width: 120px;">
                                    <span style="font-size: 14px; font-weight: 700; color: white;">${dept.name}</span>
                                </div>
                                <div style="margin: 4px 0;">
                                    <span style="background: #7f8c8d; color: white; padding: 4px 10px; border-radius: 3px; font-size: 11px; font-weight: 600;">
                                        ${dept.teams.length}ãƒãƒ¼ãƒ ãƒ»${totalMeetings}ä»¶
                                    </span>
                                </div>
                                <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                    <button onclick="event.stopPropagation(); app.addTeam('${dept.id}')" style="padding: 4px 10px; font-size: 11px; background: #27ae60; color: white; border: none; border-radius: 3px; cursor: pointer; font-weight: 600;">+ãƒãƒ¼ãƒ </button>
                                    <button onclick="event.stopPropagation(); app.editDepartment('${dept.id}')" style="padding: 4px 8px; font-size: 11px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 3px; cursor: pointer;">ç·¨é›†</button>
                                    <button onclick="event.stopPropagation(); app.deleteDepartment('${dept.id}')" style="padding: 4px 8px; font-size: 11px; background: rgba(231,76,60,0.8); color: white; border: none; border-radius: 3px; cursor: pointer;">å‰Šé™¤</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // ãƒãƒ¼ãƒ è¡Œï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä»˜ãï¼‰
                    dept.teams.forEach((team, teamIndex) => {
                        const teamBg = teamIndex % 2 === 0 ? '#ecf0f1' : '#ffffff';
                        html += `
                            <div class="org-item org-item-responsive" data-team-id="${team.id}" onclick="app.showTeamView('${team.id}')" style="
                                padding: 10px 16px 10px 30px;
                                background: ${teamBg};
                                border-bottom: 1px solid #dee2e6;
                                cursor: pointer;
                                transition: background 0.2s;
                            " onmouseover="this.style.background='#d1f2eb'" onmouseout="this.style.background='${teamBg}'">
                                <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                    <div style="font-size: 18px;">ğŸ‘¥</div>
                                    <div style="flex: 1; min-width: 120px;">
                                        <div style="font-size: 13px; font-weight: 600; color: #2c3e50;">${team.name}</div>
                                        <div style="font-size: 10px; color: #95a5a6; margin-top: 1px;">${dept.name}</div>
                                    </div>
                                    <div style="margin: 4px 0;">
                                        <span style="background: #27ae60; color: white; padding: 3px 10px; border-radius: 3px; font-size: 11px; font-weight: 600;">
                                            ğŸ“‹ ${this.getMeetingCount(team.id)}ä»¶
                                        </span>
                                    </div>
                                    <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                        <button onclick="event.stopPropagation(); app.editTeam('${team.id}')" style="padding: 4px 10px; font-size: 10px; background: white; color: #7f8c8d; border: 1px solid #ddd; border-radius: 3px; cursor: pointer;">ç·¨é›†</button>
                                        <button onclick="event.stopPropagation(); app.deleteTeam('${team.id}')" style="padding: 4px 10px; font-size: 10px; background: white; color: #e74c3c; border: 1px solid #e74c3c; border-radius: 3px; cursor: pointer;">å‰Šé™¤</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                });
                
                html += '</div></div>';
                content.innerHTML = html;
            },
            
            showBoardView() {
                this.currentView = 'board';
                this.currentBoard = this.demoData.boards[0]; // æœ€åˆã®ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ï¼ˆå¾Œã§æ”¹å–„å¯èƒ½ï¼‰
                this.currentDepartment = null;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const meetings = this.demoData.generateMeetings('board-1');
                
                const content = document.getElementById('contentArea');
                
                // TOPã¨åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«é¢¨UI
                let html = '<button class="btn btn-secondary back-btn" onclick="app.showOrganizationView()" style="margin-bottom: 15px; padding: 8px 16px; font-size: 13px; background: #95a5a6; color: white; border: none; border-radius: 3px;">â† æˆ»ã‚‹</button>';
                
                html += `<div style="background: #2c3e50; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #3498db;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 18px;">ğŸ“…</span>
                        <span style="color: white; font-size: 15px; font-weight: 700; letter-spacing: 0.5px;">${this.currentBoard.name} ã®ä¼šè­°ä¸€è¦§</span>
                    </div>
                    <button class="btn btn-sm" onclick="app.openAddMeetingModal('board-1')" style="padding: 6px 14px; font-size: 12px; background: #3498db; color: white; border: none; border-radius: 3px; font-weight: 600;">+ ä¼šè­°è¿½åŠ </button>
                </div>`;
                
                // ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œé¢¨ã«è¡¨ç¤º
                html += '<div style="background: white; border: 1px solid #ddd; border-top: none;">';
                
                if (meetings.length === 0) {
                    html += '<div style="padding: 40px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">ä¼šè­°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å³ä¸Šã®ã€Œ+ ä¼šè­°è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
                } else {
                    meetings.forEach((meeting, index) => {
                        const bgColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                        html += `
                            <div style="
                                display: grid;
                                grid-template-columns: 50px 1fr 280px;
                                align-items: center;
                                padding: 10px 20px;
                                background: ${bgColor};
                                border-bottom: 1px solid #e9ecef;
                                cursor: pointer;
                                transition: background 0.2s;
                            " onmouseover="this.style.background='#e3f2fd'" onmouseout="this.style.background='${bgColor}'">
                                <div style="font-size: 24px; text-align: center;">ğŸ“‹</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 700; color: #2c3e50;">${meeting.name}</div>
                                    <div style="font-size: 11px; color: #7f8c8d; margin-top: 2px;">${this.currentBoard.name}</div>
                                </div>
                                <div style="display: flex; gap: 6px; justify-content: flex-end;">
                                    <button class="detail-btn" data-meeting-id="${meeting.id}" style="padding: 6px 16px; font-size: 12px; background: #3498db; color: white; border: none; border-radius: 3px; cursor: pointer; font-weight: 600;">è©³ç´°</button>
                                    <button class="edit-meeting-btn" data-meeting-id="${meeting.id}" style="padding: 6px 12px; font-size: 11px; background: white; color: #7f8c8d; border: 1px solid #ddd; border-radius: 3px; cursor: pointer;">ç·¨é›†</button>
                                    <button class="delete-meeting-btn" data-meeting-id="${meeting.id}" style="padding: 6px 12px; font-size: 11px; background: white; color: #e74c3c; border: 1px solid #e74c3c; border-radius: 3px; cursor: pointer;">å‰Šé™¤</button>
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                content.innerHTML = html;
                
                // â˜… DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                setTimeout(() => {
                    // è©³ç´°ãƒœã‚¿ãƒ³
                    const detailButtons = content.querySelectorAll('.detail-btn');
                    console.log(`Found ${detailButtons.length} detail buttons`);
                    
                    detailButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const meetingId = button.getAttribute('data-meeting-id');
                            console.log('Detail button clicked:', meetingId);
                            this.showMeetingView(meetingId);
                        });
                    });
                    
                    // ç·¨é›†ãƒœã‚¿ãƒ³
                    const editButtons = content.querySelectorAll('.edit-meeting-btn');
                    editButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const meetingId = button.getAttribute('data-meeting-id');
                            this.openEditMeetingModal(meetingId);
                        });
                    });
                    
                    // å‰Šé™¤ãƒœã‚¿ãƒ³
                    const deleteButtons = content.querySelectorAll('.delete-meeting-btn');
                    deleteButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            const meetingId = button.getAttribute('data-meeting-id');
                            this.deleteMeeting(meetingId);
                        });
                    });
                    
                    console.log('âœ… All button handlers attached');
                }, 100);
            },
            
            showDepartmentView(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) return;
                
                this.currentView = 'department';
                this.currentBoard = null;
                this.currentDepartment = dept;
                this.currentTeam = null;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                
                // TOPã¨åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«é¢¨UI
                let html = '<button class="btn btn-secondary back-btn" onclick="app.showOrganizationView()" style="margin-bottom: 15px; padding: 8px 16px; font-size: 13px; background: #95a5a6; color: white; border: none; border-radius: 3px;">â† æˆ»ã‚‹</button>';
                
                html += `<div style="background: #27ae60; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #2ecc71;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 18px;">ğŸ‘¥</span>
                        <span style="color: white; font-size: 15px; font-weight: 700; letter-spacing: 0.5px;">${dept.name} ã®ãƒãƒ¼ãƒ ä¸€è¦§</span>
                    </div>
                    <button class="btn btn-sm" onclick="app.addTeam('${dept.id}')" style="padding: 6px 14px; font-size: 12px; background: #2ecc71; color: white; border: none; border-radius: 3px; font-weight: 600;">+ ãƒãƒ¼ãƒ è¿½åŠ </button>
                </div>`;
                
                html += '<div style="background: white; border: 1px solid #ddd; border-top: none;">';
                
                if (dept.teams.length === 0) {
                    html += '<div style="padding: 40px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å³ä¸Šã®ã€Œ+ ãƒãƒ¼ãƒ è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
                } else {
                    dept.teams.forEach((team, index) => {
                        const bgColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                        html += `
                            <div onclick="app.showTeamView('${team.id}')" style="
                                display: grid;
                                grid-template-columns: 50px 1fr 180px;
                                align-items: center;
                                padding: 10px 20px;
                                background: ${bgColor};
                                border-bottom: 1px solid #e9ecef;
                                cursor: pointer;
                                transition: background 0.2s;
                            " onmouseover="this.style.background='#d1f2eb'" onmouseout="this.style.background='${bgColor}'">
                                <div style="font-size: 24px; text-align: center;">ğŸ‘¥</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 700; color: #2c3e50;">${team.name}</div>
                                    <div style="font-size: 11px; color: #7f8c8d; margin-top: 2px;">${dept.name}</div>
                                </div>
                                <div style="text-align: center;">
                                    <span style="background: #27ae60; color: white; padding: 4px 12px; border-radius: 3px; font-size: 12px; font-weight: 600;">
                                        ğŸ“‹ ${this.getMeetingCount(team.id)}ä»¶ã®ä¼šè­°
                                    </span>
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                content.innerHTML = html;
            },
            
            showTeamView(teamId) {
                let team = null;
                for (const dept of this.demoData.departments) {
                    team = dept.teams.find(t => t.id === teamId);
                    if (team) {
                        this.currentDepartment = dept;
                        break;
                    }
                }
                if (!team) return;
                
                this.currentView = 'team';
                this.currentBoard = null;
                this.currentTeam = team;
                this.currentMeeting = null;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const meetings = this.demoData.generateMeetings(teamId);
                
                const content = document.getElementById('contentArea');
                
                // TOPã¨åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«é¢¨UI
                let html = `<button class="btn btn-secondary back-btn" onclick="app.showDepartmentView('${this.currentDepartment.id}')" style="margin-bottom: 15px; padding: 8px 16px; font-size: 13px; background: #95a5a6; color: white; border: none; border-radius: 3px;">â† æˆ»ã‚‹</button>`;
                
                html += `<div style="background: #27ae60; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #2ecc71;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 18px;">ğŸ“…</span>
                        <span style="color: white; font-size: 15px; font-weight: 700; letter-spacing: 0.5px;">${team.name} ã®ä¼šè­°ä¸€è¦§</span>
                        <span style="color: #a8e6cf; font-size: 12px; margin-left: 8px;">${this.currentDepartment.name}</span>
                    </div>
                    <button class="btn btn-sm" onclick="app.openAddMeetingModal('${teamId}')" style="padding: 6px 14px; font-size: 12px; background: #2ecc71; color: white; border: none; border-radius: 3px; font-weight: 600;">+ ä¼šè­°è¿½åŠ </button>
                </div>`;
                
                html += '<div style="background: white; border: 1px solid #ddd; border-top: none;">';
                
                if (meetings.length === 0) {
                    html += '<div style="padding: 40px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">ä¼šè­°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å³ä¸Šã®ã€Œ+ ä¼šè­°è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
                } else {
                    meetings.forEach((meeting, index) => {
                        const bgColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                        html += `
                            <div style="
                                display: grid;
                                grid-template-columns: 50px 1fr 280px;
                                align-items: center;
                                padding: 10px 20px;
                                background: ${bgColor};
                                border-bottom: 1px solid #e9ecef;
                                cursor: pointer;
                                transition: background 0.2s;
                            " onmouseover="this.style.background='#d1f2eb'" onmouseout="this.style.background='${bgColor}'">
                                <div style="font-size: 24px; text-align: center;">ğŸ“‹</div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 700; color: #2c3e50;">${meeting.name}</div>
                                    <div style="font-size: 11px; color: #7f8c8d; margin-top: 2px;">${team.name} - ${this.currentDepartment.name}</div>
                                </div>
                                <div style="display: flex; gap: 6px; justify-content: flex-end;">
                                    <button class="detail-btn" data-meeting-id="${meeting.id}" style="padding: 6px 16px; font-size: 12px; background: #27ae60; color: white; border: none; border-radius: 3px; cursor: pointer; font-weight: 600;">è©³ç´°</button>
                                    <button class="edit-meeting-btn" data-meeting-id="${meeting.id}" style="padding: 6px 12px; font-size: 11px; background: white; color: #7f8c8d; border: 1px solid #ddd; border-radius: 3px; cursor: pointer;">ç·¨é›†</button>
                                    <button class="delete-meeting-btn" data-meeting-id="${meeting.id}" style="padding: 6px 12px; font-size: 11px; background: white; color: #e74c3c; border: 1px solid #e74c3c; border-radius: 3px; cursor: pointer;">å‰Šé™¤</button>
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                content.innerHTML = html;
                
                // â˜… DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                if (meetings.length > 0) {
                    setTimeout(() => {
                        // è©³ç´°ãƒœã‚¿ãƒ³
                        const detailButtons = content.querySelectorAll('.detail-btn');
                        console.log(`Found ${detailButtons.length} detail buttons in team view`);
                        
                        detailButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const meetingId = button.getAttribute('data-meeting-id');
                                console.log('Detail button clicked:', meetingId);
                                this.showMeetingView(meetingId);
                            });
                        });
                        
                        // ç·¨é›†ãƒœã‚¿ãƒ³
                        const editButtons = content.querySelectorAll('.edit-meeting-btn');
                        editButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const meetingId = button.getAttribute('data-meeting-id');
                                this.openEditMeetingModal(meetingId);
                            });
                        });
                        
                        // å‰Šé™¤ãƒœã‚¿ãƒ³
                        const deleteButtons = content.querySelectorAll('.delete-meeting-btn');
                        deleteButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const meetingId = button.getAttribute('data-meeting-id');
                                this.deleteMeeting(meetingId);
                            });
                        });
                        
                        console.log('âœ… All button handlers attached in team view');
                    }, 100);
                }
            },
            
            showMeetingView(meetingId) {
                console.log('showMeetingView called with:', meetingId);
                
                // Find meeting
                let meeting = null;
                
                // Check if it's a board meeting (format: meeting-board-1-0)
                if (meetingId.includes('board')) {
                    console.log('Detected board meeting');
                    const meetings = this.demoData.generateMeetings('board-1');
                    meeting = meetings.find(m => m.id === meetingId);
                    
                    if (meeting) {
                        this.currentBoard = this.demoData.boards[0]; // æœ€åˆã®ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨
                        this.currentDepartment = null;
                        this.currentTeam = null;
                    }
                } else {
                    // Find team from meetingId
                    console.log('Searching for team meeting');
                    let foundTeam = null;
                    for (const dept of this.demoData.departments) {
                        const team = dept.teams.find(t => meetingId.includes(t.id));
                        if (team) {
                            foundTeam = team;
                            this.currentTeam = team;
                            this.currentDepartment = dept;
                            this.currentBoard = null;
                            break;
                        }
                    }
                    
                    if (foundTeam) {
                        const meetings = this.demoData.generateMeetings(foundTeam.id);
                        meeting = meetings.find(m => m.id === meetingId);
                    }
                }
                
                if (!meeting) {
                    console.error('Meeting not found:', meetingId);
                    alert('ä¼šè­°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + meetingId);
                    return;
                }
                
                console.log('Meeting found:', meeting);
                
                this.currentView = 'meeting';
                this.currentMeeting = meeting;
                this.currentMinute = null;
                
                this.updateBreadcrumb();
                
                const minutes = this.demoData.generateMinutes(meetingId);
                
                const content = document.getElementById('contentArea');
                
                // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆthisã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ï¼‰
                let backAction;
                if (this.currentBoard) {
                    backAction = 'app.showBoardView()';
                } else if (this.currentTeam && this.currentTeam.id) {
                    backAction = `app.showTeamView('${this.currentTeam.id}')`;
                } else {
                    backAction = 'app.showOrganizationView()';
                }
                
                // TOPã¨åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«é¢¨UI
                let html = `<button class="btn btn-secondary back-btn" onclick="${backAction}" style="margin-bottom: 15px; padding: 8px 16px; font-size: 13px; background: #95a5a6; color: white; border: none; border-radius: 3px;">â† æˆ»ã‚‹</button>`;
                
                const headerColor = this.currentBoard ? '#2c3e50' : '#27ae60';
                const borderColor = this.currentBoard ? '#3498db' : '#2ecc71';
                
                html += `<div style="background: ${headerColor}; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid ${borderColor};">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 18px;">ğŸ“</span>
                        <span style="color: white; font-size: 15px; font-weight: 700; letter-spacing: 0.5px;">${meeting.name} ã®è­°äº‹éŒ²ä¸€è¦§</span>
                        <span style="color: rgba(255,255,255,0.7); font-size: 12px; margin-left: 8px;">é–‹å‚¬æ—¥: ${meeting.date}</span>
                    </div>
                    <button class="btn btn-sm" onclick="app.openAddMinuteModal('${meetingId}')" style="padding: 6px 14px; font-size: 12px; background: ${borderColor}; color: white; border: none; border-radius: 3px; font-weight: 600;">+ è­°äº‹éŒ²è¿½åŠ </button>
                </div>`;
                
                html += '<div style="background: white; border: 1px solid #ddd; border-top: none;">';
                
                if (minutes.length === 0) {
                    html += '<div style="padding: 40px 20px; text-align: center; color: #7f8c8d; font-size: 14px;">è­°äº‹éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚å³ä¸Šã®ã€Œ+ è­°äº‹éŒ²è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</div>';
                } else {
                    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’è¿½åŠ 
                    html += `
                        <div class="meeting-list-header" style="
                            display: grid;
                            grid-template-columns: 110px 250px 220px 140px 200px 100px 1fr;
                            align-items: center;
                            padding: 12px 20px 12px 20px;
                            background: #34495e;
                            border-bottom: 2px solid #2c3e50;
                            font-weight: 700;
                            color: white;
                            font-size: 13px;
                        ">
                            <div>ä¼šè­°æ—¥</div>
                            <div>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</div>
                            <div>ä¼šè­°å‚åŠ è€…</div>
                            <div>ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚¿ãƒ¼</div>
                            <div>å‚™è€ƒ</div>
                            <div style="text-align: center;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                            <div style="text-align: right; padding-right: 0;">æ“ä½œ</div>
                        </div>
                    `;
                    
                    // è­°äº‹éŒ²ã‚’é™é †ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„ã‚‚ã®ãŒä¸Šï¼‰
                    const sortedMinutes = [...minutes].sort((a, b) => {
                        const dateA = new Date(a.meetingDate || a.created || 0);
                        const dateB = new Date(b.meetingDate || b.created || 0);
                        return dateB - dateA; // é™é †
                    });
                    
                    const statusMap = {
                        'not-held': { color: '#f39c12', text: 'ä¼šè­°æœªå®Ÿæ–½', badge: 'badge-not-held' },  // ã‚ªãƒ¬ãƒ³ã‚¸
                        'completed-with-tasks': { color: '#e74c3c', text: 'ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ã‚ã‚Šï¼‰', badge: 'badge-completed-with-tasks' },  // èµ¤
                        'completed-no-tasks': { color: '#3498db', text: 'ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ãªã—ï¼‰', badge: 'badge-completed-no-tasks' },  // é’
                        // æ—§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆäº’æ›æ€§ï¼‰
                        'pending': { color: '#f39c12', text: 'æœªç€æ‰‹', badge: 'badge-pending' },
                        'progress': { color: '#3498db', text: 'é€²è¡Œä¸­', badge: 'badge-progress' },
                        'completed': { color: '#27ae60', text: 'å®Œäº†', badge: 'badge-completed' },
                        'overdue': { color: '#e74c3c', text: 'æœŸé™è¶…é', badge: 'badge-overdue' }
                    };
                    
                    sortedMinutes.forEach((minute, index) => {
                        const bgColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                        const status = statusMap[minute.status] || statusMap['not-held'];
                        
                        // å‚åŠ è€…ã®è¡¨ç¤ºï¼ˆæ”¹è¡Œã¾ãŸã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
                        const participantsList = (minute.participants || '').split(/[\n,]/).map(p => p.trim()).filter(p => p).join(', ');
                        const participantsDisplay = participantsList.length > 60 ? participantsList.substring(0, 60) + '...' : participantsList || '-';
                        
                        // å‚™è€ƒã®è¡¨ç¤º
                        const notesDisplay = (minute.notes || '-').substring(0, 60);
                        const notesShort = notesDisplay.length >= 60 ? notesDisplay + '...' : notesDisplay;
                        
                        html += `
                            <div class="meeting-list-row inline-editable-row" data-minute-id="${minute.id}" style="
                                display: grid;
                                grid-template-columns: 110px 250px 220px 140px 200px 100px 1fr;
                                align-items: center;
                                padding: 10px 20px 10px 20px;
                                background: ${bgColor};
                                border-bottom: 1px solid #e9ecef;
                                transition: background 0.2s;
                            " onmouseover="this.style.background='#e8f5e9'" onmouseout="this.style.background='${bgColor}'">
                                <div style="display: flex; align-items: center; gap: 6px; position: relative;">
                                    <span style="font-size: 16px; cursor: pointer; user-select: none;" onclick="app.showDatePicker('${minute.id}')" title="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠ">ğŸ“…</span>
                                    <div class="inline-edit" data-field="meetingDate" style="font-size: 13px; color: #2c3e50; font-weight: 600; cursor: text; padding: 4px; border-radius: 3px; flex: 1;" contenteditable="true">${minute.meetingDate || '-'}</div>
                                    <input type="date" id="datePicker-${minute.id}" style="position: absolute; left: 0; top: 0; opacity: 0; width: 1px; height: 1px; pointer-events: none;" onchange="app.updateMeetingDate('${minute.id}', this.value)">
                                </div>
                                <div class="inline-edit" data-field="subtitle" style="font-size: 14px; font-weight: 700; color: #2c3e50; cursor: text; padding: 4px; border-radius: 3px;" contenteditable="true">${minute.subtitle || minute.meetingName || 'è­°äº‹éŒ²'}</div>
                                <div class="inline-edit" data-field="participants" style="font-size: 12px; color: #7f8c8d; cursor: text; padding: 4px; border-radius: 3px;" contenteditable="true" title="${minute.participants || ''}">${participantsDisplay}</div>
                                <div class="inline-edit" data-field="facilitator" style="font-size: 12px; color: #7f8c8d; cursor: text; padding: 4px; border-radius: 3px;" contenteditable="true">${minute.facilitator || '-'}</div>
                                <div class="inline-edit" data-field="notes" style="font-size: 11px; color: #95a5a6; cursor: text; padding: 4px; border-radius: 3px;" contenteditable="true" title="${minute.notes || ''}">${minute.notes || '-'}</div>
                                <div style="text-align: center;">
                                    <select class="status-dropdown" data-field="status" 
                                        style="background: ${status.color}; color: white; padding: 6px 24px 6px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; border: none; cursor: pointer; appearance: none; 
                                        background-image: url('data:image/svg+xml;utf8,<svg fill=\"white\" height=\"20\" viewBox=\"0 0 24 24\" width=\"20\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>'); 
                                        background-repeat: no-repeat; 
                                        background-position: right 4px center; 
                                        background-size: 16px; 
                                        transition: all 0.2s ease;"
                                        onmouseover="this.style.transform = 'scale(1.05)'; this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';"
                                        onmouseout="this.style.transform = 'scale(1)'; this.style.boxShadow = 'none';">
                                        <option value="not-held" ${minute.status === 'not-held' ? 'selected' : ''}>ä¼šè­°æœªå®Ÿæ–½</option>
                                        <option value="completed-with-tasks" ${minute.status === 'completed-with-tasks' ? 'selected' : ''}>ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ã‚ã‚Šï¼‰</option>
                                        <option value="completed-no-tasks" ${minute.status === 'completed-no-tasks' ? 'selected' : ''}>ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ãªã—ï¼‰</option>
                                    </select>
                                </div>
                                <div style="display: flex; gap: 6px; justify-content: flex-end; padding-right: 0;">
                                    <button class="detail-minute-btn" data-minute-id="${minute.id}" style="padding: 6px 16px; font-size: 12px; background: ${headerColor}; color: white; border: none; border-radius: 3px; cursor: pointer; font-weight: 600;">è©³ç´°</button>
                                    <button class="delete-minute-btn" data-minute-id="${minute.id}" style="padding: 6px 12px; font-size: 11px; background: white; color: #e74c3c; border: 1px solid #e74c3c; border-radius: 3px; cursor: pointer;">å‰Šé™¤</button>
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                content.innerHTML = html;
                
                // â˜… DOMã«è¿½åŠ ã•ã‚ŒãŸå¾Œã€ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                if (minutes.length > 0) {
                    setTimeout(() => {
                        // è©³ç´°ãƒœã‚¿ãƒ³
                        const detailButtons = content.querySelectorAll('.detail-minute-btn');
                        detailButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const minuteId = button.getAttribute('data-minute-id');
                                this.showMinuteDetailTable(minuteId);
                            });
                        });
                        
                        // ç·¨é›†ãƒœã‚¿ãƒ³
                        const editButtons = content.querySelectorAll('.edit-minute-btn');
                        editButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const minuteId = button.getAttribute('data-minute-id');
                                this.openEditMinuteModal(minuteId);
                            });
                        });
                        
                        // å‰Šé™¤ãƒœã‚¿ãƒ³
                        const deleteButtons = content.querySelectorAll('.delete-minute-btn');
                        deleteButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                const minuteId = button.getAttribute('data-minute-id');
                                this.archiveMinute(minuteId);
                            });
                        });
                        
                        console.log('âœ… All minute button handlers attached');
                    }, 100);
                }
            },
            
            openAddMeetingModal(entityId) {
                const meetingName = prompt('æ–°ã—ã„ä¼šè­°åç§°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (!meetingName || meetingName.trim() === '') {
                    return;
                }
                
                // æ–°ã—ã„ä¼šè­°ã‚’ä½œæˆ
                const newMeeting = {
                    id: `meeting-${entityId}-${Date.now()}`,
                    entityId: entityId,
                    name: meetingName.trim(),
                    date: new Date().toISOString().split('T')[0],
                    minutesCount: 0,
                    participants: 0
                };
                
                // LocalStorageã«ä¿å­˜
                if (!this.meetingsData[entityId]) {
                    this.meetingsData[entityId] = [];
                }
                this.meetingsData[entityId].push(newMeeting);
                this.saveToLocalStorage();
                
                alert(`âœ… ä¼šè­°ã€Œ${meetingName}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
                
                // ç”»é¢ã‚’å†è¡¨ç¤º
                if (entityId === 'board-1') {
                    this.showBoardView();
                } else {
                    this.showTeamView(entityId);
                }
            },
            
            openEditMeetingModal(meetingId) {
                // ä¼šè­°ã‚’æ¤œç´¢
                let meeting = null;
                let entityId = null;
                
                for (const [key, meetings] of Object.entries(this.meetingsData)) {
                    meeting = meetings.find(m => m.id === meetingId);
                    if (meeting) {
                        entityId = key;
                        break;
                    }
                }
                
                if (!meeting) {
                    alert('âŒ ä¼šè­°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('ä¼šè­°åç§°ã‚’ç·¨é›†ã—ã¦ãã ã•ã„ï¼š', meeting.name);
                if (!newName || newName.trim() === '') {
                    return;
                }
                
                meeting.name = newName.trim();
                this.saveToLocalStorage();
                alert(`âœ… ä¼šè­°åç§°ã‚’ã€Œ${newName}ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ`);
                
                // ç”»é¢ã‚’å†è¡¨ç¤º
                if (this.currentBoard) {
                    this.showBoardView();
                } else if (this.currentTeam) {
                    this.showTeamView(this.currentTeam.id);
                }
            },
            
            deleteMeeting(meetingId) {
                // è­°äº‹éŒ²ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (this.minutesData[meetingId]) {
                    const minutes = this.minutesData[meetingId].filter(m => !m.archived);
                    if (minutes.length > 0) {
                        alert(`âŒ ã“ã®ä¼šè­°ã«ã¯${minutes.length}ä»¶ã®è­°äº‹éŒ²ãŒã‚ã‚‹ãŸã‚ã€å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚\nå…ˆã«è­°äº‹éŒ²ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚`);
                        return;
                    }
                }
                
                // ä¼šè­°ã‚’æ¤œç´¢ã—ã¦å‰Šé™¤
                let meeting = null;
                let entityId = null;
                
                for (const [key, meetings] of Object.entries(this.meetingsData)) {
                    const index = meetings.findIndex(m => m.id === meetingId);
                    if (index !== -1) {
                        meeting = meetings[index];
                        entityId = key;
                        
                        if (confirm(`ä¼šè­°ã€Œ${meeting.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                            meetings.splice(index, 1);
                            this.saveToLocalStorage();
                            alert(`âœ… ä¼šè­°ã€Œ${meeting.name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
                            
                            // ç”»é¢ã‚’å†è¡¨ç¤º
                            if (this.currentBoard) {
                                this.showBoardView();
                            } else if (this.currentTeam) {
                                this.showTeamView(this.currentTeam.id);
                            }
                        }
                        return;
                    }
                }
                
                alert('âŒ ä¼šè­°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            },
            
            // ========== Board Management ==========
            addBoard() {
                const name = prompt('æ–°ã—ã„ãƒœãƒ¼ãƒ‰åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (name && name.trim()) {
                    const newBoard = {
                        id: `board-${Date.now()}`,
                        name: name.trim()
                    };
                    this.demoData.boards.push(newBoard);
                    alert('âœ… ãƒœãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            editBoard(boardId) {
                const board = this.demoData.boards.find(b => b.id === boardId);
                if (!board) {
                    alert('âŒ ãƒœãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('ãƒœãƒ¼ãƒ‰åã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š', board.name);
                if (newName && newName.trim()) {
                    board.name = newName.trim();
                    alert('âœ… ãƒœãƒ¼ãƒ‰åã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            deleteBoard(boardId) {
                // ä¼šè­°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèª
                const hasMeetings = this.getMeetingCount(boardId) > 0;
                if (hasMeetings) {
                    alert('âŒ ã“ã®ãƒœãƒ¼ãƒ‰ã«ã¯ä¼šè­°ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“');
                    return;
                }
                
                if (confirm('ã“ã®ãƒœãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    const index = this.demoData.boards.findIndex(b => b.id === boardId);
                    if (index !== -1) {
                        this.demoData.boards.splice(index, 1);
                        alert('âœ… ãƒœãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                        this.showOrganizationView();
                    }
                }
            },
            
            // ========== Department Management ==========
            addDepartment() {
                const name = prompt('æ–°ã—ã„éƒ¨é–€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (name && name.trim()) {
                    const newDept = {
                        id: `dept-${Date.now()}`,
                        name: name.trim(),
                        teams: []
                    };
                    this.demoData.departments.push(newDept);
                    alert('âœ… éƒ¨é–€ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            editDepartment(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) {
                    alert('âŒ éƒ¨é–€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('éƒ¨é–€åã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š', dept.name);
                if (newName && newName.trim()) {
                    dept.name = newName.trim();
                    alert('âœ… éƒ¨é–€åã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            deleteDepartment(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) {
                    alert('âŒ éƒ¨é–€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                if (dept.teams.length > 0) {
                    alert('âŒ ãƒãƒ¼ãƒ ãŒå­˜åœ¨ã™ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚å…ˆã«ãƒãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (confirm(`éƒ¨é–€ã€Œ${dept.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    const index = this.demoData.departments.findIndex(d => d.id === deptId);
                    this.demoData.departments.splice(index, 1);
                    alert('âœ… éƒ¨é–€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            // ========== Team Management ==========
            addTeam(deptId) {
                const dept = this.demoData.departments.find(d => d.id === deptId);
                if (!dept) {
                    alert('âŒ éƒ¨é–€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const name = prompt('æ–°ã—ã„ãƒãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š');
                if (name && name.trim()) {
                    const newTeam = {
                        id: `team-${Date.now()}`,
                        name: name.trim(),
                        departmentId: deptId,
                        meetingCount: 0
                    };
                    dept.teams.push(newTeam);
                    alert('âœ… ãƒãƒ¼ãƒ ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            editTeam(teamId) {
                let team = null;
                let dept = null;
                
                for (const d of this.demoData.departments) {
                    const t = d.teams.find(tm => tm.id === teamId);
                    if (t) {
                        team = t;
                        dept = d;
                        break;
                    }
                }
                
                if (!team) {
                    alert('âŒ ãƒãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                const newName = prompt('ãƒãƒ¼ãƒ åã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼š', team.name);
                if (newName && newName.trim()) {
                    team.name = newName.trim();
                    alert('âœ… ãƒãƒ¼ãƒ åã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            deleteTeam(teamId) {
                let team = null;
                let dept = null;
                
                for (const d of this.demoData.departments) {
                    const t = d.teams.find(tm => tm.id === teamId);
                    if (t) {
                        team = t;
                        dept = d;
                        break;
                    }
                }
                
                if (!team) {
                    alert('âŒ ãƒãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // Check if team has meetings
                const teamMeetings = this.meetingsData[teamId];
                if (teamMeetings && teamMeetings.length > 0) {
                    alert('âŒ ä¼šè­°ãŒå­˜åœ¨ã™ã‚‹ãŸã‚å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚å…ˆã«ä¼šè­°ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (confirm(`ãƒãƒ¼ãƒ ã€Œ${team.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    const index = dept.teams.findIndex(t => t.id === teamId);
                    dept.teams.splice(index, 1);
                    alert('âœ… ãƒãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                    this.showOrganizationView();
                }
            },
            
            showMinuteDetail(minuteId) {
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) return;
                
                this.currentView = 'minute';
                this.currentMinute = minute;
                
                this.updateBreadcrumb();
                
                const statusMap = {
                    'not-held': { class: 'badge-not-held', text: 'ä¼šè­°æœªå®Ÿæ–½' },
                    'completed-with-tasks': { class: 'badge-completed-with-tasks', text: 'ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ã‚ã‚Šï¼‰' },
                    'completed-no-tasks': { class: 'badge-completed-no-tasks', text: 'ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ãªã—ï¼‰' },
                    // æ—§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆäº’æ›æ€§ï¼‰
                    'pending': { class: 'badge-pending', text: 'æœªç€æ‰‹' },
                    'progress': { class: 'badge-progress', text: 'é€²è¡Œä¸­' },
                    'completed': { class: 'badge-completed', text: 'å®Œäº†' },
                    'overdue': { class: 'badge-overdue', text: 'æœŸé™è¶…é' }
                };
                const status = statusMap[minute.status] || statusMap['not-held'];
                
                const content = document.getElementById('contentArea');
                let html = `<button class="btn btn-secondary back-btn" onclick="app.showMeetingView('${this.currentMeeting.id}')">â† æˆ»ã‚‹</button>`;
                html += '<div class="card">';
                html += `<div class="card-title">
                    <span>ğŸ“„ è­°äº‹éŒ²è©³ç´°</span>
                    <div class="action-btns">
                        <button class="btn btn-primary" onclick="app.openEditMinuteModal('${minute.id}')">ç·¨é›†</button>
                        <button class="btn btn-danger" onclick="app.archiveMinute('${minute.id}')">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</button>
                    </div>
                </div>`;
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">åŸºæœ¬æƒ…å ±</div>';
                html += '<div class="detail-grid">';
                html += `<div class="detail-item"><div class="detail-label">è­°é¡Œ</div><div class="detail-value">${minute.topic}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">æ‹…å½“è€…</div><div class="detail-value">${minute.assignee}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">æœŸæ—¥</div><div class="detail-value">${minute.dueDate}</div></div>`;
                html += `<div class="detail-item"><div class="detail-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div><div class="detail-value"><span class="badge ${status.class}">${status.text}</span></div></div>`;
                html += '</div></div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">æ±ºå®šäº‹é …</div>';
                html += `<div class="detail-content">${minute.decision}</div>`;
                html += '</div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">èª²é¡Œ</div>';
                html += `<div class="detail-content">${minute.issue}</div>`;
                html += '</div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">å®Ÿè¡Œå†…å®¹</div>';
                html += `<div class="detail-content">${minute.action}</div>`;
                html += '</div>';
                
                html += '<div class="detail-section">';
                html += '<div class="detail-section-title">ç†ç”±ãƒ»èƒŒæ™¯</div>';
                html += `<div class="detail-content">${minute.reason}</div>`;
                html += '</div>';
                
                html += '</div>';
                content.innerHTML = html;
            },
            
            showMinuteDetailTable(minuteId) {
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) return;
                
                // Ensure attachedFiles array exists
                if (!minute.attachedFiles) {
                    minute.attachedFiles = [];
                }
                
                console.log('showMinuteDetailTable - minute with files:', minute);
                console.log('Attached files:', minute.attachedFiles);
                
                this.currentView = 'minute';
                this.currentMinute = minute;
                
                this.updateBreadcrumb();
                
                const content = document.getElementById('contentArea');
                
                // TOPã¨åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«é¢¨UI - æˆ»ã‚‹ãƒœã‚¿ãƒ³
                let html = `<button class="btn btn-secondary back-btn" onclick="app.showMeetingView('${this.currentMeeting.id}')" style="margin-bottom: 15px; padding: 8px 16px; font-size: 13px; background: #95a5a6; color: white; border: none; border-radius: 3px;">â† æˆ»ã‚‹</button>`;
                
                // TOPã¨åŒã˜ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³
                const headerColor = this.currentBoard ? '#2c3e50' : '#27ae60';
                const borderColor = this.currentBoard ? '#3498db' : '#2ecc71';
                
                html += `<div style="background: ${headerColor}; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid ${borderColor}; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 18px;">ğŸ“Š</span>
                        <span style="color: white; font-size: 15px; font-weight: 700; letter-spacing: 0.5px;">${minute.meetingName || 'ä¼šè­°å'} ã®è­°äº‹éŒ²è©³ç´°</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-sm" id="deleteSelectedBtn" onclick="app.deleteSelectedRows()" style="padding: 6px 14px; font-size: 12px; background: #c0392b; color: white; border: none; border-radius: 3px; font-weight: 600; display: none;">ğŸ—‘ï¸ é¸æŠå‰Šé™¤ (<span id="selectedCount">0</span>)</button>
                        <button class="btn btn-sm" onclick="app.openAIAnalysisModal()" style="padding: 6px 14px; font-size: 12px; background: #27ae60; color: white; border: none; border-radius: 3px; font-weight: 600;">ğŸ¤– AIè§£æ</button>
                        <div class="dropdown" style="position: relative;">
                            <button class="btn btn-sm" id="exportMenuBtn" onclick="app.toggleExportMenu(event)" style="padding: 6px 14px; font-size: 12px; background: #3498db; color: white; border: none; border-radius: 3px; font-weight: 600; cursor: pointer;">
                                ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                            </button>
                            <div id="exportMenu" style="display: none; position: absolute; top: 100%; right: 0; background: white; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); margin-top: 5px; min-width: 180px; z-index: 1000;">
                                <button onclick="app.exportPDF()" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee; transition: background 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">ğŸ“„ PDF</button>
                                <button onclick="app.exportWord()" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee; transition: background 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">ğŸ“ Word</button>
                                <button onclick="app.exportExcel()" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee; transition: background 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">ğŸ“Š Excel</button>
                                <button onclick="app.exportCSV()" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; border-bottom: 1px solid #eee; transition: background 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">ğŸ“‹ CSV</button>
                                <button onclick="app.exportTXT()" style="width: 100%; text-align: left; padding: 10px 15px; border: none; background: none; cursor: pointer; font-size: 14px; transition: background 0.2s;" onmouseover="this.style.background='#f0f0f0'" onmouseout="this.style.background='none'">ğŸ“ƒ TXT</button>
                            </div>
                        </div>
                        <button class="btn btn-sm" onclick="app.addNewDetailRow()" style="padding: 6px 14px; font-size: 12px; background: ${borderColor}; color: white; border: none; border-radius: 3px; font-weight: 600;">+ è¡Œã‚’è¿½åŠ </button>
                        <button class="btn btn-sm" onclick="app.saveDetailTable('${minute.id}')" id="saveButton" style="padding: 6px 14px; font-size: 12px; background: #e74c3c; color: white; border: none; border-radius: 3px; font-weight: 600; transition: all 0.3s ease;">ğŸ’¾ ä¿å­˜</button>
                    </div>
                </div>`;
                
                // ä¼šè­°æƒ…å ±ã‚’è¡¨ç¤ºï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰
                html += `<div style="background: #ecf0f1; padding: 10px 15px; margin-bottom: 12px; border-left: 4px solid ${borderColor}; font-size: 13px;">
                    <strong>ä¼šè­°åï¼š</strong><span style="color: #2c3e50;">${minute.meetingName || ''}</span> &nbsp;&nbsp;
                    <strong>é–‹å‚¬æ—¥ï¼š</strong><span style="color: #2c3e50;">${minute.meetingDate || ''}</span> &nbsp;&nbsp;
                    <strong>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼š</strong><span style="color: #2c3e50;">${minute.subtitle || ''}</span>
                </div>`;
                
                // ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰
                html += `<div style="background: white; padding: 12px 15px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 3px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <strong style="font-size: 13px; color: #2c3e50;">ğŸ“ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«</strong>
                        <label for="fileUpload-${minute.id}" class="btn btn-sm" style="padding: 5px 12px; font-size: 12px; background: #27ae60; color: white; border: none; border-radius: 3px; cursor: pointer; margin: 0; font-weight: 600;">
                            ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
                        </label>
                        <input type="file" id="fileUpload-${minute.id}" multiple style="display: none;" onchange="app.handleFileUpload(event, '${minute.id}')">
                    </div>
                    <div id="attachedFiles-${minute.id}" style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${this.renderAttachedFiles(minute)}
                    </div>
                </div>`;
                
                // Google Sheetsé¢¨ã®ç·¨é›†å¯èƒ½ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è‰²ã‚’çµ±ä¸€ï¼‰
                html += '<div style="overflow-x: auto;">';
                html += '<table class="editable-table" style="width: 100%; border-collapse: collapse; background: white;">';
                html += `
                    <thead>
                        <tr style="background-color: ${headerColor}; color: white;">
                            <th style="padding: 10px; border: 1px solid #ccc; width: 40px; text-align: center; font-weight: 600; font-size: 13px;">
                                <input type="checkbox" id="selectAllRows" onchange="app.toggleSelectAll()" style="cursor: pointer; width: 16px; height: 16px;">
                            </th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 3%; text-align: center; font-weight: 600; font-size: 13px;">#</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 15%; font-weight: 600; font-size: 13px;">è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 15%; font-weight: 600; font-size: 13px;">å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">æ‹…å½“è€…</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 8%; font-weight: 600; font-size: 13px;">æœŸé™</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 15%; font-weight: 600; font-size: 13px;">ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">å‚™è€ƒ1</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 10%; font-weight: 600; font-size: 13px;">å‚™è€ƒ2</th>
                            <th style="padding: 10px; border: 1px solid #ccc; width: 4%; font-weight: 600; font-size: 13px; text-align: center;">å‰Šé™¤</th>
                        </tr>
                    </thead>
                    <tbody id="editableTableBody">
                `;
                
                // Initialize detail rows if not exists
                if (!minute.detailRows || minute.detailRows.length === 0) {
                    minute.detailRows = [{
                        agenda: '',
                        action: '',
                        assignee: minute.facilitator || '',
                        deadline: minute.meetingDate || '',
                        purpose: '',
                        status: minute.status || 'pending',  // Default to "æœªç€æ‰‹"
                        notes1: '',
                        notes2: ''
                    }];
                }
                
                // Render rows with NEW 3-status system
                minute.detailRows.forEach((row, index) => {
                    // 4 Status System (Original)
                    const statusOptions = ['pending', 'progress', 'completed', 'overdue'];
                    const statusConfig = {
                        'pending': { 
                            text: 'æœªç€æ‰‹', 
                            color: '#f39c12',  // Orange
                            bg: '#fff3cd'
                        },
                        'progress': { 
                            text: 'é€²è¡Œä¸­', 
                            color: '#3498db',  // Blue
                            bg: '#d9edf7'
                        },
                        'completed': { 
                            text: 'å®Œäº†', 
                            color: '#27ae60',  // Green
                            bg: '#d1e7dd'
                        },
                        'overdue': { 
                            text: 'æœŸé™è¶…é', 
                            color: '#e74c3c',  // Red
                            bg: '#f8d7da'
                        }
                    };
                    
                    // Get current status color
                    const currentStatus = row.status || 'not-held';
                    const statusStyle = statusConfig[currentStatus] || statusConfig['not-held'];
                    
                    html += `
                        <tr id="detail-row-${index}" class="editable-row" style="background: ${index % 2 === 0 ? '#ffffff' : '#f9f9f9'};">
                            <td data-label="é¸æŠ" style="padding: 8px; border: 1px solid #d0d0d0; text-align: center;">
                                <input type="checkbox" class="row-checkbox" data-row="${index}" onchange="app.updateDeleteButtonState()" style="cursor: pointer; width: 16px; height: 16px;">
                            </td>
                            <td data-label="#" style="padding: 8px; border: 1px solid #d0d0d0; text-align: center; color: #666; font-weight: 500; font-size: 12px;">${index + 1}</td>
                            <td data-label="è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="agenda" data-row="${index}">${row.agenda || ''}</td>
                            <td data-label="å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="action" data-row="${index}">${row.action || ''}</td>
                            <td data-label="æ‹…å½“è€…" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="assignee" data-row="${index}">${row.assignee || ''}</td>
                            <td data-label="æœŸé™" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px; position: relative;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <span style="font-size: 14px; cursor: pointer; user-select: none;" onclick="app.showDeadlinePicker(${index})" title="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠ">ğŸ“…</span>
                                    <div contenteditable="true" class="editable-cell" data-field="deadline" data-row="${index}" style="flex: 1;">${row.deadline || ''}</div>
                                    <input type="date" id="deadlinePicker-${index}" style="position: absolute; left: 0; top: 0; opacity: 0; width: 1px; height: 1px; pointer-events: none;" onchange="app.updateDeadline(${index}, this.value)">
                                </div>
                            </td>
                            <td data-label="ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="purpose" data-row="${index}">${row.purpose || ''}</td>
                            <td data-label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 12px;">
                                <select class="status-select" data-row="${index}" 
                                    style="width: 100%; padding: 8px 30px 8px 8px; border: 2px solid ${statusStyle.color}; border-radius: 6px; font-size: 13px; font-weight: 600; color: ${statusStyle.color}; background: ${statusStyle.bg}; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg fill=\"${encodeURIComponent(statusStyle.color)}\" height=\"24\" viewBox=\"0 0 24 24\" width=\"24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>'); background-repeat: no-repeat; background-position: right 5px center; background-size: 20px; transition: all 0.2s ease;"
                                    onchange="this.style.borderColor = event.target.selectedOptions[0].dataset.color; this.style.color = event.target.selectedOptions[0].dataset.color; this.style.background = event.target.selectedOptions[0].dataset.bg;"
                                    onmouseover="this.style.transform = 'scale(1.02)'; this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';"
                                    onmouseout="this.style.transform = 'scale(1)'; this.style.boxShadow = 'none';">
                                    ${statusOptions.map(opt => {
                                        const config = statusConfig[opt];
                                        return `<option value="${opt}" 
                                            data-color="${config.color}" 
                                            data-bg="${config.bg}"
                                            ${row.status === opt ? 'selected' : ''}
                                            style="color: ${config.color}; background: ${config.bg}; font-weight: 600; padding: 8px;">
                                            ${config.text}
                                        </option>`;
                                    }).join('')}
                                </select>
                            </td>
                            <td data-label="å‚™è€ƒ1" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="notes1" data-row="${index}">${row.notes1 || ''}</td>
                            <td data-label="å‚™è€ƒ2" style="padding: 8px; border: 1px solid #d0d0d0; font-size: 13px;" contenteditable="true" class="editable-cell" data-field="notes2" data-row="${index}">${row.notes2 || ''}</td>
                            <td data-label="å‰Šé™¤" style="padding: 8px; border: 1px solid #d0d0d0; text-align: center;">
                                <button class="btn btn-danger btn-sm" onclick="app.deleteDetailRow(${index})" style="padding: 4px 8px; font-size: 11px;">ğŸ—‘ï¸</button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                    </tbody>
                </table>
                </div>`;
                
                content.innerHTML = html;
                
                // Add cell focus styling
                setTimeout(() => {
                    document.querySelectorAll('.editable-cell').forEach(cell => {
                        cell.addEventListener('focus', function() {
                            this.style.outline = '2px solid #4285f4';
                            this.style.backgroundColor = '#e8f0fe';
                        });
                        cell.addEventListener('blur', function() {
                            this.style.outline = 'none';
                            this.style.backgroundColor = '';
                        });
                    });
                }, 100);
            },
            
            getStatusText(status) {
                const statusMap = {
                    'not-held': 'ä¼šè­°æœªå®Ÿæ–½',
                    'completed-with-tasks': 'ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ã‚ã‚Šï¼‰',
                    'completed-no-tasks': 'ä¼šè­°çµ‚äº†ï¼ˆæ®‹ã‚¿ã‚¹ã‚¯ãªã—ï¼‰',
                    // æ—§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨ã®äº’æ›æ€§
                    'pending': 'æœªç€æ‰‹',
                    'progress': 'é€²è¡Œä¸­',
                    'completed': 'å®Œäº†',
                    'overdue': 'æœŸé™è¶…é'
                };
                return statusMap[status] || 'ä¼šè­°æœªå®Ÿæ–½';
            },
            
            addNewRow() {
                const tbody = document.getElementById('editableTableBody');
                const rowCount = tbody.querySelectorAll('.editable-row').length;
                
                const newRow = document.createElement('tr');
                newRow.id = `row-${rowCount}`;
                newRow.className = 'editable-row';
                newRow.innerHTML = `
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="topic">æ–°ã—ã„è­°é¡Œ</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="assignee">æ‹…å½“è€…å</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="deadline">${new Date().toISOString().split('T')[0]}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="purpose">ç›®çš„ãƒ»åŠ¹æœ</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="status">æœªç€æ‰‹</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" contenteditable="true" class="editable-cell" data-field="source">1</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                        <button class="btn btn-danger btn-sm" onclick="app.deleteRow(${rowCount})" style="padding: 4px 8px; font-size: 12px;">å‰Šé™¤</button>
                    </td>
                `;
                
                tbody.appendChild(newRow);
            },
            
            deleteRow(rowIndex) {
                if (confirm('ã“ã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    const row = document.getElementById(`row-${rowIndex}`);
                    if (row) {
                        row.remove();
                    }
                }
            },
            
            // ========== File Attachment Functions ==========
            renderAttachedFiles(minute) {
                console.log('ğŸ”„ renderAttachedFiles called');
                console.log('   minute.attachedFiles:', minute.attachedFiles);
                
                if (!minute.attachedFiles || minute.attachedFiles.length === 0) {
                    return '<div style="color: #999; font-size: 13px;">æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                }
                
                const iconMap = {
                    'pdf': 'ğŸ“„',
                    'doc': 'ğŸ“', 'docx': 'ğŸ“',
                    'xls': 'ğŸ“Š', 'xlsx': 'ğŸ“Š',
                    'ppt': 'ğŸ“½ï¸', 'pptx': 'ğŸ“½ï¸',
                    'csv': 'ğŸ“‹',
                    'txt': 'ğŸ“ƒ',
                    'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸',
                    'zip': 'ğŸ—œï¸', 'rar': 'ğŸ—œï¸',
                    'mp4': 'ğŸ¬', 'avi': 'ğŸ¬', 'mov': 'ğŸ¬'
                };
                
                let html = '';
                minute.attachedFiles.forEach((file, index) => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    const icon = iconMap[ext] || 'ğŸ“';
                    
                    console.log(`   File ${index}: ${file.name}, uploading=${file.uploading}, hasUrl=${!!file.url}`);
                    
                    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã®è¡¨ç¤º
                    if (file.uploading) {
                        console.log(`   â†’ Rendering as UPLOADING`);
                        html += `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 13px;">
                                <span class="spinner-small" style="width: 16px; height: 16px; border: 2px solid #ffc107; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite;"></span>
                                <span style="color: #856404; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${file.name}">
                                    ${file.name}
                                </span>
                                <span style="color: #856404; font-size: 11px;">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...</span>
                            </div>
                        `;
                    } else {
                        console.log(`   â†’ Rendering as COMPLETED`);
                        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ã®è¡¨ç¤º
                        html += `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; font-size: 13px; transition: all 0.3s;">
                                <span style="font-size: 18px;">${icon}</span>
                                <a href="#" onclick="app.openAttachedFile('${minute.id}', ${index}); return false;" style="text-decoration: none; color: #007bff; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${file.name}">
                                    ${file.name}
                                </a>
                                <span style="color: #6c757d; font-size: 11px;">${this.formatFileSize(file.size)}</span>
                                <button onclick="app.deleteAttachedFile('${minute.id}', ${index})" style="padding: 2px 6px; font-size: 11px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#c82333'" onmouseout="this.style.background='#dc3545'">
                                    âœ•
                                </button>
                            </div>
                        `;
                    }
                });
                
                console.log('ğŸ”„ renderAttachedFiles complete, HTML length:', html.length);
                return html;
            },
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
            },
            
            handleFileUpload(event, minuteId) {
                const files = event.target.files;
                if (!files || files.length === 0) return;
                
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) {
                    alert('è­°äº‹éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // Initialize attachedFiles array if not exists
                if (!minute.attachedFiles) {
                    minute.attachedFiles = [];
                }
                
                // å³åº§ã«ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã€ã®è¡¨ç¤ºã‚’è¿½åŠ 
                const filesContainer = document.getElementById(`attachedFiles-${minuteId}`);
                let processedCount = 0;
                const totalFiles = files.length;
                
                // Process each file
                Array.from(files).forEach((file, index) => {
                    // ã™ãã«ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã€ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¿½åŠ 
                    const tempId = `temp-${Date.now()}-${index}`;
                    minute.attachedFiles.push({
                        id: tempId,
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        url: null, // ã¾ã èª­ã¿è¾¼ã¿ä¸­
                        uploadDate: new Date().toISOString(),
                        uploading: true // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ãƒ•ãƒ©ã‚°
                    });
                    
                    // ã™ãã«è¡¨ç¤ºã‚’æ›´æ–°
                    if (filesContainer) {
                        filesContainer.innerHTML = this.renderAttachedFiles(minute);
                    }
                    
                    // Create FileReader to read file as Data URL
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        console.log(`âœ… File loaded: ${file.name}, tempId: ${tempId}`);
                        
                        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ç½®ãæ›ãˆ
                        const fileObj = minute.attachedFiles.find(f => f.id === tempId);
                        console.log('Found fileObj:', fileObj);
                        
                        if (fileObj) {
                            fileObj.url = e.target.result; // Data URL
                            fileObj.uploading = false; // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†
                            delete fileObj.id; // ä¸€æ™‚IDã‚’å‰Šé™¤
                            console.log('Updated fileObj:', fileObj);
                        } else {
                            console.error('âš ï¸ fileObj not found for tempId:', tempId);
                        }
                        
                        processedCount++;
                        console.log(`Processed ${processedCount}/${totalFiles} files`);
                        
                        // Save to localStorage
                        this.saveToLocalStorage();
                        
                        // å†åº¦è¡¨ç¤ºã‚’æ›´æ–°
                        if (filesContainer) {
                            console.log('Re-rendering attached files...');
                            filesContainer.innerHTML = this.renderAttachedFiles(minute);
                        }
                        
                        // å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ãŒå®Œäº†ã—ãŸã‚‰æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                        if (processedCount === totalFiles) {
                            this.showSaveSuccessMessage(`âœ… ${totalFiles}ä»¶ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
                        }
                    };
                    
                    reader.onerror = () => {
                        // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å‰Šé™¤
                        const fileIndex = minute.attachedFiles.findIndex(f => f.id === tempId);
                        if (fileIndex !== -1) {
                            minute.attachedFiles.splice(fileIndex, 1);
                        }
                        
                        // è¡¨ç¤ºã‚’æ›´æ–°
                        if (filesContainer) {
                            filesContainer.innerHTML = this.renderAttachedFiles(minute);
                        }
                        
                        alert(`ãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${file.name}ã€ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ`);
                    };
                    
                    reader.readAsDataURL(file);
                });
                
                // Reset input
                event.target.value = '';
            },
            
            deleteAttachedFile(minuteId, fileIndex) {
                if (!confirm('ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
                
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute || !minute.attachedFiles) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }
                
                // Remove file
                minute.attachedFiles.splice(fileIndex, 1);
                
                // Save to localStorage
                this.saveToLocalStorage();
                
                // Re-render
                const filesContainer = document.getElementById(`attachedFiles-${minuteId}`);
                if (filesContainer) {
                    filesContainer.innerHTML = this.renderAttachedFiles(minute);
                }
                
                alert('âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            },
            
            openAttachedFile(minuteId, fileIndex) {
                console.log('openAttachedFile called:', minuteId, fileIndex);
                
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute || !minute.attachedFiles || !minute.attachedFiles[fileIndex]) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    console.error('Minute or file not found:', { minute, fileIndex });
                    return;
                }
                
                const file = minute.attachedFiles[fileIndex];
                console.log('Opening file:', file);
                
                // For PDFs, create a blob URL and open in new tab
                if (file.type === 'application/pdf') {
                    try {
                        // Convert Data URL to Blob
                        const byteString = atob(file.url.split(',')[1]);
                        const mimeString = file.url.split(',')[0].split(':')[1].split(';')[0];
                        const ab = new ArrayBuffer(byteString.length);
                        const ia = new Uint8Array(ab);
                        for (let i = 0; i < byteString.length; i++) {
                            ia[i] = byteString.charCodeAt(i);
                        }
                        const blob = new Blob([ab], { type: mimeString });
                        const blobUrl = URL.createObjectURL(blob);
                        
                        // Open in new tab
                        window.open(blobUrl, '_blank');
                    } catch (error) {
                        console.error('Error opening PDF:', error);
                        alert('PDFã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
                        // Fallback to download
                        const link = document.createElement('a');
                        link.href = file.url;
                        link.download = file.name;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
                // For images, open in new window with img tag
                else if (file.type && file.type.startsWith('image/')) {
                    const newWindow = window.open();
                    if (newWindow) {
                        newWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>${file.name}</title>
                                <style>
                                    body { margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f0f0f0; }
                                    img { max-width: 100%; height: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
                                </style>
                            </head>
                            <body>
                                <img src="${file.url}" alt="${file.name}">
                            </body>
                            </html>
                        `);
                        newWindow.document.close();
                    } else {
                        alert('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    }
                }
                // For other files, trigger download
                else {
                    const link = document.createElement('a');
                    link.href = file.url;
                    link.download = file.name;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            },
            
            addNewDetailRow() {
                if (!this.currentMinute.detailRows) {
                    this.currentMinute.detailRows = [];
                }
                
                this.currentMinute.detailRows.push({
                    agenda: '',
                    action: '',
                    assignee: '',
                    deadline: new Date().toISOString().split('T')[0],
                    purpose: '',
                    status: 'pending',  // æœªç€æ‰‹
                    notes1: '',
                    notes2: ''
                });
                
                this.showMinuteDetailTable(this.currentMinute.id);
            },
            
            // Toggle select all checkboxes
            toggleSelectAll() {
                const selectAllCheckbox = document.getElementById('selectAllRows');
                const rowCheckboxes = document.querySelectorAll('.row-checkbox');
                
                rowCheckboxes.forEach(checkbox => {
                    checkbox.checked = selectAllCheckbox.checked;
                });
                
                this.updateDeleteButtonState();
            },
            
            // Update delete button state based on selection
            updateDeleteButtonState() {
                const rowCheckboxes = document.querySelectorAll('.row-checkbox');
                const selectedCheckboxes = Array.from(rowCheckboxes).filter(cb => cb.checked);
                const selectedCount = selectedCheckboxes.length;
                
                const deleteButton = document.getElementById('deleteSelectedBtn');
                const selectedCountSpan = document.getElementById('selectedCount');
                
                if (selectedCount > 0) {
                    deleteButton.style.display = 'inline-block';
                    selectedCountSpan.textContent = selectedCount;
                } else {
                    deleteButton.style.display = 'none';
                }
                
                // Update "select all" checkbox state
                const selectAllCheckbox = document.getElementById('selectAllRows');
                if (selectAllCheckbox) {
                    if (selectedCount === 0) {
                        selectAllCheckbox.checked = false;
                        selectAllCheckbox.indeterminate = false;
                    } else if (selectedCount === rowCheckboxes.length) {
                        selectAllCheckbox.checked = true;
                        selectAllCheckbox.indeterminate = false;
                    } else {
                        selectAllCheckbox.checked = false;
                        selectAllCheckbox.indeterminate = true;
                    }
                }
            },
            
            // Delete selected rows
            deleteSelectedRows() {
                const rowCheckboxes = document.querySelectorAll('.row-checkbox:checked');
                const selectedIndices = Array.from(rowCheckboxes).map(cb => parseInt(cb.getAttribute('data-row'))).sort((a, b) => b - a);
                
                if (selectedIndices.length === 0) {
                    alert('å‰Šé™¤ã™ã‚‹è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                // Check if all rows are being deleted
                if (selectedIndices.length >= this.currentMinute.detailRows.length) {
                    alert('æœ€ä½1è¡Œã¯å¿…è¦ã§ã™ã€‚ã™ã¹ã¦ã®è¡Œã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚');
                    return;
                }
                
                if (confirm(`é¸æŠã—ãŸ${selectedIndices.length}ä»¶ã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    // Delete from highest index to lowest to avoid index shift issues
                    selectedIndices.forEach(index => {
                        this.currentMinute.detailRows.splice(index, 1);
                    });
                    
                    // Save and refresh
                    this.saveToLocalStorage();
                    this.showMinuteDetailTable(this.currentMinute.id);
                    
                    // Show success message
                    this.showSaveSuccessMessage();
                }
            },
            
            deleteDetailRow(rowIndex) {
                if (confirm('ã“ã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    if (this.currentMinute.detailRows && this.currentMinute.detailRows.length > 1) {
                        this.currentMinute.detailRows.splice(rowIndex, 1);
                        this.showMinuteDetailTable(this.currentMinute.id);
                    } else {
                        alert('æœ€ä½1è¡Œã¯å¿…è¦ã§ã™ã€‚');
                    }
                }
            },
            
            saveDetailTable(minuteId) {
                // Show saving indicator with animation
                const saveButton = document.getElementById('saveButton');
                if (saveButton) {
                    const originalHTML = saveButton.innerHTML;
                    saveButton.innerHTML = 'â³ ä¿å­˜ä¸­...';
                    saveButton.disabled = true;
                    saveButton.style.opacity = '0.6';
                    saveButton.style.transform = 'scale(0.95)';
                }
                
                // Collect data from all cells
                const cells = document.querySelectorAll('.editable-cell');
                const statusSelects = document.querySelectorAll('.status-select');
                
                // Group by row
                const rowData = {};
                cells.forEach(cell => {
                    const row = cell.getAttribute('data-row');
                    const field = cell.getAttribute('data-field');
                    const value = cell.textContent.trim();
                    
                    if (!rowData[row]) {
                        rowData[row] = {};
                    }
                    rowData[row][field] = value;
                });
                
                // Add status values
                statusSelects.forEach(select => {
                    const row = select.getAttribute('data-row');
                    if (rowData[row]) {
                        rowData[row].status = select.value;
                    }
                });
                
                // Convert to array
                const updatedRows = Object.keys(rowData).sort().map(key => rowData[key]);
                
                // Find and update minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute.detailRows = updatedRows;
                        
                        // Ensure attachedFiles is preserved
                        if (!minute.attachedFiles) {
                            minute.attachedFiles = [];
                        }
                        
                        console.log('Saving minute with files:', minute.attachedFiles);
                        
                        this.saveToLocalStorage();
                        
                        // Show SUCCESS animation on save button
                        if (saveButton) {
                            saveButton.innerHTML = 'âœ… ä¿å­˜å®Œäº†ï¼';
                            saveButton.style.background = '#27ae60';
                            saveButton.style.transform = 'scale(1.05)';
                            saveButton.style.opacity = '1';
                            
                            setTimeout(() => {
                                saveButton.innerHTML = 'ğŸ’¾ ä¿å­˜';
                                saveButton.style.background = '#e74c3c';
                                saveButton.style.transform = 'scale(1)';
                                saveButton.disabled = false;
                            }, 2000);
                        }
                        
                        // Show BIG success toast message
                        this.showSaveSuccessMessage();
                        
                        // Re-render current page to reflect changes (after a small delay to show success message)
                        setTimeout(() => {
                            this.showMinuteDetailTable(minuteId);
                        }, 500);
                        return;
                    }
                }
            },
            
            showSaveSuccessMessage() {
                // Create BIG success notification element with animation
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); z-index: 9999; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; padding: 30px 50px; border-radius: 20px; box-shadow: 0 10px 40px rgba(39, 174, 96, 0.4); font-size: 24px; font-weight: 700; text-align: center; animation: successPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;">
                        <div style="font-size: 48px; margin-bottom: 10px;">âœ…</div>
                        <div>ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼</div>
                    </div>
                `;
                
                // Add animation keyframes if not exists
                if (!document.getElementById('successPopStyle')) {
                    const style = document.createElement('style');
                    style.id = 'successPopStyle';
                    style.textContent = `
                        @keyframes successPop {
                            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                            50% { transform: translate(-50%, -50%) scale(1.1); }
                            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                        }
                        @keyframes fadeOut {
                            from { opacity: 1; }
                            to { opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                document.body.appendChild(notification);
                
                // Fade out and remove after 2 seconds
                setTimeout(() => {
                    notification.firstElementChild.style.animation = 'fadeOut 0.5s forwards';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 2000);
            },
            
            // OLD VERSION BELOW (keeping for reference)
            showSaveSuccessMessageOLD() {
                // Create success notification element
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #27ae60 0%, #219a52 100%);
                        color: white;
                        padding: 16px 24px;
                        border-radius: 8px;
                        box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
                        z-index: 10000;
                        font-size: 15px;
                        font-weight: 600;
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        animation: slideInRight 0.3s ease-out;
                    ">
                        <span style="font-size: 24px;">âœ…</span>
                        <span>ä¿å­˜ã—ã¾ã—ãŸï¼</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Remove after 3 seconds with fade out animation
                setTimeout(() => {
                    notification.firstElementChild.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            },
            
            saveMinuteTable(minuteId) {
                const rows = document.querySelectorAll('.editable-row');
                const data = [];
                
                rows.forEach((row) => {
                    const cells = row.querySelectorAll('.editable-cell');
                    const rowData = {};
                    
                    cells.forEach(cell => {
                        const field = cell.getAttribute('data-field');
                        rowData[field] = cell.textContent.trim();
                    });
                    
                    data.push(rowData);
                });
                
                console.log('Saving minute table data:', data);
                
                // Find and update minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        // Update minute with first row data
                        if (data.length > 0) {
                            minute.topic = data[0].topic;
                            minute.assignee = data[0].assignee;
                            minute.dueDate = data[0].deadline;
                            minute.issue = data[0].purpose;
                            minute.decision = data[0].topic;
                            minute.action = data.length > 1 ? data[1].topic : data[0].topic;
                            minute.reason = data.length > 1 ? data[1].purpose : data[0].purpose;
                        }
                        break;
                    }
                }
                
                alert('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼');
                this.showMeetingView(this.currentMeeting.id);
            },
            
            openAddMinuteModal(meetingId) {
                this.editingMinuteId = null;
                document.getElementById('modalTitle').textContent = 'è­°äº‹éŒ²ã‚’è¿½åŠ ';
                document.getElementById('minuteForm').reset();
                
                // Set default meeting name (from current meeting)
                if (this.currentMeeting) {
                    document.getElementById('minuteMeetingName').value = this.currentMeeting.name || '';
                }
                
                // Set default meeting date (today)
                const today = new Date();
                document.getElementById('minuteMeetingDate').value = today.toISOString().split('T')[0];
                
                document.getElementById('minuteModal').classList.add('active');
            },
            
            openEditMinuteModal(minuteId) {
                // Find minute
                let minute = null;
                for (const meetingId in this.minutesData) {
                    minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) break;
                }
                
                if (!minute) return;
                
                this.editingMinuteId = minuteId;
                document.getElementById('modalTitle').textContent = 'è­°äº‹éŒ²ã‚’ç·¨é›†';
                
                // Fill form with current data
                document.getElementById('minuteMeetingName').value = minute.meetingName || '';
                document.getElementById('minuteSubtitle').value = minute.subtitle || '';
                document.getElementById('minuteMeetingDate').value = minute.meetingDate || '';
                document.getElementById('minuteParticipants').value = minute.participants || '';
                document.getElementById('minuteFacilitator').value = minute.facilitator || '';
                document.getElementById('minuteNotes').value = minute.notes || '';
                document.getElementById('minuteStatus').value = minute.status;
                
                document.getElementById('minuteModal').classList.add('active');
            },
            
            closeModal() {
                document.getElementById('minuteModal').classList.remove('active');
                document.getElementById('minuteForm').reset();
                this.editingMinuteId = null;
            },
            
            saveMinute() {
                const formData = {
                    meetingName: document.getElementById('minuteMeetingName').value,
                    subtitle: document.getElementById('minuteSubtitle').value,
                    meetingDate: document.getElementById('minuteMeetingDate').value,
                    participants: document.getElementById('minuteParticipants').value,
                    facilitator: document.getElementById('minuteFacilitator').value,
                    notes: document.getElementById('minuteNotes').value,
                    status: document.getElementById('minuteStatus').value
                };
                
                if (this.editingMinuteId) {
                    // Edit existing minute
                    for (const meetingId in this.minutesData) {
                        const index = this.minutesData[meetingId].findIndex(m => m.id === this.editingMinuteId);
                        if (index !== -1) {
                            this.minutesData[meetingId][index] = {
                                ...this.minutesData[meetingId][index],
                                ...formData
                            };
                            break;
                        }
                    }
                } else {
                    // Add new minute - é…åˆ—ã®å…ˆé ­ã«è¿½åŠ ï¼ˆæ–°ã—ã„ã‚‚ã®ãŒä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
                    const meetingId = this.currentMeeting.id;
                    if (!this.minutesData[meetingId]) {
                        this.minutesData[meetingId] = [];
                    }
                    
                    const newMinute = {
                        id: `minute-${meetingId}-${Date.now()}`,
                        meetingId: meetingId,
                        ...formData,
                        archived: false,
                        created: new Date().toISOString() // ä½œæˆæ—¥æ™‚ã‚’è¿½åŠ 
                    };
                    
                    // unshift()ã§é…åˆ—ã®å…ˆé ­ã«è¿½åŠ 
                    this.minutesData[meetingId].unshift(newMinute);
                }
                
                this.saveToLocalStorage(); // Save to localStorage
                this.closeModal();
                this.showMeetingView(this.currentMeeting.id);
            },
            
            submitMinuteForm() {
                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
                const form = document.getElementById('minuteForm');
                if (form.checkValidity()) {
                    this.saveMinute();
                } else {
                    // HTML5ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                    form.reportValidity();
                }
            },
            
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã®ä¿å­˜
            saveInlineEdit(minuteId, field, value) {
                // è­°äº‹éŒ²ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute[field] = value;
                        this.saveToLocalStorage();
                        this.showSaveIndicator();
                        console.log(`âœ… Saved ${field}: ${value}`);
                        return true;
                    }
                }
                return false;
            },
            
            // ä¿å­˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤º
            showSaveIndicator() {
                // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
                const existing = document.getElementById('saveIndicator');
                if (existing) {
                    existing.remove();
                }
                
                // æ–°ã—ã„ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆ
                const indicator = document.createElement('div');
                indicator.id = 'saveIndicator';
                indicator.className = 'save-indicator';
                indicator.innerHTML = 'âœ“ ä¿å­˜ã—ã¾ã—ãŸ';
                indicator.style.opacity = '1';
                document.body.appendChild(indicator);
                
                // 3ç§’å¾Œã«å‰Šé™¤
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.remove();
                    }
                }, 3000);
            },
            
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            setupInlineEditListeners() {
                // contenteditableè¦ç´ ã®blurã‚¤ãƒ™ãƒ³ãƒˆ
                document.addEventListener('blur', (e) => {
                    if (e.target.classList.contains('inline-edit')) {
                        const row = e.target.closest('.inline-editable-row');
                        if (row) {
                            const minuteId = row.dataset.minuteId;
                            const field = e.target.dataset.field;
                            const value = e.target.textContent.trim();
                            
                            if (value && value !== '-') {
                                this.saveInlineEdit(minuteId, field, value);
                            }
                        }
                    }
                }, true);
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®å¤‰æ›´
                document.addEventListener('change', (e) => {
                    if (e.target.classList.contains('status-dropdown')) {
                        const row = e.target.closest('.inline-editable-row');
                        if (row) {
                            const minuteId = row.dataset.minuteId;
                            const field = e.target.dataset.field;
                            const value = e.target.value;
                            
                            this.saveInlineEdit(minuteId, field, value);
                            
                            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®è‰²ã‚’æ›´æ–°
                            const statusColors = {
                                'not-held': '#f39c12',  // ã‚ªãƒ¬ãƒ³ã‚¸
                                'completed-with-tasks': '#e74c3c',  // èµ¤
                                'completed-no-tasks': '#3498db'  // é’
                            };
                            e.target.style.background = statusColors[value] || '#999';
                        }
                    }
                }, true);
            },
            
            // ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã‚’è¡¨ç¤º
            showDatePicker(minuteId) {
                const datePicker = document.getElementById(`datePicker-${minuteId}`);
                if (datePicker) {
                    datePicker.showPicker();
                }
            },
            
            // ğŸ“… ä¼šè­°æ—¥ã‚’æ›´æ–°
            updateMeetingDate(minuteId, newDate) {
                if (!newDate) return;
                
                // Find and update minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute.meetingDate = newDate;
                        this.saveToLocalStorage();
                        
                        // ä¿å­˜æˆåŠŸã‚’è¡¨ç¤º
                        this.showSaveIndicator();
                        
                        // å†æç”»
                        this.showMeetingView(this.currentMeeting.id);
                        break;
                    }
                }
            },
            
            // ğŸ“… æœŸé™ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã‚’è¡¨ç¤º
            showDeadlinePicker(rowIndex) {
                const deadlinePicker = document.getElementById(`deadlinePicker-${rowIndex}`);
                if (deadlinePicker) {
                    deadlinePicker.showPicker();
                }
            },
            
            // ğŸ“… æœŸé™ã‚’æ›´æ–°
            updateDeadline(rowIndex, newDate) {
                if (!newDate || !this.currentMinute) return;
                
                // Update the deadline in detailRows
                if (this.currentMinute.detailRows && this.currentMinute.detailRows[rowIndex]) {
                    this.currentMinute.detailRows[rowIndex].deadline = newDate;
                    
                    // Save to localStorage
                    this.saveToLocalStorage();
                    
                    // Show success message
                    this.showSaveSuccessMessage();
                    
                    // Re-render the table
                    setTimeout(() => {
                        this.showMinuteDetailTable(this.currentMinute.id);
                    }, 500);
                }
            },
            
            archiveMinute(minuteId) {
                if (!confirm('ã“ã®è­°äº‹éŒ²ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ã¾ã™ã‹ï¼Ÿã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã—ãŸè­°äº‹éŒ²ã¯ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãªããªã‚Šã¾ã™ã€‚')) {
                    return;
                }
                
                // Find and archive minute
                for (const meetingId in this.minutesData) {
                    const minute = this.minutesData[meetingId].find(m => m.id === minuteId);
                    if (minute) {
                        minute.archived = true;
                        this.archivedMinutes.push(minute);
                        break;
                    }
                }
                
                // Refresh view
                if (this.currentView === 'meeting') {
                    this.showMeetingView(this.currentMeeting.id);
                } else if (this.currentView === 'minute') {
                    this.showMeetingView(this.currentMeeting.id);
                }
            },
            
            async logout() {
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                localStorage.removeItem('userInfo');
                this.currentUser = null;
                this.showLoginPage();
            }
        };
        
        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
            
            try {
                // Simple client-side authentication
                // In production, this should be server-side
                const validUsers = [
                    {
                        email: 'admin@example.com',
                        password: 'Admin@123',
                        name: 'ç®¡ç†è€…',
                        department: { name: 'çµŒå–¶ä¼ç”»éƒ¨' },
                        team: { name: 'çµŒå–¶ãƒãƒ¼ãƒ ' }
                    }
                ];
                
                const user = validUsers.find(u => u.email === email && u.password === password);
                
                if (user) {
                    // Create a mock token
                    const token = 'mock-token-' + Date.now();
                    localStorage.setItem('accessToken', token);
                    localStorage.setItem('userInfo', JSON.stringify(user));
                    app.currentUser = user;
                    app.showAlert('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼', 'success');
                    setTimeout(() => app.showMainApp(), 500);
                } else {
                    app.showAlert('âŒ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“', 'error');
                }
            } catch (error) {
                app.showAlert(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        });
        
        // ========== Export Functions ==========
        app.toggleExportMenu = function(event) {
            if (event) {
                event.stopPropagation();
            }
            const menu = document.getElementById('exportMenu');
            if (menu) {
                const isVisible = menu.style.display === 'block';
                menu.style.display = isVisible ? 'none' : 'block';
                console.log('Export menu toggled:', menu.style.display);
            } else {
                console.error('Export menu not found');
            }
        };
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('exportMenu');
            const exportButton = event.target.closest('[onclick*="toggleExportMenu"]');
            
            if (menu && !exportButton && menu.style.display === 'block') {
                menu.style.display = 'none';
            }
        });
        
        app.exportCSV = function() {
            console.log('Exporting CSV...');
            const minute = this.currentMinute;
            if (!minute || !minute.detailRows) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let csv = '\uFEFF'; // UTF-8 BOM for Excel
            csv += 'ä¼šè­°å,ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«,ä¼šè­°é–‹å‚¬æ—¥\n';
            csv += `"${minute.meetingName || ''}","${minute.subtitle || ''}","${minute.meetingDate || ''}"\n\n`;
            csv += '#,è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€,å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³,æ‹…å½“è€…,æœŸé™,ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ,ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹,å‚™è€ƒ1,å‚™è€ƒ2\n';
            
            minute.detailRows.forEach((row, index) => {
                const statusMap = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                csv += `${index + 1},"${(row.agenda || '').replace(/"/g, '""')}","${(row.action || '').replace(/"/g, '""')}","${(row.assignee || '').replace(/"/g, '""')}","${row.deadline || ''}","${(row.purpose || '').replace(/"/g, '""')}","${statusMap[row.status] || ''}","${(row.notes1 || '').replace(/"/g, '""')}","${(row.notes2 || '').replace(/"/g, '""')}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è­°äº‹éŒ²_${minute.meetingName || 'minutes'}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            this.toggleExportMenu();
        };
        
        app.exportTXT = function() {
            console.log('Exporting TXT...');
            const minute = this.currentMinute;
            if (!minute || !minute.detailRows) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let txt = `è­°äº‹éŒ²è©³ç´°\n`;
            txt += `${'='.repeat(50)}\n\n`;
            txt += `ä¼šè­°å: ${minute.meetingName || ''}\n`;
            txt += `ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«: ${minute.subtitle || ''}\n`;
            txt += `ä¼šè­°é–‹å‚¬æ—¥: ${minute.meetingDate || ''}\n\n`;
            txt += `${'='.repeat(50)}\n\n`;
            
            minute.detailRows.forEach((row, index) => {
                const statusMap = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                txt += `ã€${index + 1}ã€‘\n`;
                txt += `è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€: ${row.agenda || ''}\n`;
                txt += `å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${row.action || ''}\n`;
                txt += `æ‹…å½“è€…: ${row.assignee || ''}\n`;
                txt += `æœŸé™: ${row.deadline || ''}\n`;
                txt += `ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ: ${row.purpose || ''}\n`;
                txt += `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${statusMap[row.status] || ''}\n`;
                txt += `å‚™è€ƒ1: ${row.notes1 || ''}\n`;
                txt += `å‚™è€ƒ2: ${row.notes2 || ''}\n`;
                txt += `${'-'.repeat(50)}\n\n`;
            });
            
            const blob = new Blob([txt], { type: 'text/plain;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è­°äº‹éŒ²_${minute.meetingName || 'minutes'}_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            this.toggleExportMenu();
        };
        
        app.exportPDF = function() {
            console.log('Exporting PDF...');
            alert('ğŸ“„ PDFå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nä»£ã‚ã‚Šã«ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·æ©Ÿèƒ½ï¼ˆCtrl+Pï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ŒPDFã¨ã—ã¦ä¿å­˜ã€ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            this.toggleExportMenu();
        };
        
        app.exportWord = function() {
            console.log('Exporting Word...');
            const minute = this.currentMinute;
            if (!minute || !minute.detailRows) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>è­°äº‹éŒ²</title></head><body>`;
            html += `<h1>è­°äº‹éŒ²è©³ç´°</h1>`;
            html += `<p><strong>ä¼šè­°å:</strong> ${minute.meetingName || ''}</p>`;
            html += `<p><strong>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${minute.subtitle || ''}</p>`;
            html += `<p><strong>ä¼šè­°é–‹å‚¬æ—¥:</strong> ${minute.meetingDate || ''}</p><hr>`;
            html += `<table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;width:100%;">`;
            html += `<thead><tr style="background-color:#4a86e8;color:white;">`;
            html += `<th>#</th><th>è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€</th><th>å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th><th>æ‹…å½“è€…</th><th>æœŸé™</th><th>ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ</th><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><th>å‚™è€ƒ1</th><th>å‚™è€ƒ2</th>`;
            html += `</tr></thead><tbody>`;
            
            minute.detailRows.forEach((row, index) => {
                const statusMap = { pending: 'æœªç€æ‰‹', progress: 'é€²è¡Œä¸­', completed: 'å®Œäº†', overdue: 'æœŸé™è¶…é' };
                html += `<tr>`;
                html += `<td>${index + 1}</td>`;
                html += `<td>${row.agenda || ''}</td>`;
                html += `<td>${row.action || ''}</td>`;
                html += `<td>${row.assignee || ''}</td>`;
                html += `<td>${row.deadline || ''}</td>`;
                html += `<td>${row.purpose || ''}</td>`;
                html += `<td>${statusMap[row.status] || ''}</td>`;
                html += `<td>${row.notes1 || ''}</td>`;
                html += `<td>${row.notes2 || ''}</td>`;
                html += `</tr>`;
            });
            
            html += `</tbody></table></body></html>`;
            
            const blob = new Blob(['\ufeff' + html], { type: 'application/msword;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è­°äº‹éŒ²_${minute.meetingName || 'minutes'}_${new Date().toISOString().split('T')[0]}.doc`;
            link.click();
            this.toggleExportMenu();
        };
        
        app.exportExcel = function() {
            console.log('Exporting Excel...');
            alert('ğŸ“Š Excelå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nä»£ã‚ã‚Šã«CSVå½¢å¼ã‚’ã”åˆ©ç”¨ãã ã•ã„ï¼ˆExcelã§CSVã‚’é–‹ãã“ã¨ãŒã§ãã¾ã™ï¼‰ã€‚');
            this.toggleExportMenu();
        };
        
        app.exportPowerPoint = function(minuteId) {
            alert('ğŸ“½ï¸ PowerPointå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nç¾åœ¨ã®æ©Ÿèƒ½ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
            this.toggleExportMenu();
        };
        
        app.exportImage = function(minuteId, format) {
            alert(`ğŸ–¼ï¸ ${format.toUpperCase()}å½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚`);
            this.toggleExportMenu();
        };
        
        app.exportZIP = function(minuteId) {
            alert('ğŸ—œï¸ ZIPå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«ã¯å°‚ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã§ã™ã€‚\n\nè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å€‹åˆ¥ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€æ‰‹å‹•ã§ZIPåœ§ç¸®ã—ã¦ãã ã•ã„ã€‚');
            this.toggleExportMenu();
        };
        
        // AI Analysis Functions
        app.openAIAnalysisModal = function() {
            document.getElementById('aiAnalysisModal').classList.add('active');
            document.getElementById('aiAnalysisText').value = '';
            document.getElementById('aiAnalysisFileName').textContent = '';
            document.getElementById('aiAnalysisProgress').style.display = 'none';
        };
        
        app.closeAIAnalysisModal = function() {
            document.getElementById('aiAnalysisModal').classList.remove('active');
        };
        
        app.handleAIAnalysisFile = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const fileName = file.name;
            document.getElementById('aiAnalysisFileName').textContent = fileName;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const text = e.target.result;
                document.getElementById('aiAnalysisText').value = text;
            };
            
            // Read as text
            reader.readAsText(file);
        };
        
        app.startAIAnalysis = async function() {
            const text = document.getElementById('aiAnalysisText').value.trim();
            
            if (!text) {
                alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // Show progress
            const progressDiv = document.getElementById('aiAnalysisProgress');
            const progressText = document.getElementById('aiAnalysisProgressText');
            progressDiv.style.display = 'block';
            progressText.textContent = 'AIè§£æä¸­...';
            
            try {
                // Try OpenAI API first
                let analysisResult;
                try {
                    analysisResult = await this.analyzeMinutesWithAI(text);
                } catch (apiError) {
                    console.warn('OpenAI API failed, using fallback parser:', apiError);
                    progressText.textContent = 'AI APIåˆ©ç”¨ä¸å¯ã€‚ç°¡æ˜“è§£æã‚’ä½¿ç”¨ä¸­...';
                    // Use fallback simple parser
                    analysisResult = this.simpleParseMinutes(text);
                }
                
                progressText.textContent = 'è§£æå®Œäº†ï¼ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šè¾¼ã¿ä¸­...';
                
                // Add analyzed rows to the current minute
                if (analysisResult && analysisResult.length > 0) {
                    if (!this.currentMinute.detailRows) {
                        this.currentMinute.detailRows = [];
                    }
                    
                    // Append all analyzed rows
                    this.currentMinute.detailRows.push(...analysisResult);
                    
                    // Save to localStorage
                    this.saveToLocalStorage();
                    
                    // Close modal and refresh view
                    this.closeAIAnalysisModal();
                    this.showMinuteDetailTable(this.currentMinute.id);
                    
                    alert(`âœ… AIè§£æå®Œäº†ï¼${analysisResult.length}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚`);
                } else {
                    alert('âš ï¸ è§£æçµæœãŒç©ºã§ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            } catch (error) {
                console.error('AI Analysis error:', error);
                alert(`âŒ AIè§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            } finally {
                progressDiv.style.display = 'none';
            }
        };
        
        app.analyzeMinutesWithAI = async function(text) {
            console.log('=== Starting AI analysis ===');
            console.log('Text length:', text.length);
            
            // Try OpenAI API first, fallback to simple parser if it fails
            try {
                // Load OpenAI config
                console.log('Loading OpenAI config...');
                const config = await this.loadOpenAIConfig();
                console.log('Config loaded:', config ? 'YES' : 'NO');
                
                if (config && config.api_key) {
                    console.log('=== API Key found, proceeding with AI analysis ===');
                    const prompt = `ã‚ãªãŸã¯å„ªç§€ãªè­°äº‹éŒ²è§£æAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚éŸ³å£°èªè­˜ã•ã‚ŒãŸè­°äº‹éŒ²ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã€ãƒ“ã‚¸ãƒã‚¹ã§å®Ÿç”¨çš„ãªæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚

# è§£æå¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ
${text}

# ã‚ãªãŸã®ã‚¿ã‚¹ã‚¯
ä»¥ä¸‹ã®3ã‚¹ãƒ†ãƒƒãƒ—ã§è­°äº‹éŒ²ã‚’è§£æã—ã¦ãã ã•ã„ï¼š

## ã‚¹ãƒ†ãƒƒãƒ—1: è­°äº‹éŒ²ã®å…¨ä½“ç†è§£
- ä¼šè­°ã®ä¸»è¦ãƒ†ãƒ¼ãƒã¨ç›®çš„ã‚’æŠŠæ¡ã™ã‚‹
- è­°è«–ã®æµã‚Œã¨é‡è¦ãªæ±ºå®šäº‹é …ã‚’ç‰¹å®šã™ã‚‹
- ç™ºè¨€è€…ã®å½¹å‰²ã¨è²¬ä»»ç¯„å›²ã‚’ç†è§£ã™ã‚‹

## ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã®æŠ½å‡º
è­°äº‹éŒ²ã‹ã‚‰ä»¥ä¸‹ã®ã‚ˆã†ãªå®Ÿè¡Œå¯èƒ½ãªé …ç›®ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ï¼š
- æ˜ç¢ºãªæ±ºå®šäº‹é …ï¼ˆã€Œã€œã™ã‚‹ã“ã¨ã«ãªã£ãŸã€ã€Œã€œã§åˆæ„ã—ãŸã€ãªã©ï¼‰
- ã‚¿ã‚¹ã‚¯ã‚„ä½œæ¥­é …ç›®ï¼ˆã€Œã€œã‚’èª¿æŸ»ã™ã‚‹ã€ã€Œã€œã«é€£çµ¡ã™ã‚‹ã€ãªã©ï¼‰
- æœŸé™ä»˜ãã®ç´„æŸäº‹é …ï¼ˆã€Œã€œã¾ã§ã«æå‡ºã€ã€Œã€œæœˆã¾ã§ã«å®Œäº†ã€ãªã©ï¼‰
- æ¤œè¨ãƒ»æ¤œè¨¼ãŒå¿…è¦ãªèª²é¡Œï¼ˆã€Œã€œã‚’æ¤œè¨ã™ã‚‹ã€ã€Œã€œã‚’ç¢ºèªã™ã‚‹ã€ãªã©ï¼‰
- ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãŒå¿…è¦ãªäº‹é …

## ã‚¹ãƒ†ãƒƒãƒ—3: æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã¸ã®å¤‰æ›
å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®8é …ç›®ã‚’æ…é‡ã«åˆ†æã—ã¦æŠ½å‡ºã—ã¦ãã ã•ã„ï¼š

### 1. è­°é¡Œãƒ»ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ (agenda)
- **ä½•ã«ã¤ã„ã¦è­°è«–ã•ã‚ŒãŸã®ã‹**ã®è¦ç´„ï¼ˆ1-2æ–‡ï¼‰
- èƒŒæ™¯ã‚„çµŒç·¯ã‚’å«ã‚ãŸè­°é¡Œã®æœ¬è³ªã‚’è¨˜è¿°
- ä¾‹: ã€Œãƒ­ã‚¸ã‚¯ãƒ¼ãƒ«å€‰åº«ã®å®Œæˆã«ä¼´ã†æ’¤å»æ¥­è€…ã®é¸å®šã«ã¤ã„ã¦ã€

### 2. å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (action)
- **èª°ãŒä½•ã‚’ã™ã‚‹ã®ã‹**ã‚’æ˜ç¢ºã«è¨˜è¿°
- å‹•è©ã‚’ä½¿ã£ãŸå…·ä½“çš„ãªè¡Œå‹•ï¼ˆã€Œã€œã‚’èª¿æŸ»ã€ã€Œã€œã«é€£çµ¡ã€ã€Œã€œã‚’ç¢ºèªã€ï¼‰
- ä¾‹: ã€Œãƒˆãƒƒãƒ—ã‚¯ãƒªãƒ¼ãƒ³ã®ææºæ¥­è€…3ç¤¾ã¨åˆåŒå¯¾å¿œã®å¯èƒ½æ€§ã‚’ç¢ºèªã™ã‚‹ã€

### 3. æ‹…å½“è€… (assignee)
- å®Ÿæ–½è²¬ä»»è€…ã®åå‰ï¼ˆç™ºè¨€è€…ã‚„æŒ‡åã•ã‚ŒãŸäººç‰©ï¼‰
- åå‰ãŒä¸æ˜ãªå ´åˆã¯å½¹è·ã‚„éƒ¨é–€åï¼ˆã€Œå–¶æ¥­éƒ¨ã€ã€Œæ‹…å½“è€…ã€ãªã©ï¼‰
- è¤‡æ•°ã„ã‚‹å ´åˆã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š
- ä¾‹: ã€Œå±±ç”°å¤ªéƒã€ã€Œå–¶æ¥­éƒ¨æ‹…å½“ã€

### 4. æœŸé™ (deadline)
- YYYY-MM-DDå½¢å¼ã§è¨˜è¿°ï¼ˆä¾‹: 2025-03-15ï¼‰
- ã€Œæ¥å¹´3æœˆã€â†’ã€Œ2026-03-31ã€ã®ã‚ˆã†ã«å…·ä½“çš„ãªæ—¥ä»˜ã«å¤‰æ›
- ã€Œ1ãƒ¶æœˆå¾Œã€â†’ç¾åœ¨æ—¥ã‚’åŸºæº–ã«è¨ˆç®—
- æœŸé™ã®è¨˜è¼‰ãŒãªã„å ´åˆã¯ç©ºæ–‡å­— ""

### 5. ç›®çš„ãƒ»æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ (purpose)
- **ãªãœã“ã‚Œã‚’å®Ÿæ–½ã™ã‚‹ã®ã‹**ã®ç†ç”±
- æœŸå¾…ã•ã‚Œã‚‹çµæœã‚„ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ
- ã‚³ã‚¹ãƒˆå‰Šæ¸›ã€åŠ¹ç‡åŒ–ã€å“è³ªå‘ä¸Šãªã©ã®åŠ¹æœ
- ä¾‹: ã€Œæ’¤å»è²»ç”¨ã‚’ç¾çŠ¶ã®1.5ã€œ2å€ã‹ã‚‰å‰Šæ¸›ã—ã€ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã‚’å›³ã‚‹ã€

### 6. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (status)
- ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ–‡è„ˆã‚’åˆ¤æ–­ã—ã¦ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’é¸æŠï¼š
  - **pending**: æœªç€æ‰‹ã€ã“ã‚Œã‹ã‚‰å®Ÿæ–½äºˆå®š
  - **progress**: ç¾åœ¨é€²è¡Œä¸­ã€æ¤œè¨ä¸­ã€èª¿æŸ»ä¸­
  - **completed**: æ—¢ã«å®Œäº†ã€æ±ºå®šæ¸ˆã¿
  - **overdue**: æœŸé™ã‚’éãã¦ã„ã‚‹ï¼ˆæ˜ç¤ºçš„ãªè¨˜è¼‰ãŒã‚ã‚‹å ´åˆã®ã¿ï¼‰
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ "pending"

### 7. å‚™è€ƒ1 (notes1)
- è£œè¶³æƒ…å ±ã‚„åˆ¶ç´„æ¡ä»¶
- é–¢é€£ã™ã‚‹è¿½åŠ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- ä¾‹: ã€Œç¾åœ¨ãƒˆãƒ¼ãƒˆã‚¯ãƒªã‚¨ã‚¤ãƒˆã«ä¾é ¼ä¸­ã€ç›´æ¥ä¾é ¼ã®å ´åˆã¯å˜ä¾¡1.5ã€œ2å€ã€

### 8. å‚™è€ƒ2 (notes2)
- ãã®ä»–ã®å‚è€ƒæƒ…å ±
- é–¢ä¿‚è€…ã‹ã‚‰ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚„æ‡¸å¿µäº‹é …
- ä¾‹: ã€Œãƒ­ã‚¸ã‚¯ãƒ¼ãƒ«å€‰åº«å®Œæˆå¾Œã¯è‡ªç¤¾å¯¾å¿œå¯èƒ½ã€

# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
å¿…ãšä»¥ä¸‹ã®æœ‰åŠ¹ãªJSONé…åˆ—å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š

[
  {
    "agenda": "è­°é¡Œã®è¦ç´„ï¼ˆå…·ä½“çš„ã«ï¼‰",
    "action": "å®Ÿè¡Œã™ã¹ãå…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
    "assignee": "æ‹…å½“è€…åã¾ãŸã¯å½¹è·",
    "deadline": "YYYY-MM-DD ã¾ãŸã¯ç©ºæ–‡å­—",
    "purpose": "å®Ÿæ–½ã™ã‚‹ç†ç”±ã¨æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ",
    "status": "pending | progress | completed | overdue",
    "notes1": "è£œè¶³æƒ…å ±ã‚„åˆ¶ç´„æ¡ä»¶",
    "notes2": "ãã®ä»–ã®å‚è€ƒæƒ…å ±"
  }
]

# é‡è¦ãªæ³¨æ„äº‹é …
- **å“è³ªé‡è¦–**: éŸ³å£°ãƒ†ã‚­ã‚¹ãƒˆã‚’ãã®ã¾ã¾å…¥ã‚Œã‚‹ã®ã§ã¯ãªãã€ãƒ“ã‚¸ãƒã‚¹æ–‡æ›¸ã¨ã—ã¦æ•´ç†ã•ã‚ŒãŸæ–‡ç« ã«ã™ã‚‹
- **æ–‡è„ˆç†è§£**: ä¼šè©±ã®æµã‚Œã‹ã‚‰æš—é»™çš„ãªæƒ…å ±ã‚‚èª­ã¿å–ã‚‹
- **é‡è¤‡æ’é™¤**: åŒã˜å†…å®¹ãŒç¹°ã‚Šè¿”ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯1ã¤ã«ã¾ã¨ã‚ã‚‹
- **å„ªå…ˆé †ä½**: é‡è¦åº¦ãŒé«˜ã„é …ç›®ã‹ã‚‰é †ã«ä¸¦ã¹ã‚‹
- **å…·ä½“æ€§**: æ›–æ˜§ãªè¡¨ç¾ã‚’é¿ã‘ã€5W1Hï¼ˆèª°ãŒã€ä½•ã‚’ã€ã„ã¤ã€ã©ã“ã§ã€ãªãœã€ã©ã®ã‚ˆã†ã«ï¼‰ã‚’æ˜ç¢ºã«ã™ã‚‹
- **JSONå½¢å¼**: å¿…ãšæœ‰åŠ¹ãªJSONã¨ã—ã¦å‡ºåŠ›ï¼ˆæ”¹è¡Œã‚„ç‰¹æ®Šæ–‡å­—ã¯é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰

ãã‚Œã§ã¯è§£æã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚å¿…ãšJSONé…åˆ—ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ï¼ˆèª¬æ˜æ–‡ã¯ä¸è¦ã§ã™ï¼‰ã€‚`;

                    const response = await fetch('/api/openai/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'gpt-5',
                            messages: [
                                {
                                    role: 'system',
                                    content: `ã‚ãªãŸã¯æ—¥æœ¬ã®ãƒ“ã‚¸ãƒã‚¹ä¼šè­°ã®è­°äº‹éŒ²è§£æã«ç‰¹åŒ–ã—ãŸAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

å°‚é–€çŸ¥è­˜:
- æ—¥æœ¬ã®ãƒ“ã‚¸ãƒã‚¹æ–‡åŒ–ã¨ä¼šè­°æ…£ç¿’ã®ç†è§£
- éŸ³å£°èªè­˜ãƒ†ã‚­ã‚¹ãƒˆï¼ˆè©±ã—è¨€è‘‰ï¼‰ã‹ã‚‰æ›¸ãè¨€è‘‰ã¸ã®å¤‰æ›
- æ›–æ˜§ãªç™ºè¨€ã‹ã‚‰å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã®æŠ½å‡º
- ãƒ“ã‚¸ãƒã‚¹ä¸Šã®å„ªå…ˆé †ä½ã¨é‡è¦åº¦ã®åˆ¤æ–­

è§£ææ–¹é‡:
1. ä¼šè­°ã®æ–‡è„ˆã‚’æ·±ãç†è§£ã—ã€æš—é»™çš„ãªæƒ…å ±ã‚‚èª­ã¿å–ã‚‹
2. å£èªè¡¨ç¾ã‚’æ•´ç†ã—ã€ãƒ“ã‚¸ãƒã‚¹æ–‡æ›¸ã¨ã—ã¦é©åˆ‡ãªè¡¨ç¾ã«å¤‰æ›
3. é‡è¤‡ã‚„å†—é•·ãªå†…å®¹ã‚’çµ±åˆã—ã€ç°¡æ½”ã§æ˜ç¢ºãªé …ç›®ã«ã¾ã¨ã‚ã‚‹
4. å®Ÿè¡Œå¯èƒ½æ€§ãŒé«˜ã„å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å„ªå…ˆçš„ã«æŠ½å‡º
5. å¿…ãšæœ‰åŠ¹ãªJSONé…åˆ—å½¢å¼ã§è¿”ã™ï¼ˆèª¬æ˜æ–‡ã‚„å‰ç½®ãã¯ä¸è¦ï¼‰

å“è³ªåŸºæº–:
- å„é …ç›®ã¯ç‹¬ç«‹ã—ã¦ç†è§£ã§ãã‚‹å®Œçµã—ãŸå†…å®¹ã§ã‚ã‚‹ã“ã¨
- æ‹…å½“è€…ã¨æœŸé™ãŒæ˜ç¢ºãªé …ç›®ã‚’å„ªå…ˆã™ã‚‹ã“ã¨
- æ›–æ˜§ã•ã‚’æ’é™¤ã—ã€5W1HãŒæ˜ç¢ºã§ã‚ã‚‹ã“ã¨`
                                },
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            temperature: 0.2,
                            max_tokens: 6000
                        })
                    });
                    
                    console.log('Sending request to OpenAI API...');
                    console.log('Request URL:', '/api/openai/chat/completions');
                    
                    if (response.ok) {
                        console.log('=== API Response received successfully ===');
                        const data = await response.json();
                        console.log('ğŸ“¦ Full API Response:', data);
                        
                        const content = data.choices[0].message.content;
                        console.log('ğŸ“ Content type:', typeof content);
                        console.log('ğŸ“ Is array:', Array.isArray(content));
                        
                        let parsedData;
                        
                        // âœ… Check if content is already an array (new server format)
                        if (Array.isArray(content)) {
                            console.log('âœ… Content is already an array! Using directly.');
                            console.log('ğŸ“Š Array length:', content.length);
                            console.log('ğŸ“Š First item:', content[0]);
                            parsedData = content;
                        } 
                        // ğŸ”„ If content is a string, parse it (legacy format)
                        else if (typeof content === 'string') {
                            console.log('ğŸ”„ Content is a string, parsing...');
                            console.log('ğŸ“ Content length:', content.length);
                            console.log('ğŸ“ Content preview:', content.substring(0, 500));
                            
                            // Parse JSON from response
                            let jsonText = content.trim();
                            console.log('ğŸ” Raw JSON text (first 300 chars):', jsonText.substring(0, 300));
                            
                            if (jsonText.startsWith('```json')) {
                                jsonText = jsonText.replace(/^```json\s*/, '').replace(/\s*```$/, '');
                                console.log('âœ‚ï¸ Removed ```json markers');
                            } else if (jsonText.startsWith('```')) {
                                jsonText = jsonText.replace(/^```\s*/, '').replace(/\s*```$/, '');
                                console.log('âœ‚ï¸ Removed ``` markers');
                            }
                            
                            console.log('ğŸ”„ Parsing JSON response...');
                            parsedData = JSON.parse(jsonText);
                            console.log('âœ… Parsed successfully!');
                        } else {
                            console.error('âŒ Unexpected content type:', typeof content);
                            throw new Error('Unexpected content type: ' + typeof content);
                        }
                        
                        console.log('ğŸ“Š Final data type:', typeof parsedData, 'isArray:', Array.isArray(parsedData));
                        console.log('ğŸ“Š Data items:', Array.isArray(parsedData) ? parsedData.length : 'NOT AN ARRAY');
                        console.log('ğŸ“Š First item:', parsedData[0]);
                        
                        if (Array.isArray(parsedData)) {
                            console.log('âœ… Data is array, mapping to result format...');
                            const result = parsedData.map((item, idx) => {
                                console.log(`ğŸ“„ Item ${idx + 1}:`, item);
                                return {
                                    agenda: item.agenda || '',
                                    action: item.action || '',
                                    assignee: item.assignee || '',
                                    deadline: item.deadline || '',
                                    purpose: item.purpose || '',
                                    status: item.status || 'pending',
                                    notes1: item.notes1 || '',
                                    notes2: item.notes2 || ''
                                };
                            });
                            console.log('ğŸ‰ AI analysis completed successfully!');
                            console.log('ğŸ“¦ Returning', result.length, 'structured items');
                            console.log('ğŸ“¦ Result sample:', result[0]);
                            return result;
                        } else {
                            console.error('Parsed data is not an array:', typeof parsedData);
                        }
                    } else {
                        console.error('API response not OK:', response.status, response.statusText);
                        const errorText = await response.text();
                        console.error('Error details:', errorText);
                    }
                } else {
                    console.warn('No API key found in config');
                }
            } catch (error) {
                console.error('=== AI Analysis Error ===');
                console.error('Error type:', error.name);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                console.warn('Falling back to simple parser');
            }
            
            // Fallback: Simple text parser
            console.log('=== Using simple text parser (fallback) ===');
            return this.parseMinutesText(text);
        };
        
        app.parseMinutesText = function(text) {
            const results = [];
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            
            // Pattern matching for Japanese meeting minutes
            const patterns = {
                // Match: â€¢ **Text**: description, æ‹…å½“: person, æœŸé™: date
                withDetails: /[â€¢ãƒ»]\s*\*?\*?([^:ï¼š]+?)\*?\*?[:ï¼š]\s*(.+?)(?:æ‹…å½“[:ï¼š]\s*([^ã€,]+?))?(?:æœŸé™[:ï¼š]\s*([0-9]{4}[-å¹´/][0-9]{1,2}[-æœˆ/][0-9]{1,2}æ—¥?))?\s*$/,
                // Match: â€¢ Text
                simple: /[â€¢ãƒ»]\s*(.+)$/,
                // Date pattern
                date: /([0-9]{4})[-å¹´/]([0-9]{1,2})[-æœˆ/]([0-9]{1,2})/
            };
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                // Try detailed pattern first
                let match = line.match(patterns.withDetails);
                if (match) {
                    const agenda = match[1].trim();
                    const action = match[2].trim();
                    const assignee = match[3] ? match[3].trim() : '';
                    const deadlineStr = match[4] || '';
                    
                    // Parse deadline
                    let deadline = '';
                    if (deadlineStr) {
                        const dateMatch = deadlineStr.match(patterns.date);
                        if (dateMatch) {
                            const year = dateMatch[1];
                            const month = dateMatch[2].padStart(2, '0');
                            const day = dateMatch[3].padStart(2, '0');
                            deadline = `${year}-${month}-${day}`;
                        }
                    }
                    
                    results.push({
                        agenda: agenda,
                        action: action,
                        assignee: assignee,
                        deadline: deadline,
                        purpose: '',
                        status: 'pending',
                        notes1: '',
                        notes2: ''
                    });
                    continue;
                }
                
                // Try simple pattern
                match = line.match(patterns.simple);
                if (match) {
                    const text = match[1].trim();
                    
                    // Extract assignee if present
                    let assignee = '';
                    let cleanText = text;
                    const assigneeMatch = text.match(/æ‹…å½“[:ï¼š]\s*([^ã€,]+)/);
                    if (assigneeMatch) {
                        assignee = assigneeMatch[1].trim();
                        cleanText = text.replace(/æ‹…å½“[:ï¼š]\s*[^ã€,]+/, '').trim();
                    }
                    
                    // Extract deadline if present
                    let deadline = '';
                    const deadlineMatch = cleanText.match(/æœŸé™[:ï¼š]\s*([0-9]{4}[-å¹´/][0-9]{1,2}[-æœˆ/][0-9]{1,2}æ—¥?)/);
                    if (deadlineMatch) {
                        const dateMatch = deadlineMatch[1].match(patterns.date);
                        if (dateMatch) {
                            const year = dateMatch[1];
                            const month = dateMatch[2].padStart(2, '0');
                            const day = dateMatch[3].padStart(2, '0');
                            deadline = `${year}-${month}-${day}`;
                        }
                        cleanText = cleanText.replace(/æœŸé™[:ï¼š]\s*[0-9]{4}[-å¹´/][0-9]{1,2}[-æœˆ/][0-9]{1,2}æ—¥?/, '').trim();
                    }
                    
                    results.push({
                        agenda: cleanText,
                        action: cleanText,
                        assignee: assignee,
                        deadline: deadline,
                        purpose: '',
                        status: 'pending',
                        notes1: '',
                        notes2: ''
                    });
                }
            }
            
            // If no items found, create a default one
            if (results.length === 0) {
                results.push({
                    agenda: text.substring(0, 100),
                    action: text.substring(0, 100),
                    assignee: '',
                    deadline: '',
                    purpose: '',
                    status: 'pending',
                    notes1: '',
                    notes2: ''
                });
            }
            
            return results;
        };
        
        app.loadOpenAIConfig = async function() {
            try {
                // Try to load from environment variables or config file
                // In browser, we'll use a simple approach - check if config is available
                const response = await fetch('/load-openai-config', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).catch(() => null);
                
                if (response && response.ok) {
                    return await response.json();
                }
                
                // Fallback: use environment variables if available
                // This would be injected by the server
                return {
                    api_key: window.OPENAI_API_KEY || null,
                    base_url: window.OPENAI_BASE_URL || 'https://www.genspark.ai/api/llm_proxy/v1'
                };
            } catch (error) {
                console.error('Failed to load OpenAI config:', error);
                return null;
            }
        };
        
        console.log('=== Setting window.app ===');
        // Make app globally accessible for onclick handlers
        window.app = app;
        console.log('window.app is now:', window.app);
        console.log('window.app.showMeetingView:', typeof window.app.showMeetingView);
        
        // Initialize app
        console.log('=== Initializing app ===');
        window.addEventListener('load', () => {
            console.log('DOM loaded, calling app.init()');
            app.init();
        });
        
        // Immediate check
        console.log('=== Script Loading Completed ===');
        console.log('You can now use window.app from console');
    </script>
</body>
</html>
