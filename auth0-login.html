<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É≠„Ç∞„Ç§„É≥ - Ë≠∞‰∫ãÈå≤ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <script src="https://cdn.auth0.com/js/auth0-spa-js/2.1/auth0-spa-js.production.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 450px;
            padding: 50px 40px;
            text-align: center;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .notice {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 25px;
            font-size: 13px;
            color: #1565c0;
        }
        
        .notice strong {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-google {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-google:hover {
            background: #f5f5f5;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .divider {
            margin: 20px 0;
            text-align: center;
            color: #999;
            font-size: 13px;
        }
        
        .loading {
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }
        
        .error {
            margin-top: 20px;
            padding: 12px;
            background: #fee;
            color: #c33;
            border-radius: 8px;
            font-size: 14px;
            display: none;
            white-space: pre-line;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="logo">üóÇÔ∏è</div>
        <h1>Ë≠∞‰∫ãÈå≤ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
        <p class="subtitle">Á§æÂì°Â∞ÇÁî®„É≠„Ç∞„Ç§„É≥</p>
        
        <div class="notice">
            <strong>‚ö†Ô∏è „ÅîÊ≥®ÊÑè</strong>
            <strong>@ielove-partners.jp</strong> „ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åß„ÅÆ„Åø„É≠„Ç∞„Ç§„É≥ÂèØËÉΩ„Åß„Åô„ÄÇ
        </div>
        
        <button id="googleLoginBtn" class="btn btn-google">
            <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M17.6 9.2l-.1-1.8H9v3.4h4.8C13.6 12 13 13 12 13.6v2.2h3a8.8 8.8 0 0 0 2.6-6.6z" fill="#4285F4"/><path d="M9 18c2.4 0 4.5-.8 6-2.2l-3-2.2a5.4 5.4 0 0 1-8-2.9H1V13a9 9 0 0 0 8 5z" fill="#34A853"/><path d="M4 10.7a5.4 5.4 0 0 1 0-3.4V5H1a9 9 0 0 0 0 8l3-2.3z" fill="#FBBC05"/><path d="M9 3.6c1.3 0 2.5.4 3.4 1.3L15 2.3A9 9 0 0 0 1 5l3 2.4a5.4 5.4 0 0 1 5-3.7z" fill="#EA4335"/></g></svg>
            Google„Åß„É≠„Ç∞„Ç§„É≥
        </button>
        
        <div class="divider">„Åæ„Åü„ÅØ</div>
        
        <button id="emailLoginBtn" class="btn">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åß„É≠„Ç∞„Ç§„É≥</button>
        
        <div id="loading" class="loading" style="display: none;">
            Ë™çË®º‰∏≠...
        </div>
        
        <div id="error" class="error"></div>
    </div>

    <script>
        console.log('üîê Auth0„É≠„Ç∞„Ç§„É≥„Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÈñãÂßã');
        
        // Auth0Ë®≠ÂÆö
        const AUTH0_DOMAIN = 'dev-rwf7lnc4pwl8t41e.us.auth0.com';
        const AUTH0_CLIENT_ID = 'oE00LwfFgmPxr25BIpB9DYgt0buR4ohk';
        const REDIRECT_URI = window.location.href.split('?')[0]; // ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏URL„Çí„Åù„ÅÆ„Åæ„Åæ‰Ωø„ÅÜ
        const ALLOWED_DOMAIN = '@ielove-partners.jp';
        
        let auth0Client = null;
        
        // Auth0„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅÆÂàùÊúüÂåñ
        async function initAuth0() {
            try {
                console.log('üîß Auth0„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂàùÊúüÂåñ‰∏≠...');
                auth0Client = await window.auth0.createAuth0Client({
                    domain: AUTH0_DOMAIN,
                    clientId: AUTH0_CLIENT_ID,
                    authorizationParams: {
                        redirect_uri: REDIRECT_URI
                    }
                });
                console.log('‚úÖ Auth0„ÇØ„É©„Ç§„Ç¢„É≥„ÉàÂàùÊúüÂåñÂÆå‰∫Ü');
                
                // URL„ÅÆ„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºà„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÂæåÔºâ
                const query = window.location.search;
                if (query.includes('code=') || query.includes('state=')) {
                    console.log('üîÑ Ë™çË®º„Ç≥„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ‰∏≠...');
                    try {
                        await auth0Client.handleRedirectCallback();
                        const user = await auth0Client.getUser();
                        console.log('üë§ „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±:', user);
                        
                        // „Éâ„É°„Ç§„É≥„ÉÅ„Çß„ÉÉ„ÇØ
                        if (!user.email || !user.email.endsWith(ALLOWED_DOMAIN)) {
                            console.log('‚ùå Ë®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éâ„É°„Ç§„É≥:', user.email);
                            await auth0Client.logout({
                                logoutParams: {
                                    returnTo: window.location.origin + '/auth0-login.html'
                                }
                            });
                            showError(`‚ùå „É≠„Ç∞„Ç§„É≥„Åß„Åç„Åæ„Åõ„Çì\n\n„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅØ ${ALLOWED_DOMAIN} „ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åß„ÅÆ„Åø„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇ\n\n„ÅÇ„Å™„Åü„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ: ${user.email || '‰∏çÊòé'}`);
                            return;
                        }
                        
                        console.log('‚úÖ „Éâ„É°„Ç§„É≥„ÉÅ„Çß„ÉÉ„ÇØÊàêÂäü');
                        window.location.href = 'index.html';
                        return;
                    } catch (error) {
                        console.error('‚ùå „Ç≥„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ„Ç®„É©„Éº:', error);
                        showError('„É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                        return;
                    }
                }
                
                // „Åô„Åß„Å´„É≠„Ç∞„Ç§„É≥Ê∏à„Åø„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const isAuthenticated = await auth0Client.isAuthenticated();
                if (isAuthenticated) {
                    const user = await auth0Client.getUser();
                    // „Éâ„É°„Ç§„É≥„ÉÅ„Çß„ÉÉ„ÇØ
                    if (user.email && user.email.endsWith(ALLOWED_DOMAIN)) {
                        console.log('‚úÖ „Åô„Åß„Å´„É≠„Ç∞„Ç§„É≥Ê∏à„ÅøÔºàË®±ÂèØ„Åï„Çå„Åü„Éâ„É°„Ç§„É≥Ôºâ');
                        window.location.href = 'index.html';
                    } else {
                        console.log('‚ùå Ë®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éâ„É°„Ç§„É≥');
                        await auth0Client.logout({
                            logoutParams: {
                                returnTo: window.location.origin + '/auth0-login.html'
                            }
                        });
                        showError(`„Åì„ÅÆ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„Åß„ÅØ„É≠„Ç∞„Ç§„É≥„Åß„Åç„Åæ„Åõ„Çì„ÄÇ${ALLOWED_DOMAIN} „ÅÆ„Ç¢„Éâ„É¨„Çπ„Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`);
                    }
                }
            } catch (error) {
                console.error('‚ùå Auth0ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                showError('ÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
        
        // Google„É≠„Ç∞„Ç§„É≥
        document.getElementById('googleLoginBtn').addEventListener('click', async () => {
            await login('google-oauth2');
        });
        
        // „É°„Éº„É´„É≠„Ç∞„Ç§„É≥
        document.getElementById('emailLoginBtn').addEventListener('click', async () => {
            await login();
        });
        
        // „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ
        async function login(connection) {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            try {
                console.log('üöÄ „É≠„Ç∞„Ç§„É≥Âá¶ÁêÜÈñãÂßã');
                const options = {
                    authorizationParams: {
                        redirect_uri: REDIRECT_URI,
                        ui_locales: 'ja',
                        login_hint: ALLOWED_DOMAIN
                    }
                };
                
                if (connection) {
                    options.authorizationParams.connection = connection;
                }
                
                await auth0Client.loginWithRedirect(options);
            } catch (error) {
                console.error('‚ùå „É≠„Ç∞„Ç§„É≥„Ç®„É©„Éº:', error);
                showError('„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                loading.style.display = 'none';
            }
        }
        
        // „Ç®„É©„ÉºË°®Á§∫
        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        initAuth0();
    </script>
</body>
</html>
